{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\ud83d\udcda ClansCore Dokumentation","text":"<p>Willkommen zur vollst\u00e4ndigen Dokumentation f\u00fcr ClansCore!</p> <p></p>"},{"location":"#projekt-ubersicht","title":"Projekt-\u00dcbersicht","text":"<p>ClansCore ist ein umfassendes System f\u00fcr Vereine mit drei Hauptkomponenten:</p> <ul> <li>\ud83d\ude80 clanscore-api: Node.js/Express REST API</li> <li>\ud83d\udcca dashboard: Angular Frontend</li> <li>\ud83e\udd16 discord-bot: Discord Bot f\u00fcr Vereinsmanagement</li> </ul> <p>Alle Services werden mit Docker Compose orchestriert und k\u00f6nnen sowohl lokal als auch auf einem Server deployed werden.</p>"},{"location":"#schnellstart","title":"Schnellstart","text":"<p>Neue Benutzer sollten mit dem Schnellstart-Guide beginnen.</p>"},{"location":"#fur-entwickler","title":"F\u00fcr Entwickler","text":"<ul> <li>Lokale Entwicklung - Setup ohne Docker</li> <li>Lokales Docker Setup - Docker-basierte Entwicklung</li> </ul>"},{"location":"#fur-systemadministratoren","title":"F\u00fcr Systemadministratoren","text":"<ul> <li>Deployment Guide - Vollst\u00e4ndige Server-Deployment-Anleitung</li> <li>Umgebungs-Variablen - .env Konfiguration</li> </ul>"},{"location":"#dokumentations-bereiche","title":"Dokumentations-Bereiche","text":""},{"location":"#konfiguration","title":"\u2699\ufe0f Konfiguration","text":"<ul> <li>Einrichtung - Vollst\u00e4ndige Setup-Anleitung</li> <li>Umgebungs-Variablen - Alle Variablen erkl\u00e4rt</li> <li>.env Vorlage - Vollst\u00e4ndige .env Vorlage</li> <li>SSH Setup - SSH-Authentifizierung</li> </ul> <p>Entwicklung: - Architektur - System-Architektur - API-Endpunkte - Vollst\u00e4ndige API-Dokumentation - Webhooks - Webhook-Integration - Testing - Testing-Strategie (Jasmine/Karma &amp; Jest)</p> <p>Datenbank: - Backups &amp; Restore - Datenbank-Backups</p> <p>Kalender: - Kalender-Integration - Google Calendar Setup</p>"},{"location":"#deployment","title":"\ud83d\ude80 Deployment","text":"<ul> <li>\u00dcbersicht - Schnellstart und \u00dcbersicht</li> <li>Deployment-Stand - Detaillierte Dokumentation des aktuellen Deployment-Systems</li> <li>Setup - Schnellstart-Anleitung f\u00fcr Deployment</li> <li>Vollst\u00e4ndiger Guide - Detaillierte Schritt-f\u00fcr-Schritt-Anleitung</li> <li>Details - Erweiterte Konfiguration (Reverse Proxy, SSL, etc.)</li> <li>Server-spezifisch - F\u00fcr srbsci-11.ost.ch</li> <li>Deployment-Skripte - Automatisierte Deployment-Tools</li> </ul>"},{"location":"#entwicklung","title":"\ud83d\udcbb Entwicklung","text":"<ul> <li>Lokale Entwicklung - Setup ohne Docker</li> <li>Lokales Docker - Docker-basierte Entwicklung</li> <li>Troubleshooting - H\u00e4ufige Probleme l\u00f6sen</li> </ul>"},{"location":"#dashboard","title":"\ud83d\udcca Dashboard","text":"<ul> <li>Benutzerhandbuch - Vollst\u00e4ndiges Handbuch f\u00fcr Benutzer</li> </ul>"},{"location":"#discord-bot","title":"\ud83e\udd16 Discord Bot","text":"<ul> <li>Benutzerhandbuch - Vollst\u00e4ndiges Handbuch f\u00fcr Benutzer</li> </ul>"},{"location":"#technologie-stack","title":"Technologie-Stack","text":"<ul> <li>Database: MongoDB</li> <li>ClansCore-API (Backend): Node.js, Express, TypeScript</li> <li>Dashboard (Frontend): Angular</li> <li>Discord-Bot: Discord.js</li> <li>Container: Docker, Docker Compose</li> <li>CI/CD: GitHub Actions</li> </ul>"},{"location":"#weitere-ressourcen","title":"Weitere Ressourcen","text":"<ul> <li>GitHub Repository - Source Code</li> </ul>"},{"location":"#hilfe-support","title":"Hilfe &amp; Support","text":"<p>Bei Problemen:</p> <ol> <li>Pr\u00fcfe die Troubleshooting-Sektion</li> <li>Lese die entsprechende Dokumentation</li> <li>Erstelle ein Issue im GitHub Repository</li> </ol> <p>Letzte Aktualisierung: Diese Dokumentation wird kontinuierlich aktualisiert. F\u00fcr die neuesten Informationen besuche das GitHub Repository.</p>"},{"location":"quickstart/","title":"\ud83d\ude80 Schnellstart","text":"<p>ClansCore besteht aus drei Hauptkomponenten:</p> <ul> <li>clanscore-api: Node.js/Express REST API f\u00fcr Backend-Logik</li> <li>dashboard: Angular Frontend f\u00fcr Administratoren</li> <li>discord-bot: Discord-Bot f\u00fcr Vereinsmitglieder</li> </ul> <p>Alle Services werden mit Docker Compose orchestriert.</p>"},{"location":"quickstart/#voraussetzungen","title":"Voraussetzungen","text":"<ul> <li>Docker &amp; Docker Compose installiert</li> <li>Git Repository geklont</li> <li>(Optional) GitHub Repository mit aktivierten Actions f\u00fcr automatisches Deployment</li> </ul>"},{"location":"quickstart/#anleitung","title":"Anleitung","text":""},{"location":"quickstart/#1-konfiguration","title":"1. Konfiguration","text":"<p>Erstelle eine <code>.env</code> Datei auf dem Server:</p> <pre><code># Auf dem Server\ncp .env.example .env\nnano .env  # Alle Werte anpassen\n</code></pre> <p>Wichtig: Die <code>.env</code> Datei enth\u00e4lt sensible Daten und sollte niemals ins Git Repository committet werden!</p> <p>Siehe Umgebungsvariablen Dokumentation f\u00fcr die vollst\u00e4ndige Vorlage.</p>"},{"location":"quickstart/#2-deployment","title":"2. Deployment","text":"<p>Linux/Mac: <pre><code>./deploy.sh\n</code></pre></p> <p>Windows: <pre><code>.\\deploy.ps1\n</code></pre></p> <p>Oder manuell: <pre><code>docker-compose up -d --build\n</code></pre></p>"},{"location":"quickstart/#3-services-prufen","title":"3. Services pr\u00fcfen","text":"<pre><code># Status anzeigen\ndocker-compose ps\n\n# Logs anzeigen\ndocker-compose logs -f\n\n# Einzelner Service\ndocker-compose logs -f clanscore-api\n</code></pre>"},{"location":"quickstart/#4-zugriff","title":"4. Zugriff","text":"<ul> <li>API: http://your-server-ip:3000/api</li> <li>Dashboard: http://your-server-ip</li> <li>Health Check: http://your-server-ip:3000/health</li> </ul>"},{"location":"quickstart/#nachste-schritte","title":"N\u00e4chste Schritte","text":""},{"location":"quickstart/#fur-lokale-entwicklung","title":"F\u00fcr lokale Entwicklung","text":"<ul> <li>Lokale Entwicklung - Setup ohne Docker</li> <li>Lokales Docker Setup - Docker-basierte Entwicklung</li> </ul>"},{"location":"quickstart/#fur-production-deployment","title":"F\u00fcr Production-Deployment","text":"<ul> <li>Deployment Guide - Vollst\u00e4ndige Anleitung</li> <li>Server-spezifische Anleitung - F\u00fcr srbsci-11.ost.ch</li> </ul>"},{"location":"quickstart/#weitere-informationen","title":"Weitere Informationen","text":"<p>Siehe Deployment Guide f\u00fcr:</p> <ul> <li>Erweiterte Konfiguration</li> <li>Reverse Proxy Setup</li> <li>SSL/TLS Konfiguration</li> <li>Troubleshooting</li> <li>Monitoring</li> </ul>"},{"location":"bot/manual/","title":"\ud83d\udcd8 Benutzerhandbuch \u2013 Discord-Bot f\u00fcr Vereine","text":"<p>Willkommen beim offiziellen Handbuch f\u00fcr den Vereins-Bot! Dieses Manual zeigt dir, wie du den Bot optimal nutzt.</p>"},{"location":"bot/manual/#nutzen-des-bots","title":"\ud83e\udd16 Nutzen des Bots","text":"<p>Der Discord-Bot unterst\u00fctzt den Verein bei:</p> <ul> <li>Mitgliederaufnahme und Rollenvergabe</li> <li>Event-Synchronisation mit Google Calendar</li> <li>Gamification mit Punktesystem und Belohnungen</li> <li>Datenschutzkonforme Datenspeicherung</li> <li>Admin-Management (Befehlssteuerung, Datenabgleich)</li> </ul>"},{"location":"bot/manual/#rollenubersicht","title":"\ud83d\udd10 Rollen\u00fcbersicht","text":"Rolle Beschreibung <code>Community-Mitglied</code> Status nach Serverbeitritt. Keine Rolle oder Vereinsrechte. <code>Mitglied</code> Offiziell best\u00e4tigte Vereinsmitglieder mit Zugang zur Punktesammlung und Belohnungen. <code>Vorstand</code> Vorstandsmitglieder mit Zugriff auf erweiterte Bot-Befehle und Management-Funktionen. <code>Admin</code> Adminrechte f\u00fcr Einrichtungs- und Verwaltungs-Spezifische Bot-Befehle"},{"location":"bot/manual/#channel-beschreibung","title":"\ud83d\udcfa Channel-Beschreibung","text":"Kanalname Zweck <code>#regeln</code> Regeln und Datenschutzinformationen (Opt-in bei Beitritt). <code>#events</code> \u00dcbersicht aller Vereins-Events und Ank\u00fcndigungen sowie Erinnerungen f\u00fcr anstehende Events. <code>#rangliste</code> Zeigt die aktivsten Mitglieder im Punktesystem. <code>#aufgaben</code> Offene Vereinsaufgaben, die von Mitgliedern beansprucht und dann erledigt werden k\u00f6nnen (mit Punkte-Belohnung). <code>#bot-befehle</code> Bereich f\u00fcr die Eingabe und Erkl\u00e4rung aller verf\u00fcgbaren Befehle rund um den Bot. <code>#bot-bewerbungen</code> Vorstand-Bereich: Verwaltung eingereichter Bewerbungen durch den Vorstand. <code>#bot-belohnungen</code> Vorstand-Bereich: Liste der aktuell verf\u00fcgbaren Belohnungen f\u00fcr Punkte. <code>#bot-aufgaben</code> Vorstand-Bereich: Archiv der bereits erledigten Aufgaben (transparente Punktevergabe)."},{"location":"bot/manual/#befehls-ubersicht","title":"\ud83d\udcac Befehls-\u00dcbersicht","text":""},{"location":"bot/manual/#fur-alle-mitglieder","title":"F\u00fcr alle Mitglieder","text":"Befehl Beschreibung <code>/join</code> Bewerbe dich als Vereinsmitglied. <code>/events</code> Zeigt geplante Vereins-Events aus dem Kalender. <code>/score</code> Zeigt dir deinen Punktestand und Rang. <code>/completetask</code> Markiert eine zugewiesene Aufgabe als erledigt. <code>/rewards</code> Zeigt verf\u00fcgbare Belohnungen, die du einl\u00f6sen kannst. <code>/getdata</code> Zeigt dir alle gespeicherten Daten laut DSGVO. <code>/leave</code> Verl\u00e4sst den Verein (l\u00f6scht Rolle &amp; Daten)."},{"location":"bot/manual/#nur-fur-vorstand","title":"Nur f\u00fcr Vorstand","text":"Befehl Beschreibung <code>/donation</code> Erfasst eine Spende (z.\u202fB. Geld oder Sachspende) und vergibt Punkte. <code>/createtask</code> Erstellt eine neue Vereinsaufgabe mit Beschreibung und Punktewert. <code>/createleaderboard</code> Erstellt eine neue Rangliste (saisonal, j\u00e4hrlich etc.)."},{"location":"bot/manual/#nur-fur-admins","title":"Nur f\u00fcr Admins","text":"Befehl Beschreibung <code>/linkcalendar</code> Verkn\u00fcpft einen Google Kalender mit dem Discord-Server. <code>/synccalendar</code> Synchronisiert alle Events mit dem verkn\u00fcpften Kalender. <code>/syncroles</code> Gleicht Rollen im Discord mit der Vereinsdatenbank ab. <code>/syncusers</code> Aktualisiert Mitgliederliste anhand Discord-Rollen und DB-Daten."},{"location":"bot/manual/#gamification","title":"\ud83c\udfc6 Gamification","text":"<p>Der Discord-Bot belohnt deine Aktivit\u00e4t im Verein mit Punkten. Diese Punkte kannst du sp\u00e4ter gegen Belohnungen eintauschen, wie zum Beispiel Vereins-Merch.</p>"},{"location":"bot/manual/#das-punktesystem","title":"Das Punktesystem","text":"<p>Wenn du dich aktiv im Vereinsleben einbringst, erh\u00e4ltst du Punkte. Zum Beispiel f\u00fcr:</p> Aktivit\u00e4t Typisches Beispiel Teilnahme an Events LAN-Party, Offline- oder Online-Events Erledigen von Aufgaben Aufbauhilfe, Grafiken, Social Media etc. Teilnahme an Umfragen Feedback zu Vereinsentscheidungen Neue Mitglieder werben Freund oder Freundin erfolgreich eingeladen Spenden Finanzielle Unterst\u00fctzung f\u00fcr den Verein <p>Die Punkte werden dir gutgeschrieben, sobald deine Teilnahme oder Leistung best\u00e4tigt wurde.</p>"},{"location":"bot/manual/#belohnungen-fur-punkte","title":"Belohnungen f\u00fcr Punkte","text":"<p>Du kannst deine gesammelten Punkte gegen Belohnungen eintauschen. Die aktuelle Liste siehst du mit dem Befehl <code>/rewards</code> im Channel <code>#bot-befehle</code>.</p> <p>Beispiele f\u00fcr Belohnungen:</p> Belohnung Beschreibung Rabattcode z.\u202fB. CHF 5.\u2013 im Vereins-Shop Vereins-Merch T-Shirt, Hoodie, Trikot etc. Gratis-Mitgliedschaft F\u00fcr besonders engagierte Mitglieder"},{"location":"bot/manual/#rangliste","title":"Rangliste","text":"<p>Im Channel <code>#rangliste</code> kannst du sehen, wie aktiv andere Mitglieder sind und wie du im Vergleich stehst.</p> <p>Ein bisschen Wettbewerb, aber fair: Punkte sind Motivation, es gitb dadurch keinen Vorteil bei Abstimmungen oder Events.</p>"},{"location":"bot/manual/#wichtiger-hinweis","title":"Wichtiger Hinweis","text":"<ul> <li>Die Punktevergabe erfolgt durch den Vorstand \u2013 immer nachvollziehbar und transparent.</li> <li>Du kannst deinen Punktestand jederzeit mit dem Befehl <code>/score</code> im Channel <code>#bot-befehle</code> einsehen.</li> <li>Punkte sind nicht \u00fcbertragbar und verfallen nicht automatisch.</li> </ul> <p>\u2139\ufe0f Du m\u00f6chtest wissen, wie Punkte genau vergeben werden? Frag einfach den Vorstand oder wirf einen Blick ins README.</p>"},{"location":"bot/manual/#tutorials","title":"\ud83e\udde9 Tutorials","text":"<p>Alle Befehle werden im Channel <code>#bot-befehle</code> ausgef\u00fchrt.</p>"},{"location":"bot/manual/#vereins-beitritt","title":"Vereins-Beitritt","text":"<ul> <li>Das Nicht-Mitglied gibt <code>/join</code> im Bot-Channel ein und f\u00fcllt seine Daten aus. Dabei m\u00fcssen zwingend die Datenschutzrichtlinien akzeptiert werden.</li> <li>Das Nicht-Mitglied bekommt \u00fcber eine Privat-Nachricht die Zahlungs-Informationen des Vereins und bezahlt damit den f\u00e4lligen Mitgliederbeitrag.</li> <li>Der Vorstand wird im Channel <code>#bot-bewerbungen</code> benachrichtigt und kontrolliert die Zahlung des Mitgliederbeitrages.</li> <li>Der Vorstand entscheidet nach Zahlungsbest\u00e4tigung \u00fcber die Aufnahme des Nicht-Mitglieds mithilfe der Buttons <code>Akzeptieren</code> / <code>Ablehnen</code>.</li> <li>Das Nicht-Mitglied wird privat \u00fcber den Entscheid kontaktiert und erh\u00e4lt dann entweder die Rolle Mitglied oder hat weiterhin keine Vereins-Rechte. (Bei Ablehnung wird der Mitglieder-Beitrag selbstverst\u00e4ndlich zur\u00fcckerstattet)</li> </ul>"},{"location":"bot/manual/#aufgaben-erstellen-erledigen","title":"Aufgaben erstellen / erledigen","text":"<ul> <li>Der Vorstand erstellt mit <code>/createtask</code> diverse Aufgaben woraufhin diese im Channel <code>#aufgaben</code> publiziert werden.</li> <li>Mitglieder k\u00f6nnen diese Aufgaben durch einen Klick auf den Button <code>Aufgabe beanspruchen</code> f\u00fcr sich reservieren.</li> <li>Das Mitglied erledigt diese Aufgabe und markiert mit dem Befehl <code>/completetask</code> die Aufgabe als beendet.</li> <li>Der Vorstand wird im Channel <code>#bot-aufgaben</code> benachrichtigt und kontrolliert sie.</li> <li>Der Vorstand entscheidet \u00fcber das erfolgreiche Beenden der Aufgabe mithilfe der Buttons <code>Akzeptieren</code> / <code>Ablehnen</code> und schreibt ein kurzes Feedback, welches der Bot dem mitglied privat sendet.</li> </ul>"},{"location":"bot/manual/#punkte-f\u00fcr-belohung-einl\u00f6sen","title":"Punkte f\u00fcr Belohung einl\u00f6sen","text":"<ul> <li>Das Mitglied kann mit <code>/rewards</code> die aktuellen Belohnungen einsehen und eines ausw\u00e4hlen.</li> <li>Der Vorstand wird im Channel <code>#bot-belohnungen</code> benachrichtigt.</li> <li>Der Vorstand entscheidet \u00fcber die Belohnungs-Vergabe mithilfe der Buttons <code>Akzeptieren</code> / <code>Ablehnen</code>, wonach der Bot das mitglied privat \u00fcber den Entscheid informiert.</li> <li>Der Vorstand verarbeitet die Belohnung und gibt sie dem Mitglied.</li> </ul>"},{"location":"bot/manual/#datenschutz-dsgvo","title":"\ud83d\udcc4 Datenschutz &amp; DSGVO","text":"<ul> <li>Daten werden nur nach Zustimmung gespeichert. (Siehe Channel <code>#regeln</code>)</li> <li>Mit <code>/getdata</code> kannst du deine Daten einsehen.</li> <li>Du kannst jederzeit mit <code>/leave</code> dem Verein austreten und so deine Daten l\u00f6schen lassen.</li> <li>Die aktuellen Richtlinien zum Verein sind in den Vereinsstatuten und der Datenschutzrichtlinie zu finden</li> </ul>"},{"location":"bot/manual/#hilfe-support","title":"\u2753 Hilfe &amp; Support","text":"<p>Du brauchst Hilfe? Nutze den Befehl <code>/help</code> direkt im Discord-Bot-Channel <code>#bot-befehle</code> oder stelle deine Frage direkt an ein Vorstandsmitglied.</p>"},{"location":"configuration/setup/","title":"\u2699\ufe0f Konfiguration - Einrichtung","text":"<p>Diese Anleitung f\u00fchrt dich durch die vollst\u00e4ndige Einrichtung des ClansCore-Systems.</p> <p>ClansCore besteht aus drei Hauptkomponenten:</p> <ul> <li>clanscore-api: Node.js/Express REST API f\u00fcr Backend-Logik</li> <li>dashboard: Angular Frontend f\u00fcr Administratoren</li> <li>discord-bot: Discord-Bot f\u00fcr Vereinsmitglieder</li> </ul>"},{"location":"configuration/setup/#voraussetzungen","title":"Voraussetzungen","text":"<p>Nach dieser Anleitung sollten die nachfolgenden Voraussetzungen erf\u00fcllt sein.</p>"},{"location":"configuration/setup/#fur-lokale-entwicklung","title":"F\u00fcr lokale Entwicklung","text":"<ul> <li>Node.js 20+ installiert</li> <li>MongoDB lokal installiert (oder Docker)</li> <li>Git Repository geklont</li> <li>Discord Bot Token und Client ID</li> </ul>"},{"location":"configuration/setup/#fur-production-deployment","title":"F\u00fcr Production-Deployment","text":"<ul> <li>Docker &amp; Docker Compose installiert</li> <li>Server mit mindestens 2GB RAM</li> <li>Git Repository geklont</li> </ul>"},{"location":"configuration/setup/#schnellstart-einrichtung","title":"Schnellstart-Einrichtung","text":""},{"location":"configuration/setup/#1-repository-klonen","title":"1. Repository klonen","text":"<pre><code>git clone https://github.com/ClansCore/clanscore.git\ncd clanscore\n</code></pre>"},{"location":"configuration/setup/#2-umgebungs-variablen-konfigurieren","title":"2. Umgebungs-Variablen konfigurieren","text":"<p>F\u00fcr lokale Entwicklung:</p> <pre><code>cp .env.example .env\nnano .env  # Alle Werte anpassen\n</code></pre> <p>Siehe Umgebungs-Variablen Mapping</p> <p>F\u00fcr Production:</p> <p>Verwende GitHub Secrets (siehe GitHub Secrets Guide)</p>"},{"location":"configuration/setup/#3-dependencies-installieren","title":"3. Dependencies installieren","text":"<pre><code>npm install\nnpm run build:shared\n</code></pre>"},{"location":"configuration/setup/#4-services-starten","title":"4. Services starten","text":"<p>Lokal (ohne Docker): <pre><code># Terminal 1: API\nnpm run dev:api\n\n# Terminal 2: Discord Bot\nnpm run dev:bot\n\n# Terminal 3: Dashboard\nnpm run dev:dashboard\n</code></pre></p> <p>Mit Docker: <pre><code>docker-compose up -d --build\n</code></pre></p>"},{"location":"configuration/setup/#erforderliche-konfigurationen","title":"Erforderliche Konfigurationen","text":""},{"location":"configuration/setup/#discord-bot-setup","title":"Discord Bot Setup","text":"<ol> <li> <p>Discord Application erstellen:</p> <ul> <li>Gehe zu: https://discord.com/developers/applications</li> <li>Erstelle eine neue Application</li> <li>Kopiere <code>DISCORD_TOKEN</code> und <code>DISCORD_CLIENT_ID</code> f\u00fcr die Umgebungs-Variablen oder GitHub Secrets</li> </ul> </li> <li> <p>Bot \u2192 Privileged Gateway Intents:</p> <ul> <li>Aktiviere \"Server Members Intent\"</li> <li>Aktiviere \"Message Content Intent\"</li> </ul> </li> </ol> <p></p> <ol> <li>OAuth2 \u2192 OAuth2 URL Generator:<ul> <li>W\u00e4hle die Scopes: <code>bot</code>, <code>applications.commands</code></li> <li>Setze Bot Permissions: <code>Administrator</code>, <code>Manage Roles</code>, <code>View Channels</code>, <code>Manage Events</code>, <code>Create Events</code>, <code>Send Messages</code>, <code>Manage Messages</code></li> <li>Setze den Integration Type auf <code>Guild Install</code>, kopiere den generierten Link und lade den Bot auf dein Server ein.</li> </ul> </li> </ol> <p></p> <ol> <li>Server ID kopieren:<ul> <li>Rechtsklick auf Discord-Server und \"Server ID kopieren\" anklicken</li> <li>Das ist die <code>DISCORD_GUILD_ID</code> f\u00fcr die Umgebungs-Variablen oder GitHub Secrets</li> </ul> </li> </ol>"},{"location":"configuration/setup/#mongodb-setup","title":"MongoDB Setup","text":"<p>Lokal:</p> <p>MongoDB Community Edition inkl. MongoDB Compass installieren f\u00fcr einfacheren Zugriff: https://fastdl.mongodb.org/</p> <pre><code># MongoDB im Terminal starten (falls lokal installiert)\nmongod\n\n# Oder mit Docker\ndocker run -d -p 27017:27017 --name mongodb mongo:8\n</code></pre> <p>Production:</p> <ul> <li>MongoDB wird automatisch mit Docker Compose gestartet</li> <li>Konfiguriere <code>MONGO_INITDB_ROOT_USERNAME</code> und <code>MONGO_INITDB_ROOT_PASSWORD</code> in den Umgebungs-Variablen oder GitHub Secrets</li> </ul>"},{"location":"configuration/setup/#google-calendar-setup","title":"Google Calendar Setup","text":"<p>Siehe Kalender-Integrations Guide.</p>"},{"location":"configuration/setup/#erste-schritte-nach-der-einrichtung","title":"Erste Schritte nach der Einrichtung","text":""},{"location":"configuration/setup/#1-discord-server-vorbereiten","title":"1. Discord Server vorbereiten","text":"<p>Bevor der Discord-Bot voll funktionsf\u00e4hig im Server verwendet werden kann, m\u00fcssen die notwendigen Channels manuell in Discord erstellt werden.</p> <p>Diese sind unter <code>discord-bot\\channelNames.ts</code> definiert.</p> <pre><code>export const ChannelNames = {\n    RULES: \"regeln\",\n    EVENTS: \"events\",\n    LEADERBOARDS: \"rangliste\",\n    TASKS: \"aufgaben\",\n    COMMANDS: \"bot-befehle\",\n    APPLICATIONS: \"bot-bewerbungen\",\n    REWARDS: \"bot-belohnungen\",\n    COMPLETED_TASKS: \"bot-aufgaben\",\n    BotLog: \"bot-log\",\n} as const;\n\nexport type ChannelName = (typeof ChannelNames)[keyof typeof ChannelNames];\n</code></pre> Channel-Name Beschreibung regeln Regel-Channel mit allen wichtigen Richtlinien zu Verein und Datenschutz der Nutzer. events Events-Channel mit \u00dcbersicht der n\u00e4chsten 5 Events inkl. Event-Benachrichtigungen. rangliste Ranglisten-Channel mit der Auflistung aller existierenden Ranglisten. aufgaben Aufgaben-Channel, in dem die offenen Aufgaben publiziert und beansprucht werden k\u00f6nnen. bot-befehle Befehls-Channel der als zentraler Ort f\u00fcr alle Bot-Befehle genutzt werden kann. bot-bewerbungen Vorstands-Bereich: Hier werden alle Bewerbungen zur Bearbeitung und auch Austritte angezeigt. bot-belohnungen Vorstands-Bereich: Hier werden alle angeforderten Belohnungen zur Bearbeitung angezeigt. bot-aufgaben Vorstands-Bereich: Hier werden alle erledigten Aufgaben zur Bearbeitung angezeigt. bot-log Vorstands-Bereich: Hier werden relevante \u00c4nderungen in Discord und Dashboard protokolliert. <p>Wichtiger Hinweis:</p> <ul> <li>Der Channel-Bereich \"Vorstand\" sollte dementsprechend nur f\u00fcr Vorstandsmitglieder sichtbar sein.</li> <li>Der Discord-Server sollte grunds\u00e4tzlich in den Server-Einstellungen stummgeschaltet werden, da ansonsten immer wieder Benachrichtigungen hervorgehoben werden. (Aktualisierung der Event-\u00dcbersicht und Ranglisten)</li> </ul> <p></p>"},{"location":"configuration/setup/#2-bot-mit-der-db-synchronisieren","title":"2. Bot mit der DB synchronisieren","text":"<p>F\u00fchre diese Befehle im Discord-Server aus, um Rollen und User mit der Datenbank zu synchronisieren:</p> <pre><code>/syncroles\n/syncusers\n</code></pre>"},{"location":"configuration/setup/#3-kalender-verknupfen-und-event-synchronisieren","title":"3. Kalender verkn\u00fcpfen und Event synchronisieren","text":"<pre><code>/linkcalendar\n/syncevents\n</code></pre> <p>Siehe Kalender-Integrations Guide f\u00fcr eine vollst\u00e4ndige Anleitung.</p>"},{"location":"configuration/setup/#nachste-schritte","title":"N\u00e4chste Schritte","text":"<ul> <li>Architektur - Code-Aufbau verstehen</li> <li>API-Endpunkte - API-Dokumentation</li> <li>Deployment - Production-Deployment</li> <li>Dashboard - Dashboard-Funktionen</li> <li>Discord Bot - Bot-Funktionen</li> </ul>"},{"location":"configuration/setup/#troubleshooting","title":"Troubleshooting","text":"<ul> <li> <p>\"Missing environment variables\"</p> <ul> <li>Pr\u00fcfe, ob alle erforderlichen Variablen in <code>.env</code> gesetzt sind</li> <li>Siehe Umgebungs-Variablen f\u00fcr vollst\u00e4ndige Liste</li> </ul> </li> <li> <p>MongoDB-Verbindungsfehler</p> <ul> <li>Pr\u00fcfe, ob MongoDB l\u00e4uft: <code>docker ps</code> oder <code>mongosh</code></li> <li>Pr\u00fcfe <code>MONGO_HOST</code> und <code>MONGO_PORT</code></li> </ul> </li> <li> <p>Discord Bot verbindet nicht</p> <ul> <li>Pr\u00fcfe den <code>DISCORD_TOKEN</code></li> <li>Pr\u00fcfe die Bot-Intents in Discord Developer Console</li> <li>Pr\u00fcfe die Logs: <code>docker-compose logs discord-bot</code></li> </ul> </li> </ul>"},{"location":"configuration/setup/#weitere-informationen","title":"Weitere Informationen","text":"<ul> <li>GitHub Secrets - Secrets f\u00fcr Production</li> <li>Umgebungs-Variablen - Alle Variablen erkl\u00e4rt</li> <li>Lokale Entwicklung - Entwicklung ohne Docker</li> </ul>"},{"location":"configuration/ssh-setup/","title":"\ud83d\udd10 SSH-Setup f\u00fcr Passwort-Authentifizierung","text":""},{"location":"configuration/ssh-setup/#option-1-passwort-basiertes-deployment-einfach-aber-weniger-sicher","title":"Option 1: Passwort-basiertes Deployment (Einfach, aber weniger sicher)","text":""},{"location":"configuration/ssh-setup/#github-secrets-konfigurieren","title":"GitHub Secrets konfigurieren","text":"<p>F\u00fcr Passwort-Authentifizierung ben\u00f6tigst du:</p> <ol> <li><code>SERVER_HOST</code> = <code>&lt;server_host&gt;</code> (z.B. <code>srbsci-11.ost.ch</code> oder <code>152.96.10.11</code>)</li> <li><code>SERVER_USER</code> = <code>&lt;server_benutzer&gt;</code> (z.B. <code>ins</code>, <code>ubuntu</code>, <code>root</code>, <code>deploy</code>)</li> <li><code>SERVER_SSH_PASSWORD</code> = SSH-Passwort</li> <li><code>SERVER_SSH_PORT</code> = <code>22</code> (optional, falls Standard)</li> </ol>"},{"location":"configuration/ssh-setup/#workflow-verwenden","title":"Workflow verwenden","text":"<p>Verwende <code>.github/workflows/deploy-password.yml</code> statt <code>deploy.yml</code>, oder aktualisiere <code>deploy.yml</code> (siehe unten).</p>"},{"location":"configuration/ssh-setup/#option-2-ssh-key-einrichten-empfohlen-sicherer","title":"Option 2: SSH-Key einrichten (Empfohlen, sicherer)","text":""},{"location":"configuration/ssh-setup/#warum-ssh-key","title":"Warum SSH-Key?","text":"<ul> <li>Sicherer (kein Passwort in GitHub Secrets)</li> <li>Automatisches Login ohne Passwort-Eingabe</li> <li>Standard f\u00fcr CI/CD</li> </ul>"},{"location":"configuration/ssh-setup/#automatisches-setup-empfohlen","title":"Automatisches Setup (Empfohlen)","text":"<p>Windows (PowerShell): <pre><code>.\\setup-ssh-deployment.ps1\n</code></pre></p> <p>Linux/macOS (Bash): <pre><code>./setup-ssh-deployment.sh\n</code></pre></p> <p>Das Skript f\u00fchrt durch:</p> <ol> <li>SSH-Key-Erstellung</li> <li>Anzeige des \u00f6ffentlichen Keys (f\u00fcr Server-Installation)</li> <li>Anzeige des privaten Keys (f\u00fcr GitHub Secrets)</li> <li>SSH-Verbindungstest</li> <li>Anweisungen f\u00fcr GitHub Secrets</li> </ol> <p>Nach dem Skript: - Kopiere den \u00f6ffentlichen Key auf den Server (siehe Anweisungen im Skript) - Kopiere den privaten Key in GitHub Secrets als <code>SERVER_SSH_KEY</code> - F\u00fcge <code>SERVER_HOST</code>, <code>SERVER_USER</code> und optional <code>SERVER_SSH_PORT</code> hinzu</p>"},{"location":"configuration/ssh-setup/#manuelles-setup-alternative","title":"Manuelles Setup (Alternative)","text":"<p>Falls du die Schritte manuell durchf\u00fchren m\u00f6chtest:</p>"},{"location":"configuration/ssh-setup/#schritt-1-ssh-key-erstellen-lokal","title":"Schritt 1: SSH-Key erstellen (lokal)","text":"<pre><code># Auf dem lokalen Rechner\nssh-keygen -t ed25519 -C \"github-actions-deploy\" -f ~/.ssh/github_actions_deploy\n\n# Kein Passwort eingeben (Enter dr\u00fccken)\n</code></pre>"},{"location":"configuration/ssh-setup/#schritt-2-offentlichen-key-auf-server-installieren","title":"Schritt 2: \u00d6ffentlichen Key auf Server installieren","text":"<p>Methode A: Automatisch (empfohlen) <pre><code># Auf dem lokalen Rechner\nssh-copy-id -i ~/.ssh/github_actions_deploy.pub &lt;server_benutzer&gt;@&lt;server_host&gt;\n# Passwort eingeben, wenn gefragt\n</code></pre></p> <p>Methode B: Manuell <pre><code># 1. \u00d6ffentlichen Key anzeigen (lokal)\ncat ~/.ssh/github_actions_deploy.pub\n\n# 2. Auf Server einloggen\nssh &lt;server_benutzer&gt;@&lt;server_host&gt;\n\n# 3. Auf Server: Key hinzuf\u00fcgen\nmkdir -p ~/.ssh\nchmod 700 ~/.ssh\nnano ~/.ssh/authorized_keys\n# Key einf\u00fcgen (aus Schritt 1)\nchmod 600 ~/.ssh/authorized_keys\n</code></pre></p>"},{"location":"configuration/ssh-setup/#schritt-3-ssh-key-verbindung-testen","title":"Schritt 3: SSH-Key-Verbindung testen","text":"<pre><code># Sollte ohne Passwort funktionieren\nssh -i ~/.ssh/github_actions_deploy &lt;server_benutzer&gt;@&lt;server_host&gt;\n</code></pre>"},{"location":"configuration/ssh-setup/#schritt-4-github-secrets-konfigurieren","title":"Schritt 4: GitHub Secrets konfigurieren","text":"<ol> <li><code>SERVER_HOST</code> = <code>&lt;server_host&gt;</code> (z.B. <code>srbsci-11.ost.ch</code> oder <code>152.96.10.11</code>)</li> <li><code>SERVER_USER</code> = <code>&lt;server_benutzer&gt;</code> (z.B. <code>ins</code>, <code>ubuntu</code>, <code>root</code>, <code>deploy</code>)</li> <li><code>SERVER_SSH_KEY</code> = Privater Key (komplett):    <pre><code>cat ~/.ssh/github_actions_deploy\n# Kompletten Inhalt kopieren (inkl. BEGIN/END Zeilen)\n</code></pre></li> <li><code>SERVER_SSH_PORT</code> = <code>22</code> (optional)</li> </ol>"},{"location":"configuration/ssh-setup/#schritt-5-workflow-verwenden","title":"Schritt 5: Workflow verwenden","text":"<p>Verwende <code>.github/workflows/deploy.yml</code> (Key-basiert).</p>"},{"location":"configuration/ssh-setup/#vergleich","title":"Vergleich","text":"Methode Sicherheit Einfachheit Empfohlen Passwort \u26a0\ufe0f Niedrig \u2705 Sehr einfach \u274c Nein SSH-Key (manuell) \u2705 Hoch \u26a0\ufe0f Mittel \u26a0\ufe0f Ja, wenn kein Skript SSH-Key (mit Skript) \u2705 Hoch \u2705 Sehr einfach \u2705 Ja"},{"location":"configuration/ssh-setup/#troubleshooting","title":"Troubleshooting","text":"<ul> <li> <p>\"Permission denied (publickey)\"</p> <p>Bei Passwort-Auth: - Pr\u00fcfe <code>SERVER_SSH_PASSWORD</code> - Pr\u00fcfe, ob Passwort-Auth auf Server erlaubt ist: <pre><code># Auf Server\nsudo nano /etc/ssh/sshd_config\n# Sollte enthalten: PasswordAuthentication yes\nsudo systemctl restart sshd\n</code></pre></p> <p>Bei Key-Auth: - Pr\u00fcfe, ob \u00f6ffentlicher Key auf Server installiert ist - Pr\u00fcfe Berechtigungen: <code>chmod 600 ~/.ssh/authorized_keys</code></p> </li> <li> <p>\"Connection refused\"</p> <ul> <li>Pr\u00fcfe <code>SERVER_HOST</code> und <code>SERVER_SSH_PORT</code></li> <li>Pr\u00fcfe Firewall-Einstellungen</li> <li>Teste: <code>ssh &lt;server_benutzer&gt;@&lt;server_host&gt;</code></li> </ul> </li> </ul>"},{"location":"configuration/ssh-setup/#nachste-schritte","title":"N\u00e4chste Schritte","text":"<p>Nach dem Setup:</p> <ol> <li>GitHub Secrets konfigurieren</li> <li>Workflow testen (Actions \u2192 Deploy to Server \u2192 Run workflow)</li> <li>Logs pr\u00fcfen</li> </ol> <p>Tipp: Verwende <code>setup-ssh-deployment.ps1</code> (Windows) oder <code>setup-ssh-deployment.sh</code> (Linux/macOS) f\u00fcr ein automatisiertes Setup!</p> <p>Siehe GitHub Secrets Guide f\u00fcr alle ben\u00f6tigten Secrets.</p>"},{"location":"configuration/calendar/integration/","title":"\ud83d\udcc5 Kalender-Integration","text":"<p>Das ClansCore-System synchronisiert Events zwischen Google Calendar und Discord. Events aus dem Google Calendar werden automatisch im Discord-Server angezeigt und k\u00f6nnen vom Vorstand verwaltet werden:</p> <ul> <li>Bidirektionale Synchronisation: Google Calendar \u2194 Discord</li> <li>Automatische Event-Erinnerungen in Discord</li> <li>Teilnahme-Verwaltung \u00fcber Discord</li> <li>OAuth 2.0 Authentifizierung f\u00fcr sicheren Zugriff</li> </ul> <p>Um ClansCore mit dem Google Calendar verbinden zu k\u00f6nnen, ist eine einmalige Konfiguration in der Google Cloud notwendig. Dabei wird ein Projekt erstellt, API-Zugriff eingerichtet und die Authentifizierungsdaten generiert, die anschliessend als Secrets beim Projekt hinterlegt werden. Diese Schritte erm\u00f6glichen es dem Bot, Kalenderfunktionen wie das Abrufen und Verkn\u00fcpfen von Terminen sicher \u00fcber OAuth2 zu nutzen.</p>"},{"location":"configuration/calendar/integration/#1-google-cloud-console","title":"1. Google Cloud Console","text":"<ol> <li>Projekt erstellen:</li> <li>Gehe zu: https://console.cloud.google.com</li> <li>Melde dich mit dem Vereins-Google-Account an</li> <li>IAM und Verwaltung \u2192 Projekt erstellen</li> <li> <p>Gib dem Projekt einen Namen</p> </li> <li> <p>Google Calendar API aktivieren:</p> </li> <li>APIs und Dienste \u2192 Bibliothek</li> <li>Suche nach \"Google Calendar API\"</li> <li> <p>Klicke auf \"Aktivieren\"</p> </li> <li> <p>OAuth-Zustimmungsbildschirm:</p> </li> <li>APIs und Dienste \u2192 OAuth\u2011Zustimmungsbildschirm \u2192 Zielgruppe</li> <li>F\u00fcge bei Testnutzer den Vereins-Google-Account hinzu</li> </ol>"},{"location":"configuration/calendar/integration/#2-oauth-20-credentials","title":"2. OAuth 2.0 Credentials","text":"<ol> <li>Client ID erstellen:</li> <li>APIs und Dienste \u2192 Anmeldedaten</li> <li>Anmeldedaten erstellen \u2192 OAuth\u2011Client\u2011ID</li> <li> <p>Anwendungstyp: \"Webanwendung\"</p> </li> <li> <p>Autorisierte Weiterleitungs-URIs:</p> </li> <li>Lokal: <code>http://localhost:3000/calendarToken</code></li> <li>Production (ohne Port): <code>http://your-domain.com/calendarToken</code> oder <code>https://your-domain.com/calendarToken</code></li> </ol> <p>\u26a0\ufe0f Wichtig:     - Die URI muss exakt \u00fcbereinstimmen!    - F\u00fcr Production: Verwende KEINEN Port in der URI (z.B. <code>http://srbsci-11.ost.ch/calendarToken</code>, NICHT <code>http://srbsci-11.ost.ch:3000/calendarToken</code>)    - Der <code>/calendarToken</code> Endpoint wird \u00fcber den Nginx Reverse Proxy auf Port 80 erreichbar gemacht</p> <ol> <li>Credentials speichern:</li> <li>Kopiere die Client-ID</li> <li>Kopiere den Clientschl\u00fcssel</li> <li>Speicher diese sicher</li> </ol>"},{"location":"configuration/calendar/integration/#3-secrets-umgebungs-variablen","title":"3. Secrets / Umgebungs-Variablen","text":"<p>Setze die entsprechenden Secrets oder Variablen:</p> <pre><code>GOOGLE_CALENDAR_CLIENT_ID=your_client_id.apps.googleusercontent.com\nGOOGLE_CALENDAR_CLIENT_SECRET=your_client_secret\nGOOGLE_CALENDAR_REDIRECT_URI=http://localhost:3000/calendarToken\n</code></pre> <p>F\u00fcr Production: <pre><code># WICHTIG: Kein Port in der URI! Der Endpoint wird \u00fcber Nginx auf Port 80 erreichbar gemacht\nGOOGLE_CALENDAR_REDIRECT_URI=http://srbsci-11.ost.ch/calendarToken\n# ODER mit HTTPS (falls SSL konfiguriert):\n# GOOGLE_CALENDAR_REDIRECT_URI=https://srbsci-11.ost.ch/calendarToken\n</code></pre></p>"},{"location":"configuration/calendar/integration/#kalender-verknupfen","title":"Kalender verkn\u00fcpfen","text":"<p>F\u00fchre diesen Bot-Befehl im Discord-Server aus:</p> <pre><code>/linkcalendar\n</code></pre> <p>OAuth-Flow:</p> <ol> <li>Der Bot sendet einen Link</li> <li>Klicke auf den Link</li> <li>Du wirst zu Google weitergeleitet</li> <li>Autorisiere den Zugriff</li> <li>Du wirst zur\u00fcckgeleitet</li> <li>Der Bot best\u00e4tigt die Verkn\u00fcpfung</li> </ol> <p>Mit dem folgenden Bot-Befehl startest du die Synchronisation aller Events aus dem Google Calendar mit Discord manuell:</p> <pre><code>/synccalendar\n</code></pre>"},{"location":"configuration/calendar/integration/#troubleshooting","title":"Troubleshooting","text":""},{"location":"configuration/calendar/integration/#oauth-callback-failed-err_connection_refused","title":"\"OAuth callback failed\" / \"ERR_CONNECTION_REFUSED\"","text":"<ul> <li>Pr\u00fcfe die <code>GOOGLE_CALENDAR_REDIRECT_URI</code> in der <code>.env</code> Datei</li> <li>Diese muss exakt mit der in Google Cloud Console \u00fcbereinstimmen</li> <li>F\u00fcr Production: Verwende KEINEN Port in der URI (z.B. <code>http://srbsci-11.ost.ch/calendarToken</code>, NICHT <code>http://srbsci-11.ost.ch:3000/calendarToken</code>)</li> <li>Pr\u00fcfe, ob der Nginx Proxy <code>/calendarToken</code> weiterleitet (siehe <code>apps/dashboard/nginx.conf</code>)</li> <li>Pr\u00fcfe, ob der Server auf Port 80 erreichbar ist: <code>curl http://your-domain.com/calendarToken?code=test&amp;state=test</code></li> </ul>"},{"location":"configuration/calendar/integration/#calendar-not-linked","title":"\"Calendar not linked\"","text":"<ul> <li>F\u00fchre <code>/linkcalendar</code> erneut aus</li> <li>Pr\u00fcfe die OAuth-Credentials</li> <li>Pr\u00fcfe die Logs: <code>docker-compose logs discord-bot</code></li> </ul>"},{"location":"configuration/calendar/integration/#sync-failed","title":"\"Sync failed\"","text":"<ul> <li>Pr\u00fcfe die Google Calendar API-Berechtigungen</li> <li>Pr\u00fcfe, ob der Kalender zug\u00e4nglich ist</li> <li>Pr\u00fcfe die Logs: <code>docker-compose logs ClansCore-api</code></li> </ul>"},{"location":"configuration/calendar/integration/#events-not-showing-in-discord","title":"\"Events not showing in Discord\"","text":"<ul> <li>F\u00fchre <code>/synccalendar</code> aus</li> <li>Pr\u00fcfe, ob der <code>#events</code> Channel existiert</li> <li>Pr\u00fcfe die Bot-Berechtigungen im Discord Server und Channel</li> </ul>"},{"location":"configuration/calendar/integration/#best-practices","title":"Best Practices","text":""},{"location":"configuration/calendar/integration/#sicherheit","title":"Sicherheit","text":"<ol> <li>OAuth-Credentials:</li> <li>Niemals in Git committen</li> <li>Verwende GitHub Secrets f\u00fcr Production</li> <li> <p>Regelm\u00e4ssig rotieren</p> </li> <li> <p>Berechtigungen:</p> </li> <li>Minimal notwendige Berechtigungen</li> <li>Nur auf Vereins-Kalender zugreifen</li> </ol>"},{"location":"configuration/calendar/integration/#wartung","title":"Wartung","text":"<ol> <li>Regelm\u00e4ssige Synchronisation:</li> <li>T\u00e4glich automatische Sync</li> <li> <p>Manuelle Sync bei Bedarf</p> </li> <li> <p>Event-Bereinigung:</p> </li> <li>Alte Events automatisch archivieren</li> <li>Regelm\u00e4ssig Kalender aufr\u00e4umen</li> </ol>"},{"location":"configuration/calendar/integration/#weitere-informationen","title":"Weitere Informationen","text":"<ul> <li>API-Endpunkte - Vollst\u00e4ndige API-Dokumentation</li> <li>Konfiguration - Setup-Anleitung</li> <li>Discord Bot - Bot-Funktionen</li> </ul>"},{"location":"configuration/database/backups-restore/","title":"\ud83d\udcbe Datenbank - Backups &amp; Restore","text":"<p>Das ClansCore-System bietet ein automatisiertes Backup- und Restore-System f\u00fcr die MongoDB-Datenbank.</p> <ul> <li>Automatische t\u00e4gliche Backups</li> <li>Manuelle Backups via Script</li> <li>GPG-Verschl\u00fcsselung (optional)</li> <li>Automatische Bereinigung alter Backups</li> <li>Restore-Funktion zur Wiederherstellung</li> </ul>"},{"location":"configuration/database/backups-restore/#automatisiertes-backup","title":"Automatisiertes Backup","text":"<p>Ein separater Docker-Service <code>backup</code> (siehe <code>docker-compose.yml</code>) erzeugt jeden Tag automatisch ein neues Backup der MongoDB-Datenbank.</p> <ul> <li>Die Backups werden im Ordner <code>./data/backup/</code> gespeichert</li> <li>Backups \u00e4lter als 7 Tage werden automatisch gel\u00f6scht</li> <li>Optional k\u00f6nnen die Archive per GPG verschl\u00fcsselt werden <ul> <li>Setze hierf\u00fcr in der <code>.env</code>-Datei <code>GPG_PW</code></li> </ul> </li> </ul>"},{"location":"configuration/database/backups-restore/#manuelles-backup-mit-script","title":"Manuelles Backup mit Script","text":"<p>Falls du ein sofortiges Backup manuell erzeugen willst:</p> <ol> <li> <p>Stelle sicher, dass der MongoDB-Container l\u00e4uft</p> <pre><code>docker ps\n</code></pre> </li> <li> <p>F\u00fchre eines der folgenden Scripts aus:</p> <ul> <li> <p>Windows PowerShell:</p> <pre><code>powershell -ExecutionPolicy Bypass -File backup/backup.ps1\n</code></pre> <p>Hinweis f\u00fcr Windows-Nutzer: F\u00fcr die Verschl\u00fcsselung der Backups wird GPG (GnuPG) ben\u00f6tigt. Lade das Windows-Installationspaket auf der offiziellen Webseite herunter.</p> </li> <li> <p>Linux/macOS oder Git Bash/WSL:</p> <pre><code>bash backup/backup.sh\n</code></pre> </li> </ul> </li> <li> <p>Das Backup wird abgelegt unter:</p> <pre><code>./data/db-backup/YYYY-MM-DD-HH-MM-SS.tar.gz.gpg\n</code></pre> </li> </ol> <p>Hinweis: Das funktioniert nur, wenn das Volume <code>./data/db-backup</code> im <code>docker-compose.yml</code> korrekt verbunden ist.</p>"},{"location":"configuration/database/backups-restore/#ablauf","title":"Ablauf","text":"<ul> <li>Backup-Skripte verwenden <code>mongodump</code> im Container (via <code>docker exec</code>)</li> <li>Die Daten werden lokal archiviert (<code>tar.gz</code>)</li> <li>Optional verschl\u00fcsselt (<code>.gpg</code>) wenn in der <code>.env</code>-Datei <code>GPG_PW</code> gesetzt ist</li> <li>Tempor\u00e4re unverschl\u00fcsselte Dateien werden nach der Sicherung automatisch gel\u00f6scht</li> </ul>"},{"location":"configuration/database/backups-restore/#wiederherstellung-manuell","title":"Wiederherstellung (manuell)","text":"<ol> <li> <p>Restore Script starten</p> <pre><code>bash backup/restore.sh\n</code></pre> <p>oder unter Windows:</p> <pre><code>powershell -ExecutionPolicy Bypass -File backup/restore.ps1\n</code></pre> </li> <li> <p>Folge der Aufforderung und gib den Pfad zur <code>.tar.gz.gpg</code> Datei an.</p> </li> <li> <p>Das Script:</p> <ul> <li>entschl\u00fcsselt die Datei</li> <li>extrahiert sie in <code>./data/db-restore/</code></li> <li>kopiert sie in den Container</li> <li>stellt sie mit <code>mongorestore --drop</code> wieder her</li> </ul> </li> </ol>"},{"location":"configuration/database/backups-restore/#testen","title":"Testen","text":"<ul> <li> <p>Backup erstellen:</p> <pre><code>bash backup/backup.sh\n</code></pre> </li> <li> <p>Restore durchf\u00fchren:</p> <pre><code>bash backup/restore.sh\n</code></pre> </li> </ul> <p>Die Wiederhetstellung funktioniert mit allen unterst\u00fctzten Backup-Formaten (strukturierte Dumps oder <code>.archive</code>-basierte Dumps).</p>"},{"location":"configuration/database/mongodb/","title":"\ud83d\udd17 Externer Zugriff MongoDB Compass","text":"<p>Es ist m\u00f6glich sich extern \u00fcber MongoDB Compass mit der Datenbank zu verbinden. Hierzu muss auf dem Server ein Endpunkt gegen aussen ge\u00f6ffnet werden:</p> <p><code>&lt;deine-server-url&gt;:27018</code></p> <p>Der Port kann in <code>docker-compose.yml</code> angepasst werden.</p> <p>In der <code>.env</code>-Datei muss jetzt ein sicheres Passwort bei <code>MONGO_INITDB_ROOT_PASSWORD</code> gesetzt werden (mind. 20 Stellen inkl. Symbole und Zahlen).</p> <p>Danach kannst du dich mit MongoDB Compass verbinden und einloggen. M\u00f6glichkeiten:</p> <ul> <li>Add new connection &gt; Advanced Connection Options &gt; Authentication (dann Username/Password eingeben)</li> <li>URI: <code>mongodb://admin:***@&lt;deine-serer-url&gt;:27018/</code> (ersetze \"***\" mit dem Passwort)</li> </ul> <p>Wichtiger Hinweis: Es gibt momentan keine zus\u00e4tzliche Sicherheits-Barriere, bis auf dieses Passwort. Der User hat damit Admin-Rechte in der Datenbank und somit volle Zugriffskontrolle. Behandle das Passwort streng geheim oder lass den Endpunkt geschlossen, falls du ihn nicht ben\u00f6tigst.</p>"},{"location":"configuration/development/api-endpoints/","title":"\ud83d\udd0c API-Endpunkte","text":"<p>Vollst\u00e4ndige Dokumentation aller REST API-Endpunkte der clanscore-api.</p>"},{"location":"configuration/development/api-endpoints/#base-url","title":"Base URL","text":"<ul> <li>Lokal: <code>http://localhost:3000/api</code></li> <li>Production: <code>http://your-server:3000/api</code> oder <code>https://your-domain.com/api</code></li> </ul>"},{"location":"configuration/development/api-endpoints/#authentifizierung","title":"Authentifizierung","text":"<p>Die meisten Endpunkte erfordern JWT-Authentifizierung. Sende den Token im <code>Authorization</code> Header:</p> <pre><code>Authorization: Bearer &lt;jwt-token&gt;\n</code></pre>"},{"location":"configuration/development/api-endpoints/#endpunkte","title":"Endpunkte","text":""},{"location":"configuration/development/api-endpoints/#benutzer-users","title":"Benutzer (Users)","text":"<p>Base: <code>/api/user</code></p> Methode Endpunkt Beschreibung GET <code>/</code> Alle Benutzer abrufen GET <code>/firstUser</code> Ersten Benutzer abrufen GET <code>/:personId</code> Benutzer nach ID abrufen GET <code>/by-discord/:discordId</code> Benutzer nach Discord ID abrufen GET <code>/by-discord/:discordId/data</code> Benutzerdaten nach Discord ID abrufen GET <code>/by-role/:roleName</code> Benutzer nach Rollenname abrufen POST <code>/sync</code> Benutzer synchronisieren PATCH <code>/</code> Benutzer speichern PATCH <code>/:personId</code> Benutzer aktualisieren DELETE <code>/:personId</code> Benutzer l\u00f6schen <p>Bewerbungen:</p> Methode Endpunkt Beschreibung GET <code>/application/temp/by-discord/:discordId</code> Tempor\u00e4re Bewerbungsdaten abrufen PATCH <code>/application/temp/by-discord/:discordId</code> Tempor\u00e4re Bewerbungsdaten aktualisieren DELETE <code>/application/temp/by-discord/:discordId</code> Tempor\u00e4re Bewerbungsdaten l\u00f6schen POST <code>/:personId/application/accept</code> Bewerbung akzeptieren POST <code>/:personId/application/deny</code> Bewerbung ablehnen GET <code>/:personId/application/is-pending</code> Pr\u00fcfen ob Bewerbung aussteht <p>Rollen:</p> Methode Endpunkt Beschreibung GET <code>/:personId/roles</code> Benutzer-Rollen abrufen POST <code>/:personId/roles</code> Rolle zu Benutzer hinzuf\u00fcgen DELETE <code>/:personId/roles/:roleId</code> Rolle von Benutzer entfernen PATCH <code>/:personId/role-status</code> Rollen-Status aktualisieren <p>Punkte:</p> Methode Endpunkt Beschreibung GET <code>/:personId/points</code> Punkte abrufen GET <code>/:personId/points/history</code> Punkte-Historie abrufen POST <code>/:personId/points/increment</code> Punkte erh\u00f6hen POST <code>/:personId/points/decrement</code> Punkte verringern"},{"location":"configuration/development/api-endpoints/#aufgaben-tasks","title":"Aufgaben (Tasks)","text":"<p>Base: <code>/api/tasks</code></p> Methode Endpunkt Beschreibung GET <code>/</code> Alle Aufgaben abrufen GET <code>/open</code> Offene Aufgaben abrufen GET <code>/open/:discordId</code> Offene Aufgaben f\u00fcr Benutzer GET <code>/done</code> Erledigte Aufgaben abrufen GET <code>/expired</code> Abgelaufene Aufgaben abrufen GET <code>/tasktypes</code> Alle Aufgabentypen abrufen GET <code>/:id</code> Aufgabe nach ID abrufen POST <code>/</code> Aufgabe erstellen PATCH <code>/:taskId</code> Aufgabe aktualisieren DELETE <code>/:taskId</code> Aufgabe l\u00f6schen POST <code>/:id/claim</code> Aufgabe beanspruchen POST <code>/:id/complete</code> Aufgabe als erledigt markieren POST <code>/:id/reward</code> Teilnehmer belohnen POST <code>/:id/responsible</code> Verantwortlichen setzen POST <code>/:id/details</code> Details setzen POST <code>/:id/completed</code> Als erledigt markieren <p>Teilnehmer:</p> Methode Endpunkt Beschreibung GET <code>/:id/participants</code> Teilnehmer einer Aufgabe GET <code>/participants/:id</code> Teilnehmer nach ID POST <code>/participants/:id/reset-completed</code> Teilnehmer-Status zur\u00fccksetzen"},{"location":"configuration/development/api-endpoints/#rollen-roles","title":"Rollen (Roles)","text":"<p>Base: <code>/api/roles</code></p> Methode Endpunkt Beschreibung GET <code>/</code> Alle Rollen abrufen POST <code>/</code> Rolle erstellen PATCH <code>/:roleId</code> Rolle aktualisieren DELETE <code>/:roleId</code> Rolle l\u00f6schen POST <code>/sync</code> Rollen synchronisieren"},{"location":"configuration/development/api-endpoints/#events","title":"Events","text":"<p>Base: <code>/api/events</code></p> Methode Endpunkt Beschreibung GET <code>/</code> Alle Event-Details abrufen GET <code>/upcoming</code> Anstehende Events abrufen GET <code>/:eventId</code> Event-Details nach ID PATCH <code>/</code> Event-Details aktualisieren"},{"location":"configuration/development/api-endpoints/#kalender-calendar","title":"Kalender (Calendar)","text":"<p>Base: <code>/api/calendar</code></p> Methode Endpunkt Beschreibung GET <code>/info/:guildId</code> Kalender-Info abrufen PUT <code>/info/:guildId</code> Kalender-Info speichern GET <code>/link-url</code> OAuth-Link generieren GET <code>/callback</code> OAuth-Callback verarbeiten POST <code>/sync</code> Kalender synchronisieren POST <code>/from-discord/create</code> Event von Discord erstellen PATCH <code>/from-discord/update</code> Event von Discord aktualisieren GET <code>/provider-events</code> Provider-Events abrufen PATCH <code>/info/:guildId/overview-message</code> \u00dcbersichts-Nachricht speichern"},{"location":"configuration/development/api-endpoints/#ranglisten-leaderboards","title":"Ranglisten (Leaderboards)","text":"<p>Base: <code>/api/leaderboards</code></p> Methode Endpunkt Beschreibung GET <code>/</code> Alle Ranglisten abrufen POST <code>/</code> Rangliste erstellen"},{"location":"configuration/development/api-endpoints/#belohnungen-rewards","title":"Belohnungen (Rewards)","text":"<p>Base: <code>/api/rewards</code></p> Methode Endpunkt Beschreibung GET <code>/</code> Alle Belohnungen abrufen POST <code>/</code> Belohnung erstellen PATCH <code>/:rewardId</code> Belohnung aktualisieren DELETE <code>/:rewardId</code> Belohnung l\u00f6schen POST <code>/:id/claim</code> Belohnung einfordern POST <code>/accept-claim</code> Belohnungs-Anforderung akzeptieren POST <code>/deny-claim</code> Belohnungs-Anforderung ablehnen"},{"location":"configuration/development/api-endpoints/#spenden-donations","title":"Spenden (Donations)","text":"<p>Base: <code>/api/donations</code></p> Methode Endpunkt Beschreibung POST <code>/</code> Spende speichern PATCH <code>/:id/donor</code> Spender aktualisieren GET <code>/by-person/:personId</code> Spenden nach Person"},{"location":"configuration/development/api-endpoints/#transaktionen-transactions","title":"Transaktionen (Transactions)","text":"<p>Base: <code>/api/transactions</code></p> Methode Endpunkt Beschreibung GET <code>/</code> Alle Transaktionen abrufen GET <code>/by-person/:personId</code> Transaktionen nach Person"},{"location":"configuration/development/api-endpoints/#authentifizierung-auth","title":"Authentifizierung (Auth)","text":"<p>Base: <code>/api/auth</code></p> Methode Endpunkt Beschreibung POST <code>/login</code> Einloggen POST <code>/register</code> Registrieren GET <code>/logout</code> Ausloggen"},{"location":"configuration/development/api-endpoints/#fehlerbehandlung","title":"Fehlerbehandlung","text":"<p>Alle Endpunkte verwenden ein standardisiertes Fehlerformat:</p> <pre><code>{\n  \"error\": {\n    \"code\": \"ERROR_CODE\",\n    \"message\": \"Fehlerbeschreibung\",\n    \"details\": {}\n  }\n}\n</code></pre>"},{"location":"configuration/development/api-endpoints/#rate-limiting","title":"Rate Limiting","text":"<p>Aktuell gibt es keine Rate-Limits. F\u00fcr Production sollten Rate-Limits implementiert werden.</p>"},{"location":"configuration/development/api-endpoints/#weitere-informationen","title":"Weitere Informationen","text":"<ul> <li>Architektur - System-Architektur</li> <li>Webhooks - Webhook-Integration</li> <li>Konfiguration - Setup-Anleitung</li> </ul>"},{"location":"configuration/development/architecture/","title":"\ud83c\udfd7\ufe0f Architektur","text":"<p>\u00dcbersicht \u00fcber die Architektur des ClansCore-Systems.</p>"},{"location":"configuration/development/architecture/#system-ubersicht","title":"System-\u00dcbersicht","text":"<p>ClansCore folgt einer Clean Architecture mit klarer Trennung der Schichten:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Presentation Layer              \u2502\n\u2502  (Routes, Controllers, Middleware)      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502        Application Layer                \u2502\n\u2502  (Use Cases, Business Logic)            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Domain Layer                   \u2502\n\u2502  (Entities, Value Objects)             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      Infrastructure Layer               \u2502\n\u2502  (Database, External Services)         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"configuration/development/architecture/#komponenten","title":"Komponenten","text":""},{"location":"configuration/development/architecture/#1-clanscore-api","title":"1. clanscore-api","text":"<p>Technologie: Node.js, Express, TypeScript</p> <p>Struktur: <pre><code>apps/clanscore-api/src/\n\u251c\u2500\u2500 presentation/          # API Layer\n\u2502   \u251c\u2500\u2500 routes/           # Route-Definitionen\n\u2502   \u251c\u2500\u2500 controllers/      # Request-Handler\n\u2502   \u2514\u2500\u2500 middleware/       # Middleware (Validation, Errors)\n\u251c\u2500\u2500 application/          # Business Logic\n\u2502   \u251c\u2500\u2500 user/            # User Use Cases\n\u2502   \u251c\u2500\u2500 gamification/    # Points, Rewards, Leaderboards\n\u2502   \u251c\u2500\u2500 event/           # Event Management\n\u2502   \u2514\u2500\u2500 notifications/   # Notification Adapters\n\u251c\u2500\u2500 domain/              # Domain Models\n\u2502   \u251c\u2500\u2500 user/           # User Entities\n\u2502   \u251c\u2500\u2500 gamification/   # Points, Rewards\n\u2502   \u2514\u2500\u2500 event/          # Event Entities\n\u2514\u2500\u2500 infrastructure/      # External Services\n    \u251c\u2500\u2500 database/       # MongoDB Integration\n    \u251c\u2500\u2500 external/       # Discord, Google Calendar\n    \u2514\u2500\u2500 notifications/  # Notification Services\n</code></pre></p> <p>Hauptfunktionen: - REST API f\u00fcr Dashboard und Discord Bot - Benutzerverwaltung - Gamification (Punkte, Belohnungen, Ranglisten) - Event-Management - Kalender-Synchronisation - Webhook-Integration</p>"},{"location":"configuration/development/architecture/#2-dashboard","title":"2. dashboard","text":"<p>Technologie: Angular, TypeScript</p> <p>Struktur: <pre><code>apps/dashboard/src/\n\u251c\u2500\u2500 app/\n\u2502   \u251c\u2500\u2500 components/      # UI Components\n\u2502   \u251c\u2500\u2500 services/        # API Services\n\u2502   \u251c\u2500\u2500 models/          # Data Models\n\u2502   \u2514\u2500\u2500 guards/         # Route Guards\n\u2514\u2500\u2500 environments/       # Environment Configs\n</code></pre></p> <p>Hauptfunktionen: - Benutzerverwaltung - Aufgaben-Management - Event-Verwaltung - Ranglisten-Verwaltung - Belohnungen-Verwaltung - Rollen-Management</p>"},{"location":"configuration/development/architecture/#3-discord-bot","title":"3. discord-bot","text":"<p>Technologie: Node.js, Discord.js, TypeScript</p> <p>Struktur: <pre><code>apps/discord-bot/src/\n\u251c\u2500\u2500 commands/           # Discord Slash Commands\n\u251c\u2500\u2500 api/               # API Client\n\u251c\u2500\u2500 intergration/      # Discord Integrations\n\u251c\u2500\u2500 web/              # Webhook Server\n\u2514\u2500\u2500 utils-discord/    # Discord Utilities\n</code></pre></p> <p>Hauptfunktionen: - Slash Commands f\u00fcr Mitglieder - Event-Synchronisation - Aufgaben-Management - Webhook-Endpoints f\u00fcr API - Automatisierte Benachrichtigungen</p>"},{"location":"configuration/development/architecture/#datenfluss","title":"Datenfluss","text":""},{"location":"configuration/development/architecture/#benutzer-registrierung","title":"Benutzer-Registrierung","text":"<pre><code>Discord User\n    \u2193 (/join command)\nDiscord Bot\n    \u2193 (API Call)\nclanscore-api\n    \u2193 (Save to DB)\nMongoDB\n    \u2193 (Webhook)\nDiscord Bot\n    \u2193 (Notify Vorstand)\nDiscord Channel\n</code></pre>"},{"location":"configuration/development/architecture/#aufgaben-management","title":"Aufgaben-Management","text":"<pre><code>Vorstand (Dashboard)\n    \u2193 (Create Task)\nclanscore-api\n    \u2193 (Save to DB)\nMongoDB\n    \u2193 (Webhook)\nDiscord Bot\n    \u2193 (Post in Channel)\nDiscord #aufgaben\n</code></pre>"},{"location":"configuration/development/architecture/#event-synchronisation","title":"Event-Synchronisation","text":"<pre><code>Google Calendar\n    \u2193 (Sync Command)\nDiscord Bot\n    \u2193 (API Call)\nclanscore-api\n    \u2193 (Save to DB)\nMongoDB\n    \u2193 (Webhook)\nDiscord Bot\n    \u2193 (Update Channel)\nDiscord #events\n</code></pre>"},{"location":"configuration/development/architecture/#datenbank-schema","title":"Datenbank-Schema","text":""},{"location":"configuration/development/architecture/#haupt-entitaten","title":"Haupt-Entit\u00e4ten","text":"<ul> <li>Person: Benutzer/Mitglieder</li> <li>Role: Discord-Rollen</li> <li>Task: Aufgaben</li> <li>Event: Events/Kalender</li> <li>Reward: Belohnungen</li> <li>Leaderboard: Ranglisten</li> <li>Transaction: Punkte-Transaktionen</li> <li>Donation: Spenden</li> </ul>"},{"location":"configuration/development/architecture/#beziehungen","title":"Beziehungen","text":"<ul> <li>Person \u2194 Role (Many-to-Many)</li> <li>Person \u2194 Task (Many-to-Many via Participants)</li> <li>Person \u2194 Transaction (One-to-Many)</li> <li>Event \u2194 Calendar (One-to-One)</li> </ul>"},{"location":"configuration/development/architecture/#kommunikation-zwischen-services","title":"Kommunikation zwischen Services","text":""},{"location":"configuration/development/architecture/#api-discord-bot","title":"API \u2194 Discord Bot","text":"<p>Webhooks: - API sendet Webhooks an Discord Bot - Endpoint: <code>http://discord-bot:3001/api/notifications/*</code> - Authentifizierung: <code>x-webhook-token</code> Header</p> <p>Webhook-Endpunkte: - <code>/user-status</code> - Benutzer-Status-\u00c4nderungen - <code>/role-changed</code> - Rollen-\u00c4nderungen - <code>/role-updated</code> - Rollen-Updates</p>"},{"location":"configuration/development/architecture/#dashboard-api","title":"Dashboard \u2194 API","text":"<p>REST API: - Base URL: <code>http://localhost:3000/api</code> (lokal) - Authentifizierung: JWT Tokens - CORS: Konfiguriert f\u00fcr Dashboard-Origin</p>"},{"location":"configuration/development/architecture/#shared-package","title":"Shared Package","text":"<p>Ein gemeinsames Package (<code>shared/</code>) enth\u00e4lt:</p> <ul> <li>DTOs: Data Transfer Objects f\u00fcr API-Kommunikation</li> <li>Validation: Gemeinsame Validierungs-Logik</li> <li>Error Types: Standardisierte Fehlertypen</li> <li>Channel Names: Discord Channel-Konstanten</li> </ul>"},{"location":"configuration/development/architecture/#sicherheit","title":"Sicherheit","text":""},{"location":"configuration/development/architecture/#authentifizierung","title":"Authentifizierung","text":"<ul> <li>JWT Tokens f\u00fcr Dashboard-API-Zugriff</li> <li>Webhook Secrets f\u00fcr API \u2194 Bot Kommunikation</li> <li>OAuth 2.0 f\u00fcr Google Calendar</li> </ul>"},{"location":"configuration/development/architecture/#autorisierung","title":"Autorisierung","text":"<ul> <li>Rollen-basiert (Mitglied, Vorstand, Admin)</li> <li>Middleware f\u00fcr Route-Protection</li> <li>Discord Permissions f\u00fcr Bot-Commands</li> </ul>"},{"location":"configuration/development/architecture/#deployment","title":"Deployment","text":""},{"location":"configuration/development/architecture/#docker-compose","title":"Docker Compose","text":"<p>Alle Services werden in Docker Containern orchestriert:</p> <ul> <li><code>mongodb</code>: Datenbank</li> <li><code>clanscore-api</code>: REST API</li> <li><code>discord-bot</code>: Discord Bot</li> <li><code>dashboard</code>: Frontend (Nginx)</li> </ul>"},{"location":"configuration/development/architecture/#netzwerk","title":"Netzwerk","text":"<ul> <li>Alle Services im gleichen Docker-Netzwerk</li> <li>Interne Kommunikation \u00fcber Service-Namen</li> <li>Externe Ports nur f\u00fcr notwendige Services</li> </ul>"},{"location":"configuration/development/architecture/#weitere-informationen","title":"Weitere Informationen","text":"<ul> <li>API-Endpunkte - Vollst\u00e4ndige API-Dokumentation</li> <li>Webhooks - Webhook-Integration</li> <li>Datenbank - Datenbank-Backups</li> </ul>"},{"location":"configuration/development/testing/","title":"\ud83e\uddea Testing-Strategie","text":"<p>Diese Dokumentation beschreibt die Testing-Strategie f\u00fcr das ClansCore-Projekt, einschliesslich der verwendeten Frameworks und Tools f\u00fcr Unit- und Integrationtests.</p>"},{"location":"configuration/development/testing/#ubersicht","title":"\u00dcbersicht","text":"<p>Das ClansCore-Projekt verwendet unterschiedliche Testing-Frameworks f\u00fcr die verschiedenen Komponenten:</p> Komponente Testing-Framework Test Runner Test-Umgebung Dashboard Jasmine Karma Browser Discord-Bot Jest Jest Node.js"},{"location":"configuration/development/testing/#dashboard-jasmine-karma","title":"Dashboard - Jasmine &amp; Karma","text":""},{"location":"configuration/development/testing/#framework-ubersicht","title":"Framework-\u00dcbersicht","text":"<p>Die Unit- und Integrationtests des Admin-Dashboards werden mit dem Jasmine-Testing-Framework umgesetzt, welches standardm\u00e4ssig in Angular-Projekten integriert ist. Als Test Runner kommt Karma zum Einsatz, der die automatisierte Ausf\u00fchrung der Tests in einer browserbasierten Testumgebung erm\u00f6glicht.</p>"},{"location":"configuration/development/testing/#konfiguration","title":"Konfiguration","text":"<p>Dependencies (<code>apps/dashboard/package.json</code>): - <code>jasmine-core: ~5.2.0</code> - Jasmine Testing Framework - <code>@types/jasmine: ~5.1.0</code> - TypeScript-Typen f\u00fcr Jasmine - <code>karma: ~6.4.0</code> - Test Runner - <code>karma-jasmine: ~5.1.0</code> - Karma-Plugin f\u00fcr Jasmine - <code>karma-chrome-launcher: ~3.2.0</code> - Chrome-Launcher f\u00fcr Tests - <code>karma-coverage: ~2.2.0</code> - Code-Coverage-Reporting - <code>karma-jasmine-html-reporter: ~2.1.0</code> - HTML-Reporter f\u00fcr Test-Ergebnisse</p> <p>Angular-Konfiguration (<code>angular.json</code>): <pre><code>\"test\": {\n  \"builder\": \"@angular-devkit/build-angular:karma\",\n  \"options\": {\n    \"polyfills\": [\"zone.js\", \"zone.js/testing\"],\n    \"tsConfig\": \"tsconfig.spec.json\",\n    \"inlineStyleLanguage\": \"scss\"\n  }\n}\n</code></pre></p>"},{"location":"configuration/development/testing/#test-implementierung","title":"Test-Implementierung","text":"<p>Die Tests werden \u00fcber die Angular Testing Utilities (TestBed) implementiert. Dadurch k\u00f6nnen neben isolierten Unit-Tests auch Integrationstests durchgef\u00fchrt werden, bei denen das Zusammenspiel einzelner Komponenten \u00fcberpr\u00fcft wird.</p> <p>Beispiel-Test (<code>apps/dashboard/src/app/app.component.spec.ts</code>): <pre><code>import { TestBed } from '@angular/core/testing';\nimport { AppComponent } from './app.component';\n\ndescribe('AppComponent', () =&gt; {\n  beforeEach(async () =&gt; {\n    await TestBed.configureTestingModule({\n      imports: [AppComponent],\n      providers: [provideTestStore()]\n    }).compileComponents();\n  });\n\n  it('should create the app', () =&gt; {\n    const fixture = TestBed.createComponent(AppComponent);\n    const app = fixture.componentInstance;\n    expect(app).toBeTruthy();\n  });\n});\n</code></pre></p>"},{"location":"configuration/development/testing/#test-ausfuhrung","title":"Test-Ausf\u00fchrung","text":"<p>Die Testausf\u00fchrung erfolgt lokal \u00fcber den Befehl: <pre><code>npm test\n# oder\nng test\n</code></pre></p> <p>Dies startet Karma, \u00f6ffnet einen Browser und f\u00fchrt alle Tests aus. Die Tests werden automatisch neu ausgef\u00fchrt, wenn sich Dateien \u00e4ndern (Watch-Mode).</p>"},{"location":"configuration/development/testing/#test-struktur","title":"Test-Struktur","text":"<p>Test-Dateien: Alle Test-Dateien haben das Suffix <code>.spec.ts</code> und befinden sich neben den zu testenden Komponenten.</p> <p>Beispiele: - <code>app.component.spec.ts</code> - Tests f\u00fcr die Root-Komponente - <code>user-page.component.spec.ts</code> - Tests f\u00fcr die User-Page-Komponente - <code>user-table.component.spec.ts</code> - Tests f\u00fcr die User-Table-Komponente - <code>auth.guard.spec.ts</code> - Tests f\u00fcr den Auth Guard</p> <p>Aktuell: 29 Test-Dateien im Dashboard-Projekt</p>"},{"location":"configuration/development/testing/#test-typen","title":"Test-Typen","text":"<ol> <li>Unit-Tests: Isolierte Tests einzelner Komponenten, Services oder Guards</li> <li>Integration-Tests: Tests, die das Zusammenspiel mehrerer Komponenten \u00fcberpr\u00fcfen (mit TestBed)</li> </ol>"},{"location":"configuration/development/testing/#discord-bot-jest","title":"Discord-Bot - Jest","text":""},{"location":"configuration/development/testing/#framework-ubersicht_1","title":"Framework-\u00dcbersicht","text":"<p>Die Unit- und Integrationtests des Discord-Bots werden mit dem Jest-Testing-Framework umgesetzt. Jest ist ein modernes, JavaScript-basiertes Testing-Framework, das speziell f\u00fcr Node.js-Anwendungen optimiert ist und eine schnelle Testausf\u00fchrung sowie umfangreiche Mocking-Funktionen bietet.</p>"},{"location":"configuration/development/testing/#konfiguration_1","title":"Konfiguration","text":"<p>Dependencies (<code>apps/discord-bot/package.json</code>): - <code>jest: ^29.0.0</code> - Jest Testing Framework - <code>@types/jest: ^29.5.14</code> - TypeScript-Typen f\u00fcr Jest - <code>ts-jest: ^29.4.6</code> - TypeScript-Transformer f\u00fcr Jest</p> <p>Jest-Konfiguration (<code>jest.config.cjs</code>): <pre><code>module.exports = {\n    preset: 'ts-jest',\n    testEnvironment: 'node',\n    roots: ['&lt;rootDir&gt;/src', '&lt;rootDir&gt;/tests'],\n    testMatch: ['**/__tests__/**/*.ts', '**/?(*.)+(spec|test).ts'],\n    transform: {\n        '^.+\\\\.ts$': ['ts-jest', {\n            tsconfig: {\n                esModuleInterop: true,\n                allowSyntheticDefaultImports: true,\n            },\n        }],\n    },\n    moduleNameMapper: {\n        '^@clanscore/shared$': '&lt;rootDir&gt;/../../shared/src/index.ts',\n    },\n    collectCoverageFrom: [\n        'src/**/*.ts',\n        '!src/**/*.d.ts',\n    ],\n};\n</code></pre></p>"},{"location":"configuration/development/testing/#test-implementierung_1","title":"Test-Implementierung","text":"<p>Jest bietet umfangreiche Mocking-Funktionen, die f\u00fcr die Tests des Discord-Bots essentiell sind, da externe Dependencies (Discord.js, API-Calls) gemockt werden m\u00fcssen.</p> <p>Beispiel-Test (<code>apps/discord-bot/tests/ping.test.ts</code>): <pre><code>import { CommandInteraction } from \"discord.js\";\nimport { handlePing } from \"../src/commands/other/ping\";\nimport { api } from \"../src/api/apiClient\";\n\njest.mock(\"../src/api/apiClient\");\njest.mock(\"../src/config\", () =&gt; ({\n    config: {\n        CLANSCORE_API_URL: \"http://localhost:3000/api\",\n        CLANSCORE_API_KEY: \"test-key\",\n    },\n}));\n\nconst mockApi = api as jest.Mocked&lt;typeof api&gt;;\n\ndescribe(\"ping command\", () =&gt; {\n    let interaction: CommandInteraction;\n\n    beforeEach(() =&gt; {\n        interaction = {\n            reply: jest.fn(),\n            deferReply: jest.fn(),\n            editReply: jest.fn(),\n        } as unknown as CommandInteraction;\n    });\n\n    it(\"replies with the first user name if user is found\", async () =&gt; {\n        mockApi.getFirstUser.mockResolvedValue(ok({...}));\n        await handlePing(interaction);\n        expect(interaction.editReply).toHaveBeenCalled();\n    });\n});\n</code></pre></p>"},{"location":"configuration/development/testing/#test-ausfuhrung_1","title":"Test-Ausf\u00fchrung","text":"<p>Die Testausf\u00fchrung erfolgt lokal \u00fcber den Befehl: <pre><code>npm test\n# oder\njest\n</code></pre></p> <p>Jest f\u00fchrt alle Tests in der Node.js-Umgebung aus und bietet Optionen f\u00fcr Watch-Mode, Coverage-Reports und Filterung nach Dateinamen.</p>"},{"location":"configuration/development/testing/#test-struktur_1","title":"Test-Struktur","text":"<p>Test-Dateien: Alle Test-Dateien haben das Suffix <code>.test.ts</code> und befinden sich im <code>tests/</code> Verzeichnis.</p> <p>Beispiele: - <code>ping.test.ts</code> - Tests f\u00fcr den Ping-Command - <code>join.test.ts</code> - Tests f\u00fcr den Join-Command - <code>createTask.test.ts</code> - Tests f\u00fcr Task-Erstellung - <code>syncusers.test.ts</code> - Tests f\u00fcr User-Synchronisation</p> <p>Aktuell: 17 Test-Dateien im Discord-Bot-Projekt</p>"},{"location":"configuration/development/testing/#test-typen_1","title":"Test-Typen","text":"<ol> <li>Unit-Tests: Isolierte Tests einzelner Commands oder Funktionen mit gemockten Dependencies</li> <li>Integration-Tests: Tests, die das Zusammenspiel mehrerer Module \u00fcberpr\u00fcfen (z.B. Command \u2192 API \u2192 Response)</li> </ol>"},{"location":"configuration/development/testing/#mocking-strategie","title":"Mocking-Strategie","text":"<p>Jest erm\u00f6glicht umfangreiches Mocking: - Module-Mocks: <code>jest.mock()</code> f\u00fcr externe Module - Function-Mocks: <code>jest.fn()</code> f\u00fcr einzelne Funktionen - API-Mocks: Mock-Implementierungen f\u00fcr API-Calls - Discord.js-Mocks: Mock-Objekte f\u00fcr Discord-Interactions</p>"},{"location":"configuration/development/testing/#vergleich-jasminekarma-vs-jest","title":"Vergleich: Jasmine/Karma vs. Jest","text":"Aspekt Jasmine/Karma (Dashboard) Jest (Discord-Bot) Umgebung Browser Node.js Test-Runner Karma (separat) Jest (integriert) Mocking Angular Testing Utilities Native Jest Mocks Coverage Karma Coverage Plugin Jest Coverage (integriert) Speed Abh\u00e4ngig von Browser Sehr schnell (V8) Watch-Mode \u2705 Unterst\u00fctzt \u2705 Unterst\u00fctzt TypeScript \u2705 Unterst\u00fctzt \u2705 Unterst\u00fctzt (ts-jest)"},{"location":"configuration/development/testing/#best-practices","title":"Best Practices","text":""},{"location":"configuration/development/testing/#allgemein","title":"Allgemein","text":"<ol> <li>Test-Isolation: Jeder Test sollte unabh\u00e4ngig von anderen Tests sein</li> <li>AAA-Pattern: Arrange, Act, Assert</li> <li>Klare Test-Namen: Beschreibende <code>describe()</code> und <code>it()</code> Namen</li> <li>Mocking: Externe Dependencies sollten gemockt werden</li> <li>Coverage: Ziel: &gt;80% Code-Coverage</li> </ol>"},{"location":"configuration/development/testing/#dashboard-spezifisch","title":"Dashboard-spezifisch","text":"<ol> <li>TestBed verwenden: F\u00fcr Integration-Tests</li> <li>NoopAnimationsModule: F\u00fcr Tests ohne Animationen</li> <li>Test-Helpers: Wiederverwendbare Test-Utilities nutzen</li> <li>Component-Fixtures: F\u00fcr DOM-Tests</li> </ol>"},{"location":"configuration/development/testing/#discord-bot-spezifisch","title":"Discord-Bot-spezifisch","text":"<ol> <li>Module-Mocks: Externe Module am Anfang der Datei mocken</li> <li>Interaction-Mocks: Discord.js-Interactions vollst\u00e4ndig mocken</li> <li>API-Mocks: API-Calls mit <code>mockResolvedValue</code> / <code>mockRejectedValue</code> mocken</li> <li>Test-Isolation: <code>beforeEach</code> f\u00fcr Setup, <code>afterEach</code> f\u00fcr Cleanup</li> </ol>"},{"location":"configuration/development/testing/#test-ausfuhrung-in-cicd","title":"Test-Ausf\u00fchrung in CI/CD","text":""},{"location":"configuration/development/testing/#github-actions","title":"GitHub Actions","text":"<p>Tests k\u00f6nnen in GitHub Actions Workflows integriert werden:</p> <pre><code>- name: Run Dashboard Tests\n  run: |\n    cd apps/dashboard\n    npm test -- --watch=false --browsers=ChromeHeadless\n\n- name: Run Discord-Bot Tests\n  run: |\n    cd apps/discord-bot\n    npm test -- --coverage\n</code></pre>"},{"location":"configuration/development/testing/#weiterfuhrende-informationen","title":"Weiterf\u00fchrende Informationen","text":"<ul> <li>Jasmine Dokumentation</li> <li>Karma Dokumentation</li> <li>Jest Dokumentation</li> <li>Angular Testing Guide</li> <li>TypeScript Testing Best Practices</li> </ul> <p>Letzte Aktualisierung: 2024-01-XX</p>"},{"location":"configuration/development/webhooks/","title":"\ud83d\udd14 Webhooks - Detaillierte Dokumentation","text":"<p>Dokumentation der Webhook-Integration zwischen ClansCore-api und discord-bot.</p>"},{"location":"configuration/development/webhooks/#ubersicht","title":"\u00dcbersicht","text":"<p>Webhooks erm\u00f6glichen die unidirektionale Kommunikation zwischen der clanscore-api und dem discord-bot. Die API sendet Webhooks an den Bot, um \u00fcber wichtige \u00c4nderungen zu informieren, die dann im Discord-Server verarbeitet werden.</p>"},{"location":"configuration/development/webhooks/#kommunikationsfluss","title":"Kommunikationsfluss","text":"<pre><code>clanscore-api (Sender)\n    \u2193 HTTP POST Request\n    \u2193 x-webhook-token Header\ndiscord-bot Webhook Server (Empf\u00e4nger)\n    \u2193 Verarbeitung\n    \u2193 Discord API Aufrufe\nDiscord Server (Aktion)\n</code></pre>"},{"location":"configuration/development/webhooks/#verwendungszwecke","title":"Verwendungszwecke","text":"<ul> <li>Benutzer-Status-\u00c4nderungen: Bewerbungen akzeptieren/ablehnen</li> <li>Rollen-Management: Rollen hinzuf\u00fcgen/entfernen, Rollen aktualisieren</li> <li>Synchronisierung: Automatische User-Synchronisierung via Cron-Job</li> </ul>"},{"location":"configuration/development/webhooks/#architektur","title":"Architektur","text":""},{"location":"configuration/development/webhooks/#komponenten","title":"Komponenten","text":""},{"location":"configuration/development/webhooks/#1-clanscore-api-sender","title":"1. clanscore-api (Sender)","text":"<p>Datei: <code>apps/clanscore-api/src/application/notifications/adapters/discord.adapter.ts</code></p> <ul> <li>DiscordAdapter: Implementiert <code>PlatformAdapter</code> Interface</li> <li>NotificationService: Broadcastet Events an alle registrierten Adapter</li> <li>HTTP Client: Verwendet <code>fetch()</code> f\u00fcr Webhook-Requests</li> </ul>"},{"location":"configuration/development/webhooks/#2-discord-bot-empfanger","title":"2. discord-bot (Empf\u00e4nger)","text":"<p>Datei: <code>apps/discord-bot/src/web/routes/webhook.routes.ts</code></p> <ul> <li>Express Router: Empf\u00e4ngt Webhook-Requests</li> <li>Zod Validation: Validiert Request-Bodies</li> <li>Discord.js Client: F\u00fchrt Discord-Aktionen aus</li> </ul>"},{"location":"configuration/development/webhooks/#datenfluss","title":"Datenfluss","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Dashboard/API  \u2502\n\u2502   (Trigger)      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Notification    \u2502\n\u2502 Service         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      HTTP POST      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 DiscordAdapter  \u2502 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba \u2502 Webhook Router  \u2502\n\u2502  (clanscore-api)\u2502   x-webhook-token   \u2502  (discord-bot)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                                   \u2502\n                                                   \u25bc\n                                          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                          \u2502 Discord API      \u2502\n                                          \u2502 (Rollen, DMs)    \u2502\n                                          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"configuration/development/webhooks/#konfiguration","title":"Konfiguration","text":""},{"location":"configuration/development/webhooks/#umgebungs-variablen","title":"Umgebungs-Variablen","text":"Variable Beschreibung Beispiel Erforderlich <code>WEBHOOK_SHARED_SECRET</code> Geheimer Schl\u00fcssel f\u00fcr Authentifizierung <code>mein_geheimer_schl\u00fcssel_123</code> \u2705 Ja <code>DISCORD_BOT_WEBHOOK_URL</code> URL des Discord Bot Webhook-Servers <code>http://discord-bot:3001</code> \u2705 Ja <code>DISCORD_SERVER_PORT</code> Port f\u00fcr Webhook-Server <code>3001</code> \u274c Nein (Standard: 3001)"},{"location":"configuration/development/webhooks/#setup","title":"Setup","text":""},{"location":"configuration/development/webhooks/#1-secret-generieren","title":"1. Secret generieren","text":"<pre><code># Generiere einen sicheren Secret (mindestens 32 Zeichen)\nopenssl rand -hex 32\n</code></pre> <p>Beispiel-Output: <pre><code>a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6\n</code></pre></p>"},{"location":"configuration/development/webhooks/#2-in-beiden-services-setzen","title":"2. In beiden Services setzen","text":"<p>clanscore-api (<code>.env</code>): <pre><code>WEBHOOK_SHARED_SECRET=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6\nDISCORD_BOT_WEBHOOK_URL=http://discord-bot:3001\n</code></pre></p> <p>discord-bot (<code>.env</code>): <pre><code>WEBHOOK_SHARED_SECRET=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z6\nDISCORD_SERVER_PORT=3001\n</code></pre></p>"},{"location":"configuration/development/webhooks/#3-docker-compose","title":"3. Docker Compose","text":"<p>docker-compose.yml: <pre><code>services:\n  clanscore-api:\n    environment:\n      - WEBHOOK_SHARED_SECRET=${WEBHOOK_SHARED_SECRET}\n      - DISCORD_BOT_WEBHOOK_URL=${DISCORD_BOT_WEBHOOK_URL:-http://discord-bot:3001}\n\n  discord-bot:\n    environment:\n      - WEBHOOK_SHARED_SECRET=${WEBHOOK_SHARED_SECRET}\n      - DISCORD_SERVER_PORT=${DISCORD_SERVER_PORT:-3001}\n</code></pre></p>"},{"location":"configuration/development/webhooks/#base-urls","title":"Base URLs","text":"Umgebung Base URL Lokal <code>http://localhost:3001/api/notifications</code> Docker <code>http://discord-bot:3001/api/notifications</code> Production <code>http://&lt;server-ip&gt;:3001/api/notifications</code>"},{"location":"configuration/development/webhooks/#authentifizierung","title":"Authentifizierung","text":""},{"location":"configuration/development/webhooks/#header-basierte-authentifizierung","title":"Header-basierte Authentifizierung","text":"<p>Alle Webhook-Requests m\u00fcssen den Secret im Header enthalten:</p> <pre><code>x-webhook-token: &lt;WEBHOOK_SHARED_SECRET&gt;\n</code></pre>"},{"location":"configuration/development/webhooks/#validierung-im-bot","title":"Validierung im Bot","text":"<p>Datei: <code>apps/discord-bot/src/web/routes/webhook.routes.ts</code></p> <pre><code>function verifySecret(req: express.Request): string | boolean {\n    const token = req.header(\"x-webhook-token\") ?? \"\";\n    return config.WEBHOOK_SHARED_SECRET &amp;&amp; token === config.WEBHOOK_SHARED_SECRET;\n}\n</code></pre>"},{"location":"configuration/development/webhooks/#fehler-bei-ungultiger-authentifizierung","title":"Fehler bei ung\u00fcltiger Authentifizierung","text":"<p>Status Code: <code>401 Unauthorized</code></p> <p>Response: <pre><code>{\n  \"error\": \"Unauthorized\"\n}\n</code></pre></p>"},{"location":"configuration/development/webhooks/#webhook-endpunkte","title":"Webhook-Endpunkte","text":""},{"location":"configuration/development/webhooks/#ubersicht_1","title":"\u00dcbersicht","text":"Endpoint Methode Beschreibung Trigger <code>/api/notifications/user-status</code> POST Benutzer-Status-\u00c4nderung Bewerbung akzeptiert/abgelehnt <code>/api/notifications/role-changed</code> POST Rollen-\u00c4nderung Rollen im Dashboard ge\u00e4ndert <code>/api/notifications/role-updated</code> POST Rollen-Update Rolle im Dashboard aktualisiert <code>/api/notifications/sync-users</code> POST User-Synchronisierung Cron-Job oder manuell"},{"location":"configuration/development/webhooks/#1-benutzer-status-anderung","title":"1. Benutzer-Status-\u00c4nderung","text":"<p>Endpoint: <code>POST /api/notifications/user-status</code></p> <p>Wird aufgerufen wenn: - Eine Bewerbung akzeptiert wird - Eine Bewerbung abgelehnt wird</p> <p>Implementierung: - Sender: <code>DiscordAdapter.onApplicationAccepted()</code> / <code>onApplicationDenied()</code> - Empf\u00e4nger: <code>webhookRouter.post(\"/user-status\")</code></p>"},{"location":"configuration/development/webhooks/#request-body-schema-zod","title":"Request Body Schema (Zod)","text":"<pre><code>const UserStatusSchema = z.object({\n  discordId: z.string().min(1),\n  status: z.enum([\"Accepted\", \"Denied\"]),\n  guildId: z.string().min(1).optional(),\n  roleName: z.string().min(1).optional(), // nur bei Accepted n\u00f6tig\n});\n</code></pre>"},{"location":"configuration/development/webhooks/#request-body","title":"Request Body","text":"<p>Status: Accepted <pre><code>{\n  \"discordId\": \"123456789012345678\",\n  \"status\": \"Accepted\",\n  \"guildId\": \"987654321098765432\",\n  \"roleName\": \"Mitglied\"\n}\n</code></pre></p> <p>Status: Denied <pre><code>{\n  \"discordId\": \"123456789012345678\",\n  \"status\": \"Denied\",\n  \"guildId\": \"987654321098765432\"\n}\n</code></pre></p>"},{"location":"configuration/development/webhooks/#verhalten","title":"Verhalten","text":"<p>Bei \"Accepted\": 1. \u2705 Rolle wird dem Benutzer hinzugef\u00fcgt (falls <code>roleName</code> angegeben) 2. \u2705 DM wird an den Benutzer gesendet: <code>\"\u2705 Hallo &lt;@user&gt;, deine Bewerbung wurde **angenommen**! Willkommen im Verein \ud83c\udf89\"</code></p> <p>Bei \"Denied\": 1. \u2705 Rollen \"Mitglied\" und \"Vorstand\" werden entfernt (falls vorhanden) 2. \u2705 DM wird an den Benutzer gesendet: <code>\"\ud83d\udeab Hallo &lt;@user&gt;, leider wurde deine Bewerbung **abgelehnt**. Falls du Fragen hast, melde dich beim Vorstand.\"</code></p>"},{"location":"configuration/development/webhooks/#response","title":"Response","text":"<p>Erfolg: <pre><code>{\n  \"ok\": true\n}\n</code></pre></p> <p>Fehler: <pre><code>{\n  \"error\": \"Unauthorized\"\n}\n</code></pre> <pre><code>{\n  \"error\": \"Guild not found\"\n}\n</code></pre> <pre><code>{\n  \"error\": \"Member not found\"\n}\n</code></pre> <pre><code>{\n  \"error\": \"Role not found\"\n}\n</code></pre> <pre><code>{\n  \"error\": \"ValidationError\",\n  \"details\": [\n    {\n      \"path\": [\"discordId\"],\n      \"message\": \"Required\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"configuration/development/webhooks/#status-codes","title":"Status Codes","text":"Code Bedeutung <code>200</code> Erfolg <code>400</code> Validierungsfehler oder ung\u00fcltiger Status <code>401</code> Authentifizierungsfehler <code>404</code> Guild, Member oder Rolle nicht gefunden <code>500</code> Interner Serverfehler"},{"location":"configuration/development/webhooks/#2-rollen-anderung","title":"2. Rollen-\u00c4nderung","text":"<p>Endpoint: <code>POST /api/notifications/role-changed</code></p> <p>Wird aufgerufen wenn: - Einem Benutzer eine oder mehrere Rollen hinzugef\u00fcgt werden - Einem Benutzer eine oder mehrere Rollen entfernt werden - Rollen im Dashboard ge\u00e4ndert werden</p> <p>Implementierung: - Sender: <code>DiscordAdapter.onRoleChanged()</code> - Empf\u00e4nger: <code>webhookRouter.post(\"/role-changed\")</code></p>"},{"location":"configuration/development/webhooks/#request-body-schema-zod_1","title":"Request Body Schema (Zod)","text":"<pre><code>const RoleChangedSchema = z.object({\n    discordId: z.string().min(1),\n    username: z.string().min(1),\n    guildId: z.string().min(1).optional(),\n    addRoles: z.array(z.string()).optional().default([]),\n    removeRoles: z.array(z.string()).optional().default([]),\n    changedBy: z.string().optional(),\n});\n</code></pre>"},{"location":"configuration/development/webhooks/#request-body_1","title":"Request Body","text":"<pre><code>{\n  \"discordId\": \"123456789012345678\",\n  \"username\": \"Max Mustermann\",\n  \"guildId\": \"987654321098765432\",\n  \"addRoles\": [\"Vorstand\", \"Event-Manager\"],\n  \"removeRoles\": [\"Mitglied\"],\n  \"changedBy\": \"Admin Name\"\n}\n</code></pre>"},{"location":"configuration/development/webhooks/#verhalten_1","title":"Verhalten","text":"<ol> <li>\u2705 Rollen werden im Discord-Server hinzugef\u00fcgt/entfernt</li> <li>\u2705 Log-Nachricht wird im <code>bot-log</code> Channel gesendet (Discord Embed)</li> <li>\u2705 Fehler werden gesammelt und in der Response zur\u00fcckgegeben</li> </ol>"},{"location":"configuration/development/webhooks/#response_1","title":"Response","text":"<p>Erfolg: <pre><code>{\n  \"ok\": true,\n  \"addedRoles\": [\"Vorstand\", \"Event-Manager\"],\n  \"removedRoles\": [\"Mitglied\"],\n  \"errors\": [\"Rolle \\\"NichtExistierend\\\" nicht gefunden\"]\n}\n</code></pre></p> <p>Fehler: <pre><code>{\n  \"error\": \"Unauthorized\"\n}\n</code></pre> <pre><code>{\n  \"error\": \"Guild not found\"\n}\n</code></pre> <pre><code>{\n  \"error\": \"Member not found\"\n}\n</code></pre> <pre><code>{\n  \"error\": \"ValidationError\",\n  \"details\": [...]\n}\n</code></pre></p>"},{"location":"configuration/development/webhooks/#discord-embed-log-channel","title":"Discord Embed (Log-Channel)","text":"<pre><code>\ud83d\udd04 Rollen\u00e4nderung (Dashboard)\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\nBenutzer:        @Max Mustermann (Max Mustermann)\nGe\u00e4ndert von:    Admin Name\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\u2795 Hinzugef\u00fcgt:  `Vorstand`, `Event-Manager`\n\u2796 Entfernt:     `Mitglied`\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n</code></pre>"},{"location":"configuration/development/webhooks/#3-rollen-update","title":"3. Rollen-Update","text":"<p>Endpoint: <code>POST /api/notifications/role-updated</code></p> <p>Wird aufgerufen wenn: - Eine Rolle im Dashboard aktualisiert wird (Name, Farbe, etc.)</p> <p>Implementierung: - Sender: <code>DiscordAdapter.onRoleUpdated()</code> - Empf\u00e4nger: <code>webhookRouter.post(\"/role-updated\")</code></p>"},{"location":"configuration/development/webhooks/#request-body-schema-zod_2","title":"Request Body Schema (Zod)","text":"<pre><code>const RoleUpdatedSchema = z.object({\n    guildId: z.string().min(1).optional(),\n    oldName: z.string().min(1),\n    newName: z.string().min(1),\n    color: z.string().nullable().optional(),\n    permissions: z.string().nullable().optional(),\n    hoist: z.boolean().optional(),\n    mentionable: z.boolean().optional(),\n    changedBy: z.string().optional(),\n});\n</code></pre>"},{"location":"configuration/development/webhooks/#request-body_2","title":"Request Body","text":"<pre><code>{\n  \"guildId\": \"987654321098765432\",\n  \"oldName\": \"Mitglied\",\n  \"newName\": \"Aktives Mitglied\",\n  \"color\": \"#3498db\",\n  \"hoist\": true,\n  \"mentionable\": false,\n  \"changedBy\": \"Admin Name\"\n}\n</code></pre>"},{"location":"configuration/development/webhooks/#verhalten_2","title":"Verhalten","text":"<ol> <li>\u2705 Rolle wird im Discord-Server aktualisiert</li> <li>\u2705 Log-Nachricht wird im <code>bot-log</code> Channel gesendet (Discord Embed)</li> <li>\u2705 Nur ge\u00e4nderte Felder werden aktualisiert</li> </ol>"},{"location":"configuration/development/webhooks/#response_2","title":"Response","text":"<p>Erfolg: <pre><code>{\n  \"ok\": true,\n  \"changes\": [\n    \"Name: `Mitglied` \u2192 `Aktives Mitglied`\",\n    \"Farbe: `#000000` \u2192 `#3498db`\",\n    \"Hervorheben: `false` \u2192 `true`\"\n  ]\n}\n</code></pre></p> <p>Fehler: <pre><code>{\n  \"error\": \"Role \\\"Mitglied\\\" not found\"\n}\n</code></pre> <pre><code>{\n  \"error\": \"Failed to update role\"\n}\n</code></pre></p>"},{"location":"configuration/development/webhooks/#discord-embed-log-channel_1","title":"Discord Embed (Log-Channel)","text":"<pre><code>\u2699\ufe0f Rolle aktualisiert (Dashboard)\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\nRolle:           `Aktives Mitglied`\nGe\u00e4ndert von:    Admin Name\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n\u00c4nderungen:\nName: `Mitglied` \u2192 `Aktives Mitglied`\nFarbe: `#000000` \u2192 `#3498db`\nHervorheben: `false` \u2192 `true`\n\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n</code></pre>"},{"location":"configuration/development/webhooks/#4-user-synchronisierung","title":"4. User-Synchronisierung","text":"<p>Endpoint: <code>POST /api/notifications/sync-users</code></p> <p>Wird aufgerufen wenn: - Automatisch: Via Cron-Job (t\u00e4glich um 3:00 Uhr) - Manuell: Via API-Aufruf</p> <p>Implementierung: - Sender: <code>apps/clanscore-api/src/infrastructure/cron/jobs.ts</code> - Empf\u00e4nger: <code>webhookRouter.post(\"/sync-users\")</code></p>"},{"location":"configuration/development/webhooks/#request-body_3","title":"Request Body","text":"<pre><code>{\n  \"guildId\": \"987654321098765432\"\n}\n</code></pre>"},{"location":"configuration/development/webhooks/#verhalten_3","title":"Verhalten","text":"<ol> <li>\u2705 F\u00fchrt <code>performSyncUsers()</code> aus (gleiche Logik wie <code>/syncusers</code> Command)</li> <li>\u2705 Synchronisiert alle Benutzer mit Rollen \"Mitglied\" oder \"Vorstand\"</li> <li>\u2705 Sendet Log-Nachricht in den entsprechenden Discord-Channel</li> </ol>"},{"location":"configuration/development/webhooks/#response_3","title":"Response","text":"<p>Erfolg: <pre><code>{\n  \"ok\": true,\n  \"changes\": 5\n}\n</code></pre></p> <p>Fehler: <pre><code>{\n  \"error\": \"Sync failed\",\n  \"details\": \"Error details...\"\n}\n</code></pre></p>"},{"location":"configuration/development/webhooks/#cron-job-konfiguration","title":"Cron-Job Konfiguration","text":"<p>Datei: <code>apps/clanscore-api/src/infrastructure/cron/jobs.ts</code></p> <pre><code>// T\u00e4glich um 3:00 Uhr\ncron.schedule(\"0 3 * * *\", async () =&gt; {\n    await fetch(`${config.DISCORD_BOT_WEBHOOK_URL}/api/notifications/sync-users`, {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\",\n            \"x-webhook-token\": config.WEBHOOK_SHARED_SECRET,\n        },\n        body: JSON.stringify({\n            guildId: config.DISCORD_GUILD_ID,\n        }),\n    });\n});\n</code></pre>"},{"location":"configuration/development/webhooks/#implementierung","title":"Implementierung","text":""},{"location":"configuration/development/webhooks/#in-clanscore-api","title":"In clanscore-api","text":""},{"location":"configuration/development/webhooks/#notificationservice","title":"NotificationService","text":"<p>Datei: <code>apps/clanscore-api/src/application/notifications/notification.service.ts</code></p> <p>Der <code>NotificationService</code> ist ein Singleton, der alle Adapter verwaltet:</p> <pre><code>import { notificationService } from '../application/notifications';\n\n// Event ausl\u00f6sen\nawait notificationService.notifyApplicationAccepted({\n    userId: person.id,\n    platformUserId: person.discordId,\n    username: person.name,\n    roleName: role.name,\n});\n</code></pre>"},{"location":"configuration/development/webhooks/#discordadapter","title":"DiscordAdapter","text":"<p>Datei: <code>apps/clanscore-api/src/application/notifications/adapters/discord.adapter.ts</code></p> <pre><code>import { DiscordAdapter } from '../application/notifications/adapters/discord.adapter';\n\nconst adapter = new DiscordAdapter();\n\n// Pr\u00fcfen ob aktiviert\nif (adapter.isEnabled()) {\n    await adapter.onApplicationAccepted({\n        type: \"application_accepted\",\n        userId: \"...\",\n        platformUserId: \"...\",\n        username: \"...\",\n        roleName: \"...\",\n    });\n}\n</code></pre>"},{"location":"configuration/development/webhooks/#adapter-registrierung","title":"Adapter Registrierung","text":"<p>Datei: <code>apps/clanscore-api/src/application/notifications/index.ts</code></p> <pre><code>import { DiscordAdapter } from \"./adapters/discord.adapter\";\nimport { notificationService } from \"./notification.service\";\n\n// Adapter wird beim Start registriert\nnotificationService.register(new DiscordAdapter());\n</code></pre>"},{"location":"configuration/development/webhooks/#in-discord-bot","title":"In discord-bot","text":""},{"location":"configuration/development/webhooks/#webhook-server","title":"Webhook Server","text":"<p>Datei: <code>apps/discord-bot/src/web/server.ts</code></p> <pre><code>import express from \"express\";\nimport { webhookRouter } from \"./routes/webhook.routes\";\n\nexport function startHttpServer() {\n    const app = express();\n    app.use(express.json());\n\n    app.get(\"/health\", (_req, res) =&gt; res.json({ ok: true }));\n    app.use(\"/api/notifications\", webhookRouter);\n\n    const port = config.DISCORD_SERVER_PORT;\n    app.listen(port, () =&gt; {\n        console.log(`\ud83d\udd14 Bot webhook server listening on http://localhost:${port}`);\n    });\n}\n</code></pre>"},{"location":"configuration/development/webhooks/#webhook-routes","title":"Webhook Routes","text":"<p>Datei: <code>apps/discord-bot/src/web/routes/webhook.routes.ts</code></p> <pre><code>import express from \"express\";\nimport { z } from \"zod\";\n\nexport const webhookRouter = express.Router();\n\n// Authentifizierung\nfunction verifySecret(req: express.Request): string | boolean {\n    const token = req.header(\"x-webhook-token\") ?? \"\";\n    return config.WEBHOOK_SHARED_SECRET &amp;&amp; token === config.WEBHOOK_SHARED_SECRET;\n}\n\n// Endpoint\nwebhookRouter.post(\"/user-status\", async (req, res) =&gt; {\n    if (!verifySecret(req)) {\n        return res.status(401).json({ error: \"Unauthorized\" });\n    }\n\n    // Validierung mit Zod\n    const body = UserStatusSchema.parse(req.body);\n\n    // Verarbeitung...\n});\n</code></pre>"},{"location":"configuration/development/webhooks/#fehlerbehandlung","title":"Fehlerbehandlung","text":""},{"location":"configuration/development/webhooks/#fehlgeschlagene-requests","title":"Fehlgeschlagene Requests","text":""},{"location":"configuration/development/webhooks/#in-der-api-sender","title":"In der API (Sender)","text":"<p>Datei: <code>apps/clanscore-api/src/application/notifications/adapters/discord.adapter.ts</code></p> <pre><code>try {\n    const response = await fetch(`${this.baseUrl}/api/notifications/role-changed`, {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\",\n            \"x-webhook-token\": this.secret,\n        },\n        body: JSON.stringify({...}),\n    });\n\n    if (!response.ok) {\n        const errorText = await response.text();\n        const errorDetails: ErrorDetails = {\n            type: ErrorType.NotificationFailed,\n            details: {\n                message: `DiscordAdapter.onRoleChanged failed: ${response.status} - ${errorText}`,\n                status: response.status,\n            }\n        };\n        getErrorMessage(errorDetails);\n    }\n} catch (error) {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    const errorDetails: ErrorDetails = {\n        type: ErrorType.NetworkFailure,\n        details: {\n            message: `DiscordAdapter.onRoleChanged error: ${errorMessage}`,\n        }\n    };\n    getErrorMessage(errorDetails);\n}\n</code></pre> <p>Wichtige Punkte: - \u2705 Fehler werden geloggt, aber nicht geworfen - \u2705 Die API-Operation wird trotzdem durchgef\u00fchrt (Fire-and-Forget) - \u2705 Aktuell keine automatischen Retries</p>"},{"location":"configuration/development/webhooks/#im-bot-empfanger","title":"Im Bot (Empf\u00e4nger)","text":"<p>Datei: <code>apps/discord-bot/src/web/routes/webhook.routes.ts</code></p> <pre><code>try {\n    // Verarbeitung...\n} catch (err: any) {\n    const errorMessage = err instanceof Error ? err.message : String(err);\n    const errorDetails: ErrorDetails = {\n        type: ErrorType.UnknownError,\n        details: {\n            message: `user-status error: ${errorMessage}`,\n        }\n    };\n    getErrorMessage(errorDetails);\n\n    if (err?.issues) {\n        return res.status(400).json({ error: \"ValidationError\", details: err.issues });\n    }\n    return res.status(500).json({ error: \"InternalError\" });\n}\n</code></pre>"},{"location":"configuration/development/webhooks/#fehlertypen","title":"Fehlertypen","text":"Fehlertyp Beschreibung HTTP Status <code>Unauthorized</code> Ung\u00fcltiger oder fehlender Token <code>401</code> <code>ValidationError</code> Ung\u00fcltiger Request Body <code>400</code> <code>Guild not found</code> Discord Server nicht gefunden <code>404</code> <code>Member not found</code> Discord Benutzer nicht gefunden <code>404</code> <code>Role not found</code> Discord Rolle nicht gefunden <code>404</code> <code>InternalError</code> Unerwarteter Serverfehler <code>500</code>"},{"location":"configuration/development/webhooks/#fehlerbehandlung-bei-dms","title":"Fehlerbehandlung bei DMs","text":"<p>Wenn eine DM nicht gesendet werden kann (z.B. Benutzer hat DMs deaktiviert):</p> <pre><code>try {\n    await member.send(`\u2705 Hallo &lt;@${member.id}&gt;, ...`);\n} catch (e) {\n    const errorMessage = e instanceof Error ? e.message : String(e);\n    const errorDetails: ErrorDetails = {\n        type: ErrorType.MessageNotSend,\n        details: {\n            message: `DM failed (Accepted): ${errorMessage}`,\n        }\n    };\n    getErrorMessage(errorDetails);\n    // Webhook wird trotzdem als erfolgreich behandelt\n}\n</code></pre>"},{"location":"configuration/development/webhooks/#testing","title":"Testing","text":""},{"location":"configuration/development/webhooks/#lokales-testen","title":"Lokales Testen","text":""},{"location":"configuration/development/webhooks/#1-beide-services-starten","title":"1. Beide Services starten","text":"<pre><code># Terminal 1: API\ncd apps/clanscore-api\nnpm run dev\n\n# Terminal 2: Discord Bot\ncd apps/discord-bot\nnpm run dev\n</code></pre>"},{"location":"configuration/development/webhooks/#2-webhook-manuell-testen","title":"2. Webhook manuell testen","text":"<p>User-Status (Accepted): <pre><code>curl -X POST http://localhost:3001/api/notifications/user-status \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-webhook-token: &lt;WEBHOOK_SHARED_SECRET&gt;\" \\\n  -d '{\n    \"discordId\": \"123456789012345678\",\n    \"status\": \"Accepted\",\n    \"guildId\": \"987654321098765432\",\n    \"roleName\": \"Mitglied\"\n  }'\n</code></pre></p> <p>User-Status (Denied): <pre><code>curl -X POST http://localhost:3001/api/notifications/user-status \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-webhook-token: &lt;WEBHOOK_SHARED_SECRET&gt;\" \\\n  -d '{\n    \"discordId\": \"123456789012345678\",\n    \"status\": \"Denied\",\n    \"guildId\": \"987654321098765432\"\n  }'\n</code></pre></p> <p>Role-Changed: <pre><code>curl -X POST http://localhost:3001/api/notifications/role-changed \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-webhook-token: &lt;WEBHOOK_SHARED_SECRET&gt;\" \\\n  -d '{\n    \"discordId\": \"123456789012345678\",\n    \"username\": \"Max Mustermann\",\n    \"guildId\": \"987654321098765432\",\n    \"addRoles\": [\"Vorstand\"],\n    \"removeRoles\": [\"Mitglied\"],\n    \"changedBy\": \"Test Admin\"\n  }'\n</code></pre></p> <p>Role-Updated: <pre><code>curl -X POST http://localhost:3001/api/notifications/role-updated \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-webhook-token: &lt;WEBHOOK_SHARED_SECRET&gt;\" \\\n  -d '{\n    \"guildId\": \"987654321098765432\",\n    \"oldName\": \"Mitglied\",\n    \"newName\": \"Aktives Mitglied\",\n    \"color\": \"#3498db\",\n    \"hoist\": true,\n    \"mentionable\": false,\n    \"changedBy\": \"Test Admin\"\n  }'\n</code></pre></p> <p>Sync-Users: <pre><code>curl -X POST http://localhost:3001/api/notifications/sync-users \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-webhook-token: &lt;WEBHOOK_SHARED_SECRET&gt;\" \\\n  -d '{\n    \"guildId\": \"987654321098765432\"\n  }'\n</code></pre></p>"},{"location":"configuration/development/webhooks/#docker-testing","title":"Docker-Testing","text":"<pre><code># Services starten\ndocker-compose up -d\n\n# Logs beobachten\ndocker-compose logs -f discord-bot\n\n# Webhook testen (von ausserhalb des Containers)\ncurl -X POST http://localhost:3001/api/notifications/user-status \\\n  -H \"Content-Type: application/json\" \\\n  -H \"x-webhook-token: &lt;WEBHOOK_SHARED_SECRET&gt;\" \\\n  -d '{...}'\n</code></pre>"},{"location":"configuration/development/webhooks/#test-szenarien","title":"Test-Szenarien","text":""},{"location":"configuration/development/webhooks/#erfolgreiche-szenarien","title":"\u2705 Erfolgreiche Szenarien","text":"<ol> <li>Bewerbung akzeptieren</li> <li>Request mit <code>status: \"Accepted\"</code> und <code>roleName</code></li> <li> <p>Erwartung: Rolle wird hinzugef\u00fcgt, DM wird gesendet</p> </li> <li> <p>Bewerbung ablehnen</p> </li> <li>Request mit <code>status: \"Denied\"</code></li> <li> <p>Erwartung: Rollen werden entfernt, DM wird gesendet</p> </li> <li> <p>Rollen \u00e4ndern</p> </li> <li>Request mit <code>addRoles</code> und <code>removeRoles</code></li> <li>Erwartung: Rollen werden ge\u00e4ndert, Log-Nachricht wird gesendet</li> </ol>"},{"location":"configuration/development/webhooks/#fehler-szenarien","title":"\u274c Fehler-Szenarien","text":"<ol> <li>Ung\u00fcltiger Token</li> <li>Request ohne oder mit falschem <code>x-webhook-token</code></li> <li> <p>Erwartung: <code>401 Unauthorized</code></p> </li> <li> <p>Benutzer nicht gefunden</p> </li> <li>Request mit nicht existierender <code>discordId</code></li> <li> <p>Erwartung: <code>404 Member not found</code></p> </li> <li> <p>Rolle nicht gefunden</p> </li> <li>Request mit nicht existierender <code>roleName</code></li> <li> <p>Erwartung: <code>404 Role not found</code></p> </li> <li> <p>Validierungsfehler</p> </li> <li>Request mit fehlenden oder ung\u00fcltigen Feldern</li> <li>Erwartung: <code>400 ValidationError</code> mit Details</li> </ol>"},{"location":"configuration/development/webhooks/#sicherheit","title":"Sicherheit","text":""},{"location":"configuration/development/webhooks/#best-practices","title":"Best Practices","text":""},{"location":"configuration/development/webhooks/#1-starker-secret","title":"1. Starker Secret","text":"<ul> <li>\u2705 Mindestens 32 Zeichen (empfohlen: 64 Zeichen)</li> <li>\u2705 Zuf\u00e4llig generiert (z.B. <code>openssl rand -hex 32</code>)</li> <li>\u2705 Nicht in Git committen (nur in <code>.env</code> oder Secrets)</li> <li>\u2705 Regelm\u00e4ssig rotieren (bei Verdacht auf Kompromittierung)</li> </ul>"},{"location":"configuration/development/webhooks/#2-https-in-production","title":"2. HTTPS in Production","text":"<pre><code># Production\nDISCORD_BOT_WEBHOOK_URL=https://discord-bot.example.com\n</code></pre> <ul> <li>\u2705 HTTPS verwenden f\u00fcr alle Webhook-Requests</li> <li>\u2705 Zertifikat-Validierung aktivieren</li> <li>\u2705 Keine Self-Signed Certificates in Production</li> </ul>"},{"location":"configuration/development/webhooks/#3-rate-limiting","title":"3. Rate Limiting","text":"<p>Aktuell nicht implementiert, aber empfohlen:</p> <pre><code>import rateLimit from \"express-rate-limit\";\n\nconst webhookLimiter = rateLimit({\n    windowMs: 15 * 60 * 1000, // 15 Minuten\n    max: 100, // Max 100 Requests pro Window\n    message: \"Too many webhook requests\"\n});\n\napp.use(\"/api/notifications\", webhookLimiter, webhookRouter);\n</code></pre>"},{"location":"configuration/development/webhooks/#4-ip-whitelisting-optional","title":"4. IP-Whitelisting (Optional)","text":"<p>Falls die API von einer festen IP-Adresse kommt:</p> <pre><code>const allowedIPs = [\"10.0.0.1\", \"10.0.0.2\"];\n\nwebhookRouter.use((req, res, next) =&gt; {\n    const clientIP = req.ip || req.connection.remoteAddress;\n    if (!allowedIPs.includes(clientIP)) {\n        return res.status(403).json({ error: \"Forbidden\" });\n    }\n    next();\n});\n</code></pre>"},{"location":"configuration/development/webhooks/#5-request-validierung","title":"5. Request-Validierung","text":"<ul> <li>\u2705 Zod-Schemas validieren alle Request-Bodies</li> <li>\u2705 Type-Safety durch TypeScript</li> <li>\u2705 Sanitization von User-Input</li> </ul>"},{"location":"configuration/development/webhooks/#troubleshooting","title":"Troubleshooting","text":""},{"location":"configuration/development/webhooks/#connection-refused","title":"\"Connection refused\"","text":"<p>Symptom: <pre><code>Error: connect ECONNREFUSED 127.0.0.1:3001\n</code></pre></p> <p>L\u00f6sung: 1. \u2705 Pr\u00fcfe, ob der Discord Bot l\u00e4uft: <code>docker-compose ps discord-bot</code> 2. \u2705 Pr\u00fcfe <code>DISCORD_BOT_WEBHOOK_URL</code> in der API-Konfiguration 3. \u2705 Pr\u00fcfe die Netzwerk-Konnektivit\u00e4t (Docker Network) 4. \u2705 Pr\u00fcfe die Firewall-Regeln</p> <p>Docker Network pr\u00fcfen: <pre><code>docker network inspect clanscore_default\n</code></pre></p>"},{"location":"configuration/development/webhooks/#invalid-webhook-token-unauthorized","title":"\"Invalid webhook token\" / \"Unauthorized\"","text":"<p>Symptom: <pre><code>{\n  \"error\": \"Unauthorized\"\n}\n</code></pre></p> <p>L\u00f6sung: 1. \u2705 Pr\u00fcfe, ob <code>WEBHOOK_SHARED_SECRET</code> in beiden Services identisch ist 2. \u2705 Pr\u00fcfe den <code>x-webhook-token</code> Header im Request 3. \u2705 Pr\u00fcfe, ob der Secret in der <code>.env</code> Datei korrekt gesetzt ist 4. \u2705 Pr\u00fcfe, ob keine Leerzeichen oder Sonderzeichen im Secret sind</p> <p>Secret vergleichen: <pre><code># In clanscore-api\necho $WEBHOOK_SHARED_SECRET\n\n# In discord-bot\necho $WEBHOOK_SHARED_SECRET\n</code></pre></p>"},{"location":"configuration/development/webhooks/#webhooks-kommen-nicht-an","title":"Webhooks kommen nicht an","text":"<p>Symptom: - Webhook-Requests werden gesendet, aber keine Antwort</p> <p>L\u00f6sung: 1. \u2705 Pr\u00fcfe die Logs: <code>docker-compose logs discord-bot</code> 2. \u2705 Pr\u00fcfe die Firewall-Regeln 3. \u2705 Pr\u00fcfe die Docker-Netzwerk-Konfiguration 4. \u2705 Pr\u00fcfe, ob der Webhook-Server l\u00e4uft: <code>curl http://localhost:3001/health</code></p> <p>Logs pr\u00fcfen: <pre><code># Discord Bot Logs\ndocker-compose logs -f discord-bot\n\n# API Logs\ndocker-compose logs -f clanscore-api\n</code></pre></p>"},{"location":"configuration/development/webhooks/#guild-not-found","title":"\"Guild not found\"","text":"<p>Symptom: <pre><code>{\n  \"error\": \"Guild not found\"\n}\n</code></pre></p> <p>L\u00f6sung: 1. \u2705 Pr\u00fcfe <code>DISCORD_GUILD_ID</code> in der Bot-Konfiguration 2. \u2705 Pr\u00fcfe, ob der Bot Mitglied des Discord-Servers ist 3. \u2705 Pr\u00fcfe, ob die Guild-ID korrekt ist</p>"},{"location":"configuration/development/webhooks/#member-not-found","title":"\"Member not found\"","text":"<p>Symptom: <pre><code>{\n  \"error\": \"Member not found\"\n}\n</code></pre></p> <p>L\u00f6sung: 1. \u2705 Pr\u00fcfe, ob die <code>discordId</code> korrekt ist 2. \u2705 Pr\u00fcfe, ob der Benutzer Mitglied des Discord-Servers ist 3. \u2705 Pr\u00fcfe, ob der Bot die Berechtigung hat, Mitglieder zu sehen</p>"},{"location":"configuration/development/webhooks/#role-not-found","title":"\"Role not found\"","text":"<p>Symptom: <pre><code>{\n  \"error\": \"Role not found\"\n}\n</code></pre></p> <p>L\u00f6sung: 1. \u2705 Pr\u00fcfe, ob die Rolle im Discord-Server existiert 2. \u2705 Pr\u00fcfe, ob der Rollenname exakt \u00fcbereinstimmt (Gross-/Kleinschreibung beachten) 3. \u2705 Pr\u00fcfe, ob der Bot die Berechtigung hat, Rollen zu sehen</p>"},{"location":"configuration/development/webhooks/#dms-werden-nicht-gesendet","title":"DMs werden nicht gesendet","text":"<p>Symptom: - Webhook ist erfolgreich, aber Benutzer erh\u00e4lt keine DM</p> <p>L\u00f6sung: 1. \u2705 Pr\u00fcfe, ob der Benutzer DMs von Server-Mitgliedern erlaubt hat 2. \u2705 Pr\u00fcfe die Bot-Logs f\u00fcr <code>MessageNotSend</code> Fehler 3. \u2705 Pr\u00fcfe, ob der Bot die Berechtigung hat, DMs zu senden</p> <p>Hinweis: DMs k\u00f6nnen nicht gesendet werden, wenn: - Der Benutzer DMs deaktiviert hat - Der Benutzer den Bot blockiert hat - Der Benutzer nicht auf dem Server ist</p>"},{"location":"configuration/development/webhooks/#validierungsfehler","title":"Validierungsfehler","text":"<p>Symptom: <pre><code>{\n  \"error\": \"ValidationError\",\n  \"details\": [\n    {\n      \"path\": [\"discordId\"],\n      \"message\": \"Required\"\n    }\n  ]\n}\n</code></pre></p> <p>L\u00f6sung: 1. \u2705 Pr\u00fcfe den Request Body gegen das Schema 2. \u2705 Pr\u00fcfe, ob alle erforderlichen Felder vorhanden sind 3. \u2705 Pr\u00fcfe die Datentypen (z.B. <code>discordId</code> muss String sein)</p>"},{"location":"configuration/development/webhooks/#code-beispiele-aus-dem-projekt","title":"Code-Beispiele aus dem Projekt","text":""},{"location":"configuration/development/webhooks/#gekapselter-versand-uber-discordadapter","title":"Gekapselter Versand \u00fcber DiscordAdapter","text":"<p>Die API nutzt den <code>NotificationService</code> und <code>DiscordAdapter</code>, um Discord-relevante Ereignisse zu senden, ohne Kenntnis \u00fcber die interne Bot-Logik zu ben\u00f6tigen. Die Discord-spezifische Implementierung ist vollst\u00e4ndig im <code>DiscordAdapter</code> gekapselt.</p> <p>Datei: <code>apps/clanscore-api/src/application/user/user.service.ts</code></p> <pre><code>export async function handleAcceptApplication(\n    person: PersonEntity,\n    roleName: string,\n): Promise&lt;Result&lt;PersonEntity, ErrorDetails&gt;&gt; {\n    // ... Gesch\u00e4ftslogik (Status-Update, Rollen-Zuweisung) ...\n\n    if (person.discordId) {\n        const username = person.nickname?.trim() || `${person.firstName} ${person.lastName}`.trim() || \"Unbekannt\";\n        // API ruft NotificationService auf - keine Discord-Details bekannt\n        await notificationService.notifyApplicationAccepted({\n            userId: person._id.toString(),\n            platformUserId: person.discordId,\n            username,\n            roleName,\n        }).catch((error) =&gt; {\n            // Fehler werden geloggt, f\u00fchren aber nicht zum Abbruch der Gesch\u00e4ftslogik\n            const errorMessage = error instanceof Error ? error.message : String(error);\n            const errorDetails: ErrorDetails = {\n                type: ErrorType.NotificationFailed,\n                details: {\n                    message: `Bot konnte Benutzerstatus nicht senden: ${errorMessage}`,\n                }\n            };\n            getErrorMessage(errorDetails);\n        });\n    }\n\n    return ok(updateStatusResult.value);\n}\n</code></pre> <p>Datei: <code>apps/clanscore-api/src/application/notifications/adapters/discord.adapter.ts</code></p> <pre><code>export class DiscordAdapter extends BasePlatformAdapter {\n    readonly name = \"discord\";\n    private baseUrl: string;\n    private secret: string;\n\n    constructor() {\n        super();\n        this.baseUrl = config.DISCORD_BOT_WEBHOOK_URL;\n        this.secret = config.WEBHOOK_SHARED_SECRET;\n    }\n\n    async onApplicationAccepted(event: ApplicationAcceptedEvent): Promise&lt;void&gt; {\n        if (!this.isEnabled()) return;\n\n        try {\n            // DiscordAdapter sendet HTTP-Webhook - Bot-Logik bleibt verborgen\n            const response = await fetch(`${this.baseUrl}/api/notifications/user-status`, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"x-webhook-token\": this.secret,\n                },\n                body: JSON.stringify({\n                    discordId: event.platformUserId,\n                    status: \"Accepted\",\n                    guildId: config.DISCORD_GUILD_ID,\n                    roleName: event.roleName,\n                }),\n            });\n\n            if (!response.ok) {\n                const errorText = await response.text();\n                const errorDetails: ErrorDetails = {\n                    type: ErrorType.NotificationFailed,\n                    details: {\n                        message: `DiscordAdapter.onApplicationAccepted failed: ${response.status} - ${errorText}`,\n                        status: response.status,\n                    }\n                };\n                getErrorMessage(errorDetails);\n            }\n        } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : String(error);\n            const errorDetails: ErrorDetails = {\n                type: ErrorType.NetworkFailure,\n                details: {\n                    message: `DiscordAdapter.onApplicationAccepted error: ${errorMessage}`,\n                }\n            };\n            getErrorMessage(errorDetails);\n        }\n    }\n}\n</code></pre>"},{"location":"configuration/development/webhooks/#webhook-route-mit-zod-validierung-und-secret-check","title":"Webhook-Route mit Zod-Validierung und Secret-Check","text":"<p>Alle Webhook-Endpunkte validieren sowohl die Authentifizierung (Secret-Token) als auch die Payload-Struktur (Zod-Schema) vor der fachlichen Verarbeitung.</p> <p>Datei: <code>apps/discord-bot/src/web/routes/webhook.routes.ts</code></p> <pre><code>import express from \"express\";\nimport { z } from \"zod\";\nimport { config } from \"../../config\";\n\nexport const webhookRouter = express.Router();\n\n// Secret-Validierung\nfunction verifySecret(req: express.Request): string | boolean {\n    const token = req.header(\"x-webhook-token\") ?? \"\";\n    return config.WEBHOOK_SHARED_SECRET &amp;&amp; token === config.WEBHOOK_SHARED_SECRET;\n}\n\n// Zod-Schema f\u00fcr Payload-Validierung\nconst UserStatusSchema = z.object({\n  discordId: z.string().min(1),\n  status: z.enum([\"Accepted\", \"Denied\"]),\n  guildId: z.string().min(1).optional(),\n  roleName: z.string().min(1).optional(), // nur bei Accepted n\u00f6tig\n});\n\n// Webhook-Endpoint mit vollst\u00e4ndiger Validierung\nwebhookRouter.post(\"/user-status\", async (req, res) =&gt; {\n    try {\n        // 1. Authentifizierung pr\u00fcfen\n        if (!verifySecret(req)) {\n            return res.status(401).json({ error: \"Unauthorized\" });\n        }\n\n        // 2. Payload-Struktur validieren (Zod wirft bei Fehlern)\n        const body = UserStatusSchema.parse(req.body);\n\n        // 3. Fachliche Verarbeitung (nur wenn Validierung erfolgreich)\n        const guildId = body.guildId ?? config.DISCORD_GUILD_ID;\n        if (!guildId) return res.status(400).json({ error: \"guildId required\" });\n\n        const guild = await client.guilds.fetch(guildId).catch(() =&gt; null);\n        if (!guild) return res.status(404).json({ error: \"Guild not found\" });\n\n        // ... weitere Verarbeitung ...\n\n    } catch (err: any) {\n        const errorMessage = err instanceof Error ? err.message : String(err);\n        const errorDetails: ErrorDetails = {\n            type: ErrorType.UnknownError,\n            details: {\n                message: `user-status error: ${errorMessage}`,\n            }\n        };\n        getErrorMessage(errorDetails);\n\n        // Zod-Validierungsfehler werden als 400 zur\u00fcckgegeben\n        if (err?.issues) {\n            return res.status(400).json({ error: \"ValidationError\", details: err.issues });\n        }\n        return res.status(500).json({ error: \"InternalError\" });\n    }\n});\n</code></pre>"},{"location":"configuration/development/webhooks/#automatisierte-benutzer-synchronisation","title":"Automatisierte Benutzer-Synchronisation","text":"<p>Die Benutzer-Synchronisation nutzt dieselbe Anwendungslogik (<code>performSyncUsers</code>) sowohl f\u00fcr den manuellen Discord-Command als auch f\u00fcr den automatisierten Webhook-Aufruf.</p> <p>Datei: <code>apps/clanscore-api/src/infrastructure/cron/jobs.ts</code></p> <pre><code>import cron from \"node-cron\";\nimport { config } from \"../../config\";\nimport { ErrorType, ErrorDetails, getErrorMessage } from \"@clanscore/shared\";\n\nexport function registerCronJobs() {\n    // T\u00e4glich um 3:00 Uhr: Automatische User-Synchronisierung via Webhook\n    cron.schedule(\"0 3 * * *\", async () =&gt; {\n        console.log(\"Starte geplante L\u00f6schung...\");\n        await deleteScheduledPersons();\n\n        console.log(\"Starte User-Synchronisierung...\");\n        try {\n            // Webhook-Aufruf an Discord-Bot\n            const response = await fetch(`${config.DISCORD_BOT_WEBHOOK_URL}/api/notifications/sync-users`, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"x-webhook-token\": config.WEBHOOK_SHARED_SECRET,\n                },\n                body: JSON.stringify({\n                    guildId: config.DISCORD_GUILD_ID,\n                }),\n            });\n\n            if (!response.ok) {\n                const errorText = await response.text();\n                const errorDetails: ErrorDetails = {\n                    type: ErrorType.NetworkFailure,\n                    details: {\n                        message: `User-Synchronisierung fehlgeschlagen: ${response.status} - ${errorText}`,\n                        status: response.status,\n                    }\n                };\n                getErrorMessage(errorDetails);\n            }\n        } catch (error) {\n            const errorMessage = error instanceof Error ? error.message : String(error);\n            const errorDetails: ErrorDetails = {\n                type: ErrorType.NetworkFailure,\n                details: {\n                    message: `Fehler bei User-Synchronisierung: ${errorMessage}`,\n                }\n            };\n            getErrorMessage(errorDetails);\n        }\n    });\n\n    console.log(\"\u2705 Registered all Cron-Jobs\");\n}\n</code></pre> <p>Datei: <code>apps/discord-bot/src/web/routes/webhook.routes.ts</code></p> <pre><code>// Webhook-Endpoint f\u00fcr automatische Synchronisation\nwebhookRouter.post(\"/sync-users\", async (req, res) =&gt; {\n    try {\n        if (!verifySecret(req)) {\n            return res.status(401).json({ error: \"Unauthorized\" });\n        }\n\n        const guildId = req.body.guildId ?? config.DISCORD_GUILD_ID;\n        if (!guildId) return res.status(400).json({ error: \"guildId required\" });\n\n        const guild = await client.guilds.fetch(guildId).catch(() =&gt; null);\n        if (!guild) return res.status(404).json({ error: \"Guild not found\" });\n\n        // Verwendet dieselbe Logik wie der manuelle /syncusers Command\n        const syncResult = await performSyncUsers(guild);\n        if (!syncResult.ok) {\n            return res.status(500).json({ \n                error: \"Sync failed\", \n                details: syncResult.error \n            });\n        }\n\n        return res.json({ \n            ok: true, \n            changes: syncResult.value.changes.length \n        });\n    } catch (err: any) {\n        const errorMessage = err instanceof Error ? err.message : String(err);\n        const errorDetails: ErrorDetails = {\n            type: ErrorType.UnknownError,\n            details: {\n                message: `sync-users error: ${errorMessage}`,\n            }\n        };\n        getErrorMessage(errorDetails);\n        return res.status(500).json({ error: \"InternalError\" });\n    }\n});\n</code></pre> <p>Datei: <code>apps/discord-bot/src/commands/user/syncusers.ts</code></p> <pre><code>// Manueller Discord-Command verwendet dieselbe Logik\nexport async function execute(interaction: CommandInteraction) {\n    await interaction.deferReply({ flags: MessageFlags.Ephemeral });\n\n    const guild = interaction.guild as Guild;\n    // Gleiche Funktion wie im Webhook-Endpoint\n    const syncResult = await performSyncUsers(guild, `&lt;@${interaction.user.id}&gt;`);\n\n    if (!syncResult.ok) {\n        return interaction.editReply(\n            getErrorMessage(syncResult.error),\n        );\n    }\n\n    // ... Ergebnis-Pr\u00e4sentation f\u00fcr Discord ...\n}\n</code></pre> <p>Wichtig: Beide Varianten (manuell und automatisch) greifen auf <code>performSyncUsers()</code> zur\u00fcck, wodurch redundanter Code vermieden und konsistentes Verhalten sichergestellt wird. Synchronisiert werden ausschliesslich Benutzer mit den Rollen \"Mitglied\" und \"Vorstand\".</p>"},{"location":"configuration/development/webhooks/#weitere-informationen","title":"Weitere Informationen","text":"<ul> <li>API-Endpunkte - Vollst\u00e4ndige API-Dokumentation</li> <li>Architektur - System-Architektur</li> <li>Konfiguration - Setup-Anleitung</li> <li>Logging - Logging-Dokumentation</li> </ul>"},{"location":"configuration/development/webhooks/#changelog","title":"Changelog","text":""},{"location":"configuration/development/webhooks/#version-100","title":"Version 1.0.0","text":"<ul> <li>\u2705 Initiale Dokumentation</li> <li>\u2705 4 Webhook-Endpunkte dokumentiert</li> <li>\u2705 Vollst\u00e4ndige Request/Response-Schemas</li> <li>\u2705 Fehlerbehandlung dokumentiert</li> <li>\u2705 Testing-Anleitung</li> <li>\u2705 Troubleshooting-Guide</li> </ul>"},{"location":"configuration/secrets-env/env-mapping/","title":"\ud83d\udccb Umgebungs-Variablen Mapping","text":"<p>Diese Datei zeigt, welche Umgebungs-Variablen wo verwendet werden und wie sie aus <code>.env</code> Dateien geladen werden.</p>"},{"location":"configuration/secrets-env/env-mapping/#variablen-ubersicht","title":"Variablen-\u00dcbersicht","text":""},{"location":"configuration/secrets-env/env-mapping/#mongodb","title":"MongoDB","text":"Variable Verwendet in Quelle <code>MONGO_INITDB_ROOT_USERNAME</code> <code>docker-compose.yml</code>, <code>db.init.ts</code> <code>.env</code> <code>MONGO_INITDB_ROOT_PASSWORD</code> <code>docker-compose.yml</code>, <code>db.init.ts</code> <code>.env</code> <code>MONGO_DB</code> <code>docker-compose.yml</code>, <code>db.init.ts</code> <code>.env</code> (Default: <code>clanscore</code>) <code>MONGO_HOST</code> <code>db.init.ts</code> <code>.env</code> / Docker (Default: <code>mongodb</code> im Container) <code>MONGO_PORT</code> <code>db.init.ts</code> <code>.env</code> / Docker (Default: <code>27017</code>)"},{"location":"configuration/secrets-env/env-mapping/#discord-bot","title":"Discord Bot","text":"Variable Verwendet in Quelle <code>DISCORD_TOKEN</code> <code>docker-compose.yml</code>, <code>config.ts</code> (API &amp; Bot) <code>.env</code> <code>DISCORD_CLIENT_ID</code> <code>docker-compose.yml</code>, <code>config.ts</code> (API &amp; Bot) <code>.env</code> <code>DISCORD_GUILD_ID</code> <code>docker-compose.yml</code>, <code>config.ts</code> (API &amp; Bot) <code>.env</code> <code>DISCORD_SERVER_PORT</code> <code>docker-compose.yml</code>, <code>config.ts</code> (API &amp; Bot) <code>.env</code> (Default: <code>3001</code>) <code>DISCORD_BOT_WEBHOOK_URL</code> <code>docker-compose.yml</code>, <code>config.ts</code> (API) <code>.env</code>"},{"location":"configuration/secrets-env/env-mapping/#webhooks","title":"Webhooks","text":"Variable Verwendet in Quelle <code>WEBHOOK_SHARED_SECRET</code> <code>docker-compose.yml</code>, <code>config.ts</code> (API &amp; Bot) <code>.env</code>"},{"location":"configuration/secrets-env/env-mapping/#google-calendar","title":"Google Calendar","text":"Variable Verwendet in Quelle <code>GOOGLE_CALENDAR_CLIENT_ID</code> <code>docker-compose.yml</code>, <code>config.ts</code> (API &amp; Bot) <code>.env</code> <code>GOOGLE_CALENDAR_CLIENT_SECRET</code> <code>docker-compose.yml</code>, <code>config.ts</code> (API &amp; Bot) <code>.env</code> <code>GOOGLE_CALENDAR_REDIRECT_URI</code> <code>docker-compose.yml</code>, <code>config.ts</code> (API &amp; Bot) <code>.env</code>"},{"location":"configuration/secrets-env/env-mapping/#api-konfiguration","title":"API Konfiguration","text":"Variable Verwendet in Quelle <code>CLANSCORE_API_URL</code> <code>docker-compose.yml</code>, <code>config.ts</code> (Bot), <code>apiClient.ts</code> <code>.env</code> <code>CLANSCORE_API_KEY</code> <code>docker-compose.yml</code>, <code>config.ts</code> (Bot), <code>apiClient.ts</code> <code>.env</code> <code>JWT_SECRET</code> <code>docker-compose.yml</code>, <code>config.ts</code> (API), <code>jwt.ts</code> <code>.env</code> <code>CORS_ORIGIN</code> <code>docker-compose.yml</code>, <code>config.ts</code> (API), <code>server.ts</code> <code>.env</code>"},{"location":"configuration/secrets-env/env-mapping/#dashboard","title":"Dashboard","text":"Variable Verwendet in Quelle <code>CLANSCORE_API_URL</code> <code>docker-compose.yml</code>, <code>Dockerfile</code> (Build-Arg) <code>.env</code>"},{"location":"configuration/secrets-env/env-mapping/#datei-spezifische-verwendung","title":"Datei-spezifische Verwendung","text":""},{"location":"configuration/secrets-env/env-mapping/#docker-composeyml","title":"<code>docker-compose.yml</code>","text":"<p>L\u00e4dt alle Variablen aus <code>.env</code> Datei (wenn vorhanden) oder aus Environment-Variablen: <pre><code>environment:\n  - VARIABLE_NAME=${VARIABLE_NAME}\n  - VARIABLE_NAME=${VARIABLE_NAME:-default_value}  # Mit Default\n</code></pre></p>"},{"location":"configuration/secrets-env/env-mapping/#appsclanscore-apisrcconfigts","title":"<code>apps/clanscore-api/src/config.ts</code>","text":"<p>L\u00e4dt Variablen via <code>dotenv</code>: <pre><code>import dotenv from \"dotenv\";\ndotenv.config();\nconst { VARIABLE } = process.env;\n</code></pre></p>"},{"location":"configuration/secrets-env/env-mapping/#appsclanscore-apisrcserverts","title":"<code>apps/clanscore-api/src/server.ts</code>","text":"<p>Verwendet <code>CORS_ORIGIN</code> direkt aus <code>process.env</code>: <pre><code>origin: process.env.CORS_ORIGIN || 'http://localhost:4200'\n</code></pre></p>"},{"location":"configuration/secrets-env/env-mapping/#appsclanscore-apisrcinfrastructuresecurityjwtts","title":"<code>apps/clanscore-api/src/infrastructure/security/jwt.ts</code>","text":"<p>Verwendet <code>JWT_SECRET</code> direkt aus <code>process.env</code>: <pre><code>const JWT_SECRET = process.env.JWT_SECRET || \"default-secret\"\n</code></pre></p>"},{"location":"configuration/secrets-env/env-mapping/#appsclanscore-apisrcinfrastructuredatabasedbinitts","title":"<code>apps/clanscore-api/src/infrastructure/database/db.init.ts</code>","text":"<p>Verwendet MongoDB-Variablen direkt aus <code>process.env</code>: <pre><code>const host = process.env.MONGO_HOST ?? \"localhost\";\nconst port = process.env.MONGO_PORT ?? \"27017\";\nconst dbName = process.env.MONGO_DB ?? \"clanscore\";\n</code></pre></p>"},{"location":"configuration/secrets-env/env-mapping/#appsdiscord-botconfigts","title":"<code>apps/discord-bot/config.ts</code>","text":"<p>L\u00e4dt Variablen via <code>dotenv</code>: <pre><code>import dotenv from \"dotenv\";\ndotenv.config();\nconst { VARIABLE } = process.env;\n</code></pre></p>"},{"location":"configuration/secrets-env/env-mapping/#appsdiscord-botsrcapiapiclientts","title":"<code>apps/discord-bot/src/api/apiClient.ts</code>","text":"<p>Verwendet API-Variablen direkt aus <code>process.env</code>: <pre><code>const BASE = process.env.CLANSCORE_API_URL!;\nconst KEY = process.env.CLANSCORE_API_KEY;\n</code></pre></p>"},{"location":"configuration/secrets-env/env-mapping/#lade-reihenfolge","title":"Lade-Reihenfolge","text":"<ol> <li>Lokale Entwicklung: <code>.env</code> Datei wird von <code>dotenv</code> geladen</li> <li>Docker Compose: Variablen aus <code>.env</code> oder Umgebungs-Variablen</li> <li>Docker Container: Erh\u00e4lt Variablen als Umgebungs-Variablen von Docker Compose</li> </ol>"},{"location":"configuration/secrets-env/env-mapping/#fehlende-variablen","title":"Fehlende Variablen","text":"<p>Wenn eine Variable fehlt: - In Code: Fallback-Werte werden verwendet (z.B. <code>|| 'default'</code>) - In Docker Compose: Fehler beim Start - In Config Files: <code>throw new Error(\"Missing environment variables\")</code></p>"},{"location":"configuration/secrets-env/github-secrets/","title":"\ud83d\udd10 GitHub Secrets","text":"<p>\u26a0\ufe0f Hinweis: Diese Dokumentation ist f\u00fcr automatisiertes Deployment via GitHub Actions gedacht. Da das automatische Deployment aktuell nicht aktiv genutzt wird, verwende stattdessen eine <code>.env</code> Datei auf dem Server.</p> <p>Siehe Umgebungsvariablen Dokumentation f\u00fcr die aktuelle Konfiguration mit <code>.env</code> Dateien.</p>"},{"location":"configuration/secrets-env/github-secrets/#historische-dokumentation-nicht-aktiv","title":"Historische Dokumentation (nicht aktiv)","text":"<p>Diese Anleitung listet alle GitHub Secrets auf, die f\u00fcr das automatische Deployment konfiguriert werden m\u00fcssten (falls aktiviert).</p>"},{"location":"configuration/secrets-env/github-secrets/#wo-secrets-hinzufugen","title":"Wo Secrets hinzuf\u00fcgen?","text":"<ol> <li>Gehe zu deinem GitHub Repository</li> <li>Settings \u2192 Secrets and variables \u2192 Actions</li> <li>Klicke auf New repository secret</li> <li>F\u00fcge jedes Secret einzeln hinzu</li> </ol>"},{"location":"configuration/secrets-env/github-secrets/#erforderliche-secrets","title":"Erforderliche Secrets","text":""},{"location":"configuration/secrets-env/github-secrets/#server-verbindung-ssh","title":"\ud83d\udd0c Server-Verbindung (SSH)","text":"<p>Diese Secrets sind erforderlich f\u00fcr das SSH-Deployment:</p> Secret Name Beschreibung Beispiel Erforderlich <code>SERVER_HOST</code> IP-Adresse oder Hostname des Servers <code>&lt;benutzer@host&gt;</code> oder <code>&lt;server_ip&gt;</code> \u2705 Ja <code>SERVER_SSH_KEY</code> Privater SSH-Key (kompletter Inhalt) Siehe unten \u26a0\ufe0f Option 1 <code>SERVER_SSH_PASSWORD</code> SSH-Passwort Ihr Passwort \u26a0\ufe0f Option 2 <code>SERVER_SSH_PORT</code> SSH-Port (optional, Standard: 22) <code>22</code> \u274c Nein <code>SERVER_USER</code> SSH-Benutzername <code>ins</code>, <code>ubuntu</code>, <code>root</code>, <code>deploy</code> \u2705 Ja <p>Hinweis: du kannst entweder <code>SERVER_SSH_KEY</code> (Key-basiert) ODER <code>SERVER_SSH_PASSWORD</code> (Passwort-basiert) verwenden. Key-basiert ist sicherer und empfohlen.</p> <p>SSH-Key erstellen (Option 1 - Empfohlen): <pre><code># Lokal ausf\u00fchren\nssh-keygen -t ed25519 -C \"github-actions-deploy\" -f ~/.ssh/github_actions_deploy\n\n# Privaten Key anzeigen (f\u00fcr SERVER_SSH_KEY)\ncat ~/.ssh/github_actions_deploy\n\n# \u00d6ffentlichen Key auf Server installieren\nssh-copy-id -i ~/.ssh/github_actions_deploy.pub &lt;Benutzer&gt;@&lt;server_ip&gt;\n</code></pre></p> <p>Passwort-Authentifizierung (Option 2): - Verwende <code>SERVER_SSH_PASSWORD</code> statt <code>SERVER_SSH_KEY</code> - Siehe SSH Setup f\u00fcr Details</p>"},{"location":"configuration/secrets-env/github-secrets/#mongodb-konfiguration","title":"\ud83d\uddc4\ufe0f MongoDB Konfiguration","text":"Secret Name Beschreibung Beispiel Erforderlich <code>MONGO_DB</code> Datenbankname <code>clanscore</code> \u274c Nein (Standard: clanscore) <code>MONGO_INITDB_ROOT_PASSWORD</code> MongoDB Admin-Passwort <code>sicheres_passwort_123</code> \u2705 Ja <code>MONGO_INITDB_ROOT_USERNAME</code> MongoDB Admin-Benutzername <code>admin</code> \u2705 Ja"},{"location":"configuration/secrets-env/github-secrets/#discord-bot-konfiguration","title":"\ud83e\udd16 Discord Bot Konfiguration","text":"Secret Name Beschreibung Beispiel Erforderlich <code>DISCORD_CLIENT_ID</code> Discord Client ID <code>123456789012345678</code> \u2705 Ja <code>DISCORD_GUILD_ID</code> Discord Server (Guild) ID <code>987654321098765432</code> \u2705 Ja <code>DISCORD_TOKEN</code> Discord Bot Token <code>MTIzNDU2Nzg5MDEyMzQ1Njc4OQ...</code> \u2705 Ja <code>DISCORD_SERVER_PORT</code> Port f\u00fcr Bot Webhook Server <code>3001</code> \u274c Nein (Standard: 3001) <p>Wo finde ich diese Werte? - Discord Developer Portal: https://discord.com/developers/applications - Bot Token: Application \u2192 Bot \u2192 Token - Client ID: Application \u2192 General Information \u2192 Application ID - Guild ID: Rechtsklick auf Discord-Server \u2192 \"Server-ID kopieren\"</p>"},{"location":"configuration/secrets-env/github-secrets/#webhook-konfiguration","title":"\ud83d\udd17 Webhook Konfiguration","text":"Secret Name Beschreibung Beispiel Erforderlich <code>WEBHOOK_SHARED_SECRET</code> Geheimer Schl\u00fcssel f\u00fcr Webhooks <code>mein_geheimer_schl\u00fcssel_123</code> \u2705 Ja <code>DISCORD_BOT_WEBHOOK_URL</code> URL f\u00fcr Bot Webhooks <code>http://&lt;server_ip&gt;:3001</code> \u2705 Ja"},{"location":"configuration/secrets-env/github-secrets/#google-calendar-oauth","title":"\ud83d\udcc5 Google Calendar OAuth","text":"Secret Name Beschreibung Beispiel Erforderlich <code>GOOGLE_CALENDAR_CLIENT_ID</code> Google OAuth Client ID <code>xxx.apps.googleusercontent.com</code> \u2705 Ja <code>GOOGLE_CALENDAR_CLIENT_SECRET</code> Google OAuth Client Secret <code>GOCSPX-xxx...</code> \u2705 Ja <code>GOOGLE_CALENDAR_REDIRECT_URI</code> OAuth Redirect URI <code>http://&lt;server_ip&gt;/calendarToken</code> \u2705 Ja <p>Wo finde ich diese Werte? - Google Cloud Console: https://console.cloud.google.com/ - APIs &amp; Services \u2192 Credentials \u2192 OAuth 2.0 Client IDs - Redirect URI muss exakt \u00fcbereinstimmen!</p>"},{"location":"configuration/secrets-env/github-secrets/#api-konfiguration","title":"\ud83d\udd10 API Konfiguration","text":"Secret Name Beschreibung Beispiel Erforderlich <code>CLANSCORE_API_URL</code> API Base URL <code>http://&lt;server_ip&gt;:3000/api</code> \u2705 Ja <code>CLANSCORE_API_KEY</code> API Key f\u00fcr Authentifizierung <code>mein_api_key_123</code> \u2705 Ja <code>JWT_SECRET</code> Secret f\u00fcr JWT Token Signierung <code>mein_jwt_secret_456</code> \u2705 Ja"},{"location":"configuration/secrets-env/github-secrets/#dashboard-konfiguration","title":"\ud83c\udfa8 Dashboard Konfiguration","text":"Secret Name Beschreibung Beispiel Erforderlich <code>DASHBOARD_API_URL</code> API URL f\u00fcr Dashboard <code>http://&lt;server_ip&gt;:3000/api</code> \u2705 Ja <code>CORS_ORIGIN</code> CORS Origin f\u00fcr API <code>http://&lt;server_ip&gt;</code> \u2705 Ja <p>F\u00fcr Domain (falls konfiguriert): - <code>DASHBOARD_API_URL</code>: <code>https://clanscore.ost.ch/api</code> - <code>CORS_ORIGIN</code>: <code>https://clanscore.ost.ch</code></p>"},{"location":"configuration/secrets-env/github-secrets/#schnellstart-checkliste","title":"Schnellstart-Checkliste","text":""},{"location":"configuration/secrets-env/github-secrets/#schritt-1-ssh-key-erstellen","title":"Schritt 1: SSH-Key erstellen","text":"<ul> <li>SSH-Key lokal erstellen</li> <li>\u00d6ffentlichen Key auf Server installieren</li> <li>Privaten Key kopieren (f\u00fcr <code>SERVER_SSH_KEY</code>)</li> </ul>"},{"location":"configuration/secrets-env/github-secrets/#schritt-2-github-secrets-hinzufugen","title":"Schritt 2: GitHub Secrets hinzuf\u00fcgen","text":"<p>Server-Verbindung:</p> <ul> <li><code>SERVER_HOST</code> = <code>&lt;benutzer@host&gt;</code> oder <code>&lt;server_ip&gt;</code></li> <li><code>SERVER_USER</code> = Ihr SSH-Benutzername</li> <li><code>SERVER_SSH_KEY</code> = Privater SSH-Key (Option 1)</li> <li><code>SERVER_SSH_PASSWORD</code> = SSH-Password (Option 2)</li> <li><code>SERVER_SSH_PORT</code> = <code>22</code> (falls Standard)</li> </ul> <p>MongoDB:</p> <ul> <li><code>MONGO_INITDB_ROOT_USERNAME</code> = <code>admin</code></li> <li><code>MONGO_INITDB_ROOT_PASSWORD</code> = Sicheres Passwort</li> <li><code>MONGO_DB</code> = <code>clanscore</code> (optional)</li> </ul> <p>Discord:</p> <ul> <li><code>DISCORD_TOKEN</code> = Bot Token</li> <li><code>DISCORD_CLIENT_ID</code> = Client ID</li> <li><code>DISCORD_GUILD_ID</code> = Server ID</li> <li><code>DISCORD_SERVER_PORT</code> = <code>3001</code> (optional)</li> </ul> <p>Webhooks:</p> <ul> <li><code>WEBHOOK_SHARED_SECRET</code> = Geheimer Schl\u00fcssel</li> <li><code>DISCORD_BOT_WEBHOOK_URL</code> = <code>http://&lt;server_ip&gt;:3001</code></li> </ul> <p>Google Calendar:</p> <ul> <li><code>GOOGLE_CALENDAR_CLIENT_ID</code> = Client ID</li> <li><code>GOOGLE_CALENDAR_CLIENT_SECRET</code> = Client Secret</li> <li><code>GOOGLE_CALENDAR_REDIRECT_URI</code> = <code>http://&lt;server_ip&gt;/calendarToken</code></li> </ul> <p>API:</p> <ul> <li><code>CLANSCORE_API_URL</code> = <code>http://&lt;server_ip&gt;:3000/api</code></li> <li><code>CLANSCORE_API_KEY</code> = API Key</li> <li><code>JWT_SECRET</code> = JWT Secret</li> </ul> <p>Dashboard:</p> <ul> <li><code>DASHBOARD_API_URL</code> = <code>http://&lt;server_ip&gt;:3000/api</code></li> <li><code>CORS_ORIGIN</code> = <code>http://&lt;server_ip&gt;</code></li> </ul>"},{"location":"configuration/secrets-env/github-secrets/#schritt-3-workflow-testen","title":"Schritt 3: Workflow testen","text":"<ul> <li>GitHub \u2192 Actions \u2192 Deploy to Server</li> <li>\"Run workflow\" klicken</li> <li>Logs pr\u00fcfen</li> </ul>"},{"location":"configuration/secrets-env/github-secrets/#beispiel-konfiguration-fur-srbsci-11ostch","title":"Beispiel-Konfiguration f\u00fcr srbsci-11.ost.ch","text":"<pre><code># Server-Verbindung\nSERVER_HOST: srbsci-11.ost.ch\nSERVER_USER: ubuntu\nSERVER_SSH_KEY: |\n  -----BEGIN OPENSSH PRIVATE KEY-----\n  b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAACFwAAAAdzc2gtcn\n  ...\n  -----END OPENSSH PRIVATE KEY-----\nSERVER_SSH_PORT: 22\n\n# MongoDB\nMONGO_INITDB_ROOT_USERNAME: admin\nMONGO_INITDB_ROOT_PASSWORD: IhrSicheresPasswort123!\nMONGO_DB: clanscore\n\n# Discord\nDISCORD_TOKEN: IhrDiscordBotToken\nDISCORD_CLIENT_ID: 123456789012345678\nDISCORD_GUILD_ID: 987654321098765432\nDISCORD_SERVER_PORT: 3001\n\n# Webhooks\nWEBHOOK_SHARED_SECRET: IhrWebhookSecret123\nDISCORD_BOT_WEBHOOK_URL: http://&lt;server_ip&gt;:3001\n\n# Google Calendar\nGOOGLE_CALENDAR_CLIENT_ID: xxx.apps.googleusercontent.com\nGOOGLE_CALENDAR_CLIENT_SECRET: GOCSPX-xxx...\nGOOGLE_CALENDAR_REDIRECT_URI: http://&lt;server_ip&gt;/calendarToken\n\n# API\nCLANSCORE_API_URL: http://&lt;server_ip&gt;:3000/api\nCLANSCORE_API_KEY: IhrApiKey123\nJWT_SECRET: IhrJwtSecret456\n\n# Dashboard\nDASHBOARD_API_URL: http://&lt;server_ip&gt;:3000/api\nCORS_ORIGIN: http://&lt;server_ip&gt;\n</code></pre>"},{"location":"configuration/secrets-env/github-secrets/#wichtige-hinweise","title":"Wichtige Hinweise","text":""},{"location":"configuration/secrets-env/github-secrets/#sicherheit","title":"\ud83d\udd12 Sicherheit","text":"<ul> <li>Niemals Secrets im Code committen</li> <li>Verwende starke, eindeutige Passw\u00f6rter</li> <li>Rotiere Secrets regelm\u00e4ssig</li> <li>Beschr\u00e4nke Zugriff auf Secrets (Repository Settings)</li> </ul>"},{"location":"configuration/secrets-env/github-secrets/#secret-rotation","title":"\ud83d\udd04 Secret-Rotation","text":"<p>Wenn du ein Secret \u00e4ndern musst:</p> <ol> <li>Gehe zu Settings \u2192 Secrets</li> <li>Klicke auf das Secret</li> <li>Klicke auf \"Update\"</li> <li>Neuen Wert eingeben</li> <li>Workflow erneut ausf\u00fchren</li> </ol>"},{"location":"configuration/secrets-env/github-secrets/#testing","title":"\ud83e\uddea Testing","text":"<p>Nach dem Hinzuf\u00fcgen aller Secrets:</p> <ol> <li>Gehe zu Actions</li> <li>W\u00e4hle Deploy to Server</li> <li>Klicke auf Run workflow</li> <li>Pr\u00fcfe die Logs auf Fehler</li> </ol>"},{"location":"configuration/secrets-env/github-secrets/#haufige-fehler","title":"\u274c H\u00e4ufige Fehler","text":"<p>\"Permission denied (publickey)\"</p> <ul> <li>Pr\u00fcfe <code>SERVER_SSH_KEY</code> (muss kompletter privater Key sein)</li> <li>Pr\u00fcfe, ob \u00f6ffentlicher Key auf Server installiert ist</li> </ul> <p>\"Connection refused\"</p> <ul> <li>Pr\u00fcfe <code>SERVER_HOST</code> und <code>SERVER_SSH_PORT</code></li> <li>Pr\u00fcfe Firewall-Einstellungen</li> </ul> <p>\"Missing environment variables\"</p> <ul> <li>Pr\u00fcfe, ob alle erforderlichen Secrets hinzugef\u00fcgt wurden</li> <li>Pr\u00fcfe die Schreibweise der Secret-Namen</li> </ul>"},{"location":"configuration/secrets-env/github-secrets/#hilfe","title":"Hilfe","text":"<p>Bei Problemen:</p> <ol> <li>Pr\u00fcfe die Workflow-Logs in GitHub Actions</li> <li>Pr\u00fcfe die Server-Logs: <code>docker-compose logs</code></li> <li>Siehe Deployment Guide f\u00fcr Troubleshooting</li> </ol>"},{"location":"configuration/secrets-env/secrets-cheatsheet/","title":"\ud83d\udccb Secrets CheatSheet","text":"<p>Hier sind alle Secrets auf einen Blick:</p> Erforderlich (Muss vorhanden sein) Optional (Haben Standardwerte) SERVER_HOST SERVER_SSH_PORT (Standard: 22) SERVER_USER MONGO_DB (Standard: clanscore) SERVER_SSH_KEY DISCORD_SERVER_PORT (Standard: 3001) SERVER_SSH_PASSWORD MONGO_INITDB_ROOT_PASSWORD MONGO_INITDB_ROOT_USERNAME DISCORD_TOKEN DISCORD_CLIENT_ID DISCORD_GUILD_ID WEBHOOK_SHARED_SECRET DISCORD_BOT_WEBHOOK_URL GOOGLE_CALENDAR_CLIENT_ID GOOGLE_CALENDAR_CLIENT_SECRET GOOGLE_CALENDAR_REDIRECT_URI CLANSCORE_API_URL CLANSCORE_API_KEY JWT_SECRET DASHBOARD_API_URL CORS_ORIGIN PUBLIC_REPO_DEPLOY_TOKEN"},{"location":"configuration/secrets-env/secrets-cheatsheet/#secrets-copy-paste-liste","title":"Secrets Copy-Paste Liste","text":"<p>F\u00fcge diese Secrets entweder direkt als Umgebungs-Variablen in die <code>.env</code> Datei oder als GitHub Secrets hinzu (Settings \u2192 Secrets \u2192 Actions).</p> <pre><code># -- SERVER --\nSERVER_HOST=&lt;server_host&gt;\nSERVER_USER=&lt;server_benutzer&gt;\nSERVER_SSH_KEY=&lt;privater_ssh_key&gt;  # ODER\nSERVER_SSH_PASSWORD=&lt;ssh_passwort&gt;  # Alternative zu KEY\nSERVER_SSH_PORT=22 # Optional\n\n# -- MONGODB --\nMONGO_DB=clanscore # Optional\nMONGO_INITDB_ROOT_PASSWORD=&lt;db_passwort&gt;\nMONGO_INITDB_ROOT_USERNAME=admin\n\n# -- DISCORD-BOT --\nDISCORD_TOKEN=&lt;discord_token&gt;\nDISCORD_CLIENT_ID=&lt;discord_client_id&gt;\nDISCORD_GUILD_ID=&lt;discord_guild_id&gt;\nDISCORD_SERVER_PORT=3001 # Optional\n\n# -- WEBHOOK --\nWEBHOOK_SHARED_SECRET=&lt;webhook_secret&gt;\nDISCORD_BOT_WEBHOOK_URL=http://&lt;server_ip&gt;:3001\n\n# -- GOOGLE CALENDAR --\nGOOGLE_CALENDAR_CLIENT_ID=&lt;Ihr Client ID&gt;\nGOOGLE_CALENDAR_CLIENT_SECRET=&lt;google_secret&gt;\nGOOGLE_CALENDAR_REDIRECT_URI=http://&lt;server_ip&gt;/calendarToken\n\n# -- BACKEND-API --\nCLANSCORE_API_URL=http://&lt;server_ip&gt;:3000/api\nCLANSCORE_API_KEY=&lt;api_key&gt;\nJWT_SECRET=&lt;jwt_secret&gt;\n\n# -- DASHBOARD --\nDASHBOARD_API_URL=http://&lt;server_ip&gt;:3000/api\nCORS_ORIGIN=http://&lt;server_ip&gt;\n\n# -- DOC DEPLOYMENT --\nPUBLIC_REPO_DEPLOY_TOKEN=&lt;github_ssh_key&gt;\n</code></pre>"},{"location":"configuration/secrets-env/secrets-cheatsheet/#anzahl-der-secrets","title":"Anzahl der Secrets","text":"<ul> <li>Erforderlich: 20 Secrets</li> <li>Optional: 3 Secrets</li> <li>Gesamt: 23 Secrets</li> </ul> <p>Siehe GitHub Secrets Guide f\u00fcr detaillierte Beschreibungen.</p>"},{"location":"dashboard/manual/","title":"\ud83d\udcca Dashboard - Benutzerhandbuch","text":"<p>Vollst\u00e4ndiges Handbuch f\u00fcr das ClansCore Dashboard.</p>"},{"location":"dashboard/manual/#was-ist-das-dashboard","title":"\ud83d\udcca Was ist das Dashboard?","text":"<p>Das ClansCore-Dashboard ist eine moderne Webanwendung zur Verwaltung des Vereins. Es bietet Administratoren und Vorstandsmitgliedern eine intuitive Benutzeroberfl\u00e4che und erm\u00f6glicht in Verbindung mit dem Discord-Bot die Durchf\u00fchrung s\u00e4mtlicher Verwaltungsaufgaben.</p>"},{"location":"dashboard/manual/#ubersicht-funktionen","title":"\u2728 \u00dcbersicht Funktionen","text":"<ul> <li> <p>Benutzer-Verwaltung</p> <ul> <li>Mitglieder-Verwaltung</li> <li>Rollen-Verwaltung</li> <li>Rollen zuweisen</li> </ul> </li> <li> <p>Aufgaben- und Event-Ansicht</p> </li> <li> <p>Gamification</p> <ul> <li>Ranglisten einsehen</li> <li>Punkte-Historie von Mitgliedern anzeigen</li> <li>Gamification-Parameter Verwalten</li> <li>Aufgabentypen Verwalten </li> <li>Belohnungen verwalten</li> <li>Jahresplanung vom Gamification-System Erstellen</li> </ul> </li> <li> <p>Admin-Login</p> <ul> <li>Mitglieder-Verwaltung</li> <li>Passwort-Setzung</li> </ul> </li> </ul>"},{"location":"dashboard/manual/#zielgruppe","title":"\ud83d\udc65 Zielgruppe","text":"<ul> <li>Vorstandsmitglieder: f\u00fcr Verwaltungsaufgaben</li> </ul>"},{"location":"dashboard/manual/#anmeldung","title":"\ud83d\udd10 Anmeldung","text":""},{"location":"dashboard/manual/#erste-anmeldung","title":"Erste Anmeldung","text":"<ol> <li>\u00d6ffne das Dashboard</li> <li>Melde dich mit dem Administrator-Account an</li> <li>Erstelle ein neues Mitglied mit der Rolle Vorstand</li> <li>Setze ein Passwort f\u00fcr das neu erstellte Mitglied</li> <li>Melde dich aus dem Administrator-Account ab</li> <li>Anschliessend kannst du dich mit dem neu erstellten Account anmelden</li> </ol>"},{"location":"dashboard/manual/#einloggen","title":"Einloggen","text":"<ol> <li>Gib deine Anmeldedaten ein</li> <li>Klicke auf \"Anmelden\"</li> <li>Du wirst zum Dashboard weitergeleitet</li> </ol>"},{"location":"dashboard/manual/#hauptfunktionen","title":"\u2699\ufe0f Hauptfunktionen","text":""},{"location":"dashboard/manual/#mitglieder-verwaltung","title":"Mitglieder-Verwaltung","text":"<p>Aktionen:</p> <ul> <li>Mitglied hinzuf\u00fcgen:  Formular ausf\u00fcllen und absenden</li> <li>Mitglied bearbeiten: Daten ab\u00e4ndern und absenden </li> <li>Mitglied l\u00f6schen: Auf das L\u00f6sch-Icon klicken und best\u00e4tigen</li> <li>Rollen zuweisen: Benutzer bearbeiten \u2192 Rollen hinzuf\u00fcgen/entfernen</li> </ul>"},{"location":"dashboard/manual/#rollen-verwaltung","title":"Rollen-Verwaltung","text":"<p>Aktionen:</p> <ul> <li>Rollen hinzuf\u00fcgen:  Formular ausf\u00fcllen und absenden</li> <li>Rollen bearbeiten: Daten ab\u00e4ndern und absenden </li> <li>Rollen l\u00f6schen: Auf das L\u00f6sch-Icon klicken und best\u00e4tigen</li> </ul>"},{"location":"dashboard/manual/#ranglisten","title":"Ranglisten","text":"<p>Ranglisten anzeigen: - Filter um gew\u00fcnschte Rangliste anzuzeigen</p> <p>Punkte-Historie anzeigen: - Filter um gew\u00fcnschtes Mitglied auszuw\u00e4hlen</p>"},{"location":"dashboard/manual/#gamification-verwaltung","title":"Gamification-Verwaltung","text":"<ul> <li>Gamifcation-Parameter erfassen/bearbeiten</li> </ul> <p>Aufgabentypen verwalten: - Aufgabentypen erstellen - Aufgabentypen bearbeiten - Aufgabentypen l\u00f6schen</p> <p>Belohnungen verwalten:</p> <ul> <li>Belohnungen erstellen</li> <li>Belohnungen bearbeiten</li> <li>Belohnungen l\u00f6schen</li> </ul> <p>Jahresplanung der Punktevergabe vom Verein: - Erfassung der Anzahl und Menge der Aufgabentypen - Erfassung der Spendensumme - Berechnung und Anzeige der voraussichtlich im Jahr vergebenen Punkte des Vereins</p> <p>Punktebeispiel: - Eingabe der voraussichtlich erledigten Aufgaben und Spenden des Mitglieds - Berechnung und Anzeige der voraussichtlich im Jahr erzielten Punkte des Mitglieds</p>"},{"location":"dashboard/manual/#navigation","title":"\ud83d\uddfa\ufe0f Navigation","text":""},{"location":"dashboard/manual/#hauptmenu","title":"Hauptmen\u00fc","text":"<ul> <li>Mitglieder: Benutzer-Verwaltung</li> <li>Aufgaben: Aufgaben-Management</li> <li>Ranglisten: Ranglisten und Punkte-Historie von Benutzern einsehen</li> <li>Events: Event-Liste</li> <li>Rollen: Rollen-Verwaltung</li> <li>Belohnungen: Belohnungen-Verwaltung</li> </ul> <p>Gamification-Verwaltung: - Punkte: Gamification-Paramter und Aufgabentypen verwalten - Jahresplanung: Die Punktevergabe f\u00fcr das Jahr planen - Belohnungen: Belohnungs-Verwaltung - Punktebeispiel: Punktebeispiel f\u00fcr ein Jahr von einem Mitglied Erstellen</p>"},{"location":"dashboard/manual/#benutzer-menu","title":"Benutzer-Men\u00fc","text":"<ul> <li>Passwort \u00c4ndern: Das eigene Passwort \u00c4ndern</li> </ul>"},{"location":"dashboard/manual/#berechtigungen","title":"\ud83d\udd12 Berechtigungen","text":""},{"location":"dashboard/manual/#rollen","title":"Rollen","text":"Rolle Berechtigungen Vorstand Alle Funktionen bis auf Passwort \u00c4nderung Admin Benutzerverwaltung und Passwort \u00c4nderung"},{"location":"dashboard/manual/#technologie","title":"\ud83d\udcbb Technologie","text":"<ul> <li>Framework: Angular 18</li> <li>Sprache: TypeScript</li> <li>Styling: SCSS</li> <li>Build: Angular CLI</li> </ul>"},{"location":"dashboard/manual/#weitere-informationen","title":"\ud83d\udcda Weitere Informationen","text":"<ul> <li>API-Endpunkte - Vollst\u00e4ndige API-Dokumentation</li> <li>Konfiguration - Setup-Anleitung</li> <li>Discord Bot - Bot-Funktionen</li> </ul>"},{"location":"deployment/deployment-stand/","title":"\ud83d\ude80 Deployment-Stand - Detaillierte Dokumentation","text":"<p>Diese Dokumentation beschreibt den aktuellen Stand des Deployment-Systems f\u00fcr das ClansCore-Projekt. Die Dokumentation umfasst alle Aspekte des Deployments, von der Architektur bis hin zu den einzelnen Konfigurationsdetails.</p>"},{"location":"deployment/deployment-stand/#ubersicht","title":"\u00dcbersicht","text":""},{"location":"deployment/deployment-stand/#system-komponenten","title":"System-Komponenten","text":"<p>Das ClansCore-System besteht aus folgenden Hauptkomponenten:</p> Komponente Technologie Port Container-Name clanscore-api Node.js/Express/TypeScript 3000 (intern) <code>clanscore-api</code> dashboard Angular/TypeScript + Nginx 80 (extern) <code>clanscore-dashboard</code> discord-bot Node.js/Discord.js/TypeScript 3001 (extern) <code>clanscore-discord-bot</code> mongodb MongoDB 8 27017 (intern) <code>clanscore-mongodb</code>"},{"location":"deployment/deployment-stand/#deployment-stack","title":"Deployment-Stack","text":"<ul> <li>Container-Orchestrierung: Docker Compose</li> <li>Container-Runtime: Docker 20.10+</li> <li>Build-System: Multi-Stage Docker Builds</li> <li>Reverse Proxy: Nginx (im Dashboard-Container integriert)</li> <li>Package Management: npm Workspaces</li> </ul>"},{"location":"deployment/deployment-stand/#aktueller-deployment-status","title":"Aktueller Deployment-Status","text":"<ul> <li>\u2705 Docker Compose Setup: Vollst\u00e4ndig konfiguriert</li> <li>\u2705 Multi-Stage Builds: Implementiert f\u00fcr alle Services</li> <li>\u2705 Health Checks: Konfiguriert f\u00fcr alle Services</li> <li>\u2705 Netzwerk-Isolation: Bridge-Netzwerk implementiert</li> <li>\u2705 Deployment-Skripte: Bash und PowerShell verf\u00fcgbar</li> <li>\u2705 Backup-System: Docker-Container f\u00fcr Backups vorhanden</li> </ul>"},{"location":"deployment/deployment-stand/#deployment-architektur","title":"Deployment-Architektur","text":""},{"location":"deployment/deployment-stand/#high-level-architektur","title":"High-Level-Architektur","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Externe Zugriffe                         \u2502\n\u2502  - Browser (Dashboard)                                      \u2502\n\u2502  - Discord API (Bot)                                         \u2502\n\u2502  - Google Calendar API (OAuth)                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                        \u2502\n                        \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Docker Host                              \u2502\n\u2502                                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502           clanscore-network (Bridge)                \u2502  \u2502\n\u2502  \u2502                                                       \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502\n\u2502  \u2502  \u2502   Dashboard  \u2502  \u2502 clanscore-api\u2502  \u2502discord-bot \u2502 \u2502  \u2502\n\u2502  \u2502  \u2502  (Nginx)     \u2502  \u2502  (Express)   \u2502  \u2502(Discord.js)\u2502 \u2502  \u2502\n\u2502  \u2502  \u2502  Port: 80    \u2502  \u2502  Port: 3000  \u2502  \u2502 Port: 3001 \u2502 \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502\n\u2502  \u2502         \u2502                 \u2502                 \u2502         \u2502  \u2502\n\u2502  \u2502         \u2502                 \u2502                 \u2502         \u2502  \u2502\n\u2502  \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502  \u2502\n\u2502  \u2502                         \u2502                             \u2502  \u2502\n\u2502  \u2502                         \u25bc                             \u2502  \u2502\n\u2502  \u2502                  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502  \u2502\n\u2502  \u2502                  \u2502   MongoDB     \u2502                    \u2502  \u2502\n\u2502  \u2502                  \u2502   Port: 27017 \u2502                    \u2502  \u2502\n\u2502  \u2502                  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                                                           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502              Docker Volumes                         \u2502  \u2502\n\u2502  \u2502  - mongo_data (persistente Datenbank)              \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"deployment/deployment-stand/#service-abhangigkeiten","title":"Service-Abh\u00e4ngigkeiten","text":"<pre><code>mongodb (Health Check)\n    \u2502\n    \u251c\u2500\u2500\u25ba clanscore-api (depends_on: mongodb)\n    \u2502         \u2502\n    \u2502         \u251c\u2500\u2500\u25ba dashboard (depends_on: clanscore-api)\n    \u2502         \u2502\n    \u2502         \u2514\u2500\u2500\u25ba discord-bot (depends_on: clanscore-api, mongodb)\n</code></pre>"},{"location":"deployment/deployment-stand/#kommunikations-flows","title":"Kommunikations-Flows","text":"<ol> <li>Browser \u2192 Dashboard \u2192 API</li> <li>Browser sendet Request an Dashboard (Port 80)</li> <li>Dashboard (Nginx) leitet <code>/api/*</code> Requests an <code>clanscore-api:3000</code> weiter</li> <li> <p>Dashboard serviert statische Angular-Assets</p> </li> <li> <p>API \u2192 Discord Bot (Webhooks)</p> </li> <li>API sendet HTTP POST an <code>discord-bot:3001/api/notifications/*</code></li> <li> <p>Authentifizierung via <code>x-webhook-token</code> Header</p> </li> <li> <p>Discord Bot \u2192 API (REST)</p> </li> <li>Bot sendet HTTP Requests an <code>clanscore-api:3000/api/*</code></li> <li> <p>Authentifizierung via <code>x-api-key</code> Header</p> </li> <li> <p>Alle Services \u2192 MongoDB</p> </li> <li>Verbindung \u00fcber Docker DNS: <code>mongodb:27017</code></li> <li>Authentifizierung via <code>MONGO_INITDB_ROOT_USERNAME</code> / <code>MONGO_INITDB_ROOT_PASSWORD</code></li> </ol>"},{"location":"deployment/deployment-stand/#docker-konfiguration","title":"Docker-Konfiguration","text":""},{"location":"deployment/deployment-stand/#docker-compose-konfiguration","title":"Docker Compose Konfiguration","text":"<p>Das Projekt verwendet <code>docker-compose.yml</code> f\u00fcr das Deployment:</p> <p>Zweck: Standard-Deployment mit lokalen Builds</p> <p>Features: - Baut alle Images lokal - Verwendet <code>.env</code> Datei f\u00fcr Konfiguration - Port-Mappings:   - Dashboard: <code>80:80</code> (extern)   - API: <code>127.0.0.1:3000:3000</code> (nur localhost)   - Discord Bot: <code>3001:3001</code> (extern)   - MongoDB: <code>27017:27017</code> (extern)</p> <p>Verwendung: <pre><code>docker-compose up -d --build\n</code></pre></p>"},{"location":"deployment/deployment-stand/#docker-netzwerk","title":"Docker Netzwerk","text":"<p>Netzwerk-Name: <code>clanscore-network</code></p> <p>Typ: Bridge (Standard)</p> <p>Services im Netzwerk: - <code>mongodb</code> - <code>clanscore-api</code> - <code>discord-bot</code> - <code>dashboard</code></p> <p>Service Discovery: Docker DNS erm\u00f6glicht Kommunikation \u00fcber Service-Namen: - <code>mongodb</code> \u2192 <code>mongodb:27017</code> - <code>clanscore-api</code> \u2192 <code>clanscore-api:3000</code> - <code>discord-bot</code> \u2192 <code>discord-bot:3001</code></p>"},{"location":"deployment/deployment-stand/#docker-volumes","title":"Docker Volumes","text":"<p>Volume-Name: <code>mongo_data</code></p> <p>Typ: Local Driver</p> <p>Zweck: Persistente Speicherung der MongoDB-Daten</p> <p>Mount-Point: <code>/data/db</code> (im Container)</p> <p>Backup-Strategie: Siehe Backup-Strategien</p>"},{"location":"deployment/deployment-stand/#service-details","title":"Service-Details","text":""},{"location":"deployment/deployment-stand/#1-clanscore-api","title":"1. clanscore-api","text":""},{"location":"deployment/deployment-stand/#dockerfile-struktur","title":"Dockerfile-Struktur","text":"<p>Multi-Stage Build: 1. Builder Stage (node:20-alpine):    - Installiert Dependencies    - Baut <code>shared</code> Package    - Baut <code>clanscore-api</code> Application</p> <ol> <li>Production Stage (node:20-alpine):</li> <li>Kopiert nur Production Dependencies</li> <li>Kopiert Build-Artefakte</li> <li>Startet Server mit <code>node dist/index.js</code></li> </ol>"},{"location":"deployment/deployment-stand/#konfiguration","title":"Konfiguration","text":"<p>Port: 3000 (intern, nur localhost von aussen erreichbar)</p> <p>Health Check: <pre><code>test: [\"CMD\", \"wget\", \"--quiet\", \"--tries=1\", \"--spider\", \"http://localhost:3000/health || exit 1\"]\ninterval: 30s\ntimeout: 10s\nretries: 3\n</code></pre></p> <p>Umgebungsvariablen: - <code>NODE_ENV=production</code> - <code>MONGO_HOST=mongodb</code> - <code>MONGO_PORT=27017</code> - <code>MONGO_DB</code> (aus <code>.env</code>) - <code>MONGO_INITDB_ROOT_USERNAME</code> (aus <code>.env</code>) - <code>MONGO_INITDB_ROOT_PASSWORD</code> (aus <code>.env</code>) - <code>DISCORD_TOKEN</code> (aus <code>.env</code>) - <code>DISCORD_CLIENT_ID</code> (aus <code>.env</code>) - <code>DISCORD_GUILD_ID</code> (aus <code>.env</code>) - <code>DISCORD_SERVER_PORT</code> (aus <code>.env</code>, Default: 3001) - <code>DISCORD_BOT_WEBHOOK_URL</code> (aus <code>.env</code>, Default: <code>http://discord-bot:3001</code>) - <code>WEBHOOK_SHARED_SECRET</code> (aus <code>.env</code>) - <code>GOOGLE_CALENDAR_CLIENT_ID</code> (aus <code>.env</code>, optional) - <code>GOOGLE_CALENDAR_CLIENT_SECRET</code> (aus <code>.env</code>, optional) - <code>GOOGLE_CALENDAR_REDIRECT_URI</code> (aus <code>.env</code>, optional) - <code>CLANSCORE_ADMIN_PW</code> (aus <code>.env</code>) - <code>CLANSCORE_API_KEY</code> (aus <code>.env</code>) - <code>CLANSCORE_API_URL</code> (aus <code>.env</code>, Default: <code>http://clanscore-api:3000/api</code>) - <code>JWT_SECRET</code> (aus <code>.env</code>) - <code>CORS_ORIGIN</code> (aus <code>.env</code>, Default: <code>http://localhost,http://localhost:4200,http://152.96.10.11,http://srbsci-11.ost.ch</code>)</p> <p>Abh\u00e4ngigkeiten: - <code>mongodb</code> (mit Health Check Condition)</p> <p>Restart-Policy: <code>unless-stopped</code></p>"},{"location":"deployment/deployment-stand/#2-dashboard","title":"2. dashboard","text":""},{"location":"deployment/deployment-stand/#dockerfile-struktur_1","title":"Dockerfile-Struktur","text":"<p>Multi-Stage Build: 1. Builder Stage (node:20-alpine):    - Installiert Build-Tools (python3, make, g++)    - Installiert Dependencies    - Erstellt <code>environment.production.ts</code> mit API URL    - Baut Angular Application</p> <ol> <li>Production Stage (nginx:alpine):</li> <li>Kopiert Nginx-Konfiguration</li> <li>Kopiert Build-Artefakte nach <code>/usr/share/nginx/html</code></li> <li>Startet Nginx</li> </ol>"},{"location":"deployment/deployment-stand/#nginx-konfiguration","title":"Nginx-Konfiguration","text":"<p>Datei: <code>apps/dashboard/nginx.conf</code></p> <p>Features: - Gzip-Kompression - Health Check Proxy (<code>/health</code> \u2192 <code>clanscore-api:3000/health</code>) - API Proxy (<code>/api/*</code> \u2192 <code>clanscore-api:3000/api/*</code>) - Calendar Token OAuth Callback (<code>/calendarToken</code> \u2192 <code>clanscore-api:3000/calendarToken</code>) - Angular Routing Support (Fallback auf <code>index.html</code>) - Statische Asset-Caching (1 Jahr)</p> <p>Wichtige Location-Blocks: 1. <code>/health</code> \u2192 API Health Check 2. <code>/api/health</code> \u2192 API Health Check (spezifisch) 3. <code>/calendarToken</code> \u2192 OAuth Callback 4. <code>/api</code> \u2192 API Proxy 5. <code>/*.(js|css|png|...)</code> \u2192 Statische Assets mit Caching 6. <code>/</code> \u2192 Angular Routing (try_files)</p>"},{"location":"deployment/deployment-stand/#konfiguration_1","title":"Konfiguration","text":"<p>Port: 80 (extern erreichbar)</p> <p>Build-Argument: <code>CLANSCORE_API_URL</code> - Wird zur Build-Zeit verwendet - Wird in <code>environment.production.ts</code> geschrieben - Unterst\u00fctzt vollst\u00e4ndige URLs oder relative Pfade</p> <p>Umgebungsvariablen: Keine (statische Assets)</p> <p>Abh\u00e4ngigkeiten: - <code>clanscore-api</code> (f\u00fcr API-Proxy)</p> <p>Restart-Policy: <code>unless-stopped</code></p>"},{"location":"deployment/deployment-stand/#3-discord-bot","title":"3. discord-bot","text":""},{"location":"deployment/deployment-stand/#dockerfile-struktur_2","title":"Dockerfile-Struktur","text":"<p>Multi-Stage Build: 1. Builder Stage (node:20-alpine):    - Installiert Dependencies    - Baut <code>shared</code> Package    - Baut <code>discord-bot</code> Application</p> <ol> <li>Production Stage (node:20-alpine):</li> <li>Kopiert nur Production Dependencies</li> <li>Kopiert Build-Artefakte</li> <li>Kopiert <code>public</code> Folder (Bot-Ressourcen)</li> <li>Startet Bot mit <code>node dist/index.cjs</code></li> </ol>"},{"location":"deployment/deployment-stand/#konfiguration_2","title":"Konfiguration","text":"<p>Port: 3001 (extern erreichbar, konfigurierbar via <code>DISCORD_SERVER_PORT</code>)</p> <p>Umgebungsvariablen: - <code>NODE_ENV=production</code> - <code>DISCORD_TOKEN</code> (aus <code>.env</code>) - <code>DISCORD_CLIENT_ID</code> (aus <code>.env</code>) - <code>DISCORD_GUILD_ID</code> (aus <code>.env</code>) - <code>DISCORD_SERVER_PORT</code> (aus <code>.env</code>, Default: 3001) - <code>WEBHOOK_SHARED_SECRET</code> (aus <code>.env</code>) - <code>GOOGLE_CALENDAR_CLIENT_ID</code> (aus <code>.env</code>, optional) - <code>GOOGLE_CALENDAR_CLIENT_SECRET</code> (aus <code>.env</code>, optional) - <code>GOOGLE_CALENDAR_REDIRECT_URI</code> (aus <code>.env</code>, optional) - <code>CLANSCORE_API_URL</code> (aus <code>.env</code>, Default: <code>http://clanscore-api:3000/api</code>) - <code>CLANSCORE_API_KEY</code> (aus <code>.env</code>) - <code>MONGO_HOST=mongodb</code> - <code>MONGO_PORT=27017</code> - <code>MONGO_DB</code> (aus <code>.env</code>) - <code>MONGO_INITDB_ROOT_USERNAME</code> (aus <code>.env</code>) - <code>MONGO_INITDB_ROOT_PASSWORD</code> (aus <code>.env</code>)</p> <p>Abh\u00e4ngigkeiten: - <code>clanscore-api</code> - <code>mongodb</code></p> <p>Restart-Policy: <code>unless-stopped</code></p> <p>Funktionen: - Discord Slash Commands - Webhook-Server (Port 3001) - Event-Synchronisation mit Google Calendar - API-Integration mit clanscore-api</p>"},{"location":"deployment/deployment-stand/#4-mongodb","title":"4. mongodb","text":""},{"location":"deployment/deployment-stand/#konfiguration_3","title":"Konfiguration","text":"<p>Image: <code>mongo:8</code></p> <p>Port: 27017 (extern erreichbar)</p> <p>Health Check: <pre><code>test: [\"CMD\", \"mongosh\", \"--quiet\", \"--eval\", \"db.adminCommand('ping').ok || exit(1)\"]\ninterval: 10s\ntimeout: 5s\nretries: 5\nstart_period: 40s\n</code></pre></p> <p>Umgebungsvariablen: - <code>MONGO_INITDB_ROOT_USERNAME</code> (aus <code>.env</code>) - <code>MONGO_INITDB_ROOT_PASSWORD</code> (aus <code>.env</code>)</p> <p>Volumes: - <code>mongo_data:/data/db</code> (persistente Daten)</p> <p>Restart-Policy: <code>unless-stopped</code></p> <p>Datenbank-Name: Konfigurierbar via <code>MONGO_DB</code> (Default: <code>clanscore</code>)</p>"},{"location":"deployment/deployment-stand/#build-prozesse","title":"Build-Prozesse","text":""},{"location":"deployment/deployment-stand/#build-ordnung","title":"Build-Ordnung","text":"<p>Aufgrund der Workspace-Struktur m\u00fcssen Services in folgender Reihenfolge gebaut werden:</p> <ol> <li>shared Package (wird von allen Apps ben\u00f6tigt)</li> <li>clanscore-api (ben\u00f6tigt shared)</li> <li>discord-bot (ben\u00f6tigt shared)</li> <li>dashboard (unabh\u00e4ngig, aber ben\u00f6tigt API f\u00fcr Proxy)</li> </ol>"},{"location":"deployment/deployment-stand/#build-strategien","title":"Build-Strategien","text":""},{"location":"deployment/deployment-stand/#lokaler-build-standard","title":"Lokaler Build (Standard)","text":"<pre><code>docker-compose build\n</code></pre> <p>Vorteile: - Keine externe Abh\u00e4ngigkeit - Volle Kontrolle \u00fcber Build-Prozess - Kann lokal getestet werden</p> <p>Nachteile: - Langsamer (baut alles lokal) - Ben\u00f6tigt Build-Tools auf Host</p>"},{"location":"deployment/deployment-stand/#build-optimierungen","title":"Build-Optimierungen","text":""},{"location":"deployment/deployment-stand/#layer-caching","title":"Layer-Caching","text":"<p>Dockerfiles sind optimiert f\u00fcr Layer-Caching: 1. Dependencies werden vor Source-Code kopiert 2. Source-Code wird erst nach Dependencies kopiert 3. \u00c4nderungen am Source-Code invalidieren nur relevante Layers</p>"},{"location":"deployment/deployment-stand/#multi-stage-builds","title":"Multi-Stage Builds","text":"<p>Alle Dockerfiles verwenden Multi-Stage Builds: - Builder Stage: Enth\u00e4lt alle Build-Tools und Dependencies - Production Stage: Enth\u00e4lt nur Runtime-Dependencies und Artefakte</p> <p>Vorteile: - Kleinere finale Images - Keine Build-Tools in Production - Bessere Sicherheit</p>"},{"location":"deployment/deployment-stand/#build-zeiten-schatzungen","title":"Build-Zeiten (Sch\u00e4tzungen)","text":"<ul> <li>shared: ~30 Sekunden</li> <li>clanscore-api: ~2-3 Minuten</li> <li>discord-bot: ~2-3 Minuten</li> <li>dashboard: ~5-7 Minuten (Angular Build)</li> </ul> <p>Gesamt: ~10-15 Minuten (bei Clean Build)</p>"},{"location":"deployment/deployment-stand/#netzwerk-architektur","title":"Netzwerk-Architektur","text":""},{"location":"deployment/deployment-stand/#port-mappings","title":"Port-Mappings","text":"Service Container-Port Host-Port Zugriff dashboard 80 80 Extern (HTTP) clanscore-api 3000 127.0.0.1:3000 Nur localhost discord-bot 3001 3001 Extern (Webhooks) mongodb 27017 27017 Extern (optional)"},{"location":"deployment/deployment-stand/#interne-kommunikation","title":"Interne Kommunikation","text":"<p>Alle Services kommunizieren \u00fcber Docker DNS:</p> <ul> <li><code>mongodb</code> \u2192 <code>mongodb:27017</code></li> <li><code>clanscore-api</code> \u2192 <code>clanscore-api:3000</code></li> <li><code>discord-bot</code> \u2192 <code>discord-bot:3001</code></li> </ul>"},{"location":"deployment/deployment-stand/#externe-kommunikation","title":"Externe Kommunikation","text":"<ul> <li>Dashboard: HTTP auf Port 80</li> <li>API: Nur \u00fcber Dashboard-Proxy (<code>/api/*</code>) oder localhost:3000</li> <li>Discord Bot: HTTP auf Port 3001 (f\u00fcr Webhooks)</li> <li>MongoDB: Port 27017 (optional, f\u00fcr direkten Zugriff)</li> </ul>"},{"location":"deployment/deployment-stand/#firewall-empfehlungen","title":"Firewall-Empfehlungen","text":"<p>\u00d6ffentlich erreichbar: - Port 80 (HTTP) - Port 443 (HTTPS, falls SSL konfiguriert) - Port 22 (SSH)</p> <p>Optional erreichbar: - Port 3001 (Discord Bot Webhooks, falls extern ben\u00f6tigt) - Port 27017 (MongoDB, nur f\u00fcr direkten Zugriff)</p> <p>Nicht erreichbar: - Port 3000 (API, nur \u00fcber Dashboard-Proxy)</p>"},{"location":"deployment/deployment-stand/#umgebungsvariablen-und-secrets","title":"Umgebungsvariablen und Secrets","text":""},{"location":"deployment/deployment-stand/#env-datei-fur-server-deployment","title":"<code>.env</code> Datei f\u00fcr Server-Deployment","text":"<p>F\u00fcr das manuelle Deployment auf dem Server wird eine <code>.env</code> Datei im Root-Verzeichnis ben\u00f6tigt.</p> <p>Erstellen der <code>.env</code> Datei:</p> <pre><code># Auf dem Server\ncp .env.example .env\nnano .env  # Alle Werte anpassen\n</code></pre> <p>Wichtig:  - Die <code>.env</code> Datei enth\u00e4lt sensible Daten und wird nicht in Git committed! - Die Datei muss im Root-Verzeichnis des Projekts liegen (gleiche Ebene wie <code>docker-compose.yml</code>)</p>"},{"location":"deployment/deployment-stand/#vollstandige-env-vorlage","title":"Vollst\u00e4ndige .env Vorlage","text":"<p>Kopiere diese Vorlage und f\u00fclle alle Werte aus:</p> <pre><code># ============================================\n# MongoDB Konfiguration\n# ============================================\nMONGO_INITDB_ROOT_USERNAME=admin\nMONGO_INITDB_ROOT_PASSWORD=your-secure-password-here\nMONGO_DB=clanscore\n\n# ============================================\n# Discord Bot Konfiguration\n# ============================================\nDISCORD_TOKEN=your-discord-bot-token-here\nDISCORD_CLIENT_ID=your-discord-client-id-here\nDISCORD_GUILD_ID=your-discord-guild-id-here\nDISCORD_SERVER_PORT=3001\n\n# ============================================\n# Webhook Konfiguration\n# ============================================\nWEBHOOK_SHARED_SECRET=your-webhook-shared-secret-here\nDISCORD_BOT_WEBHOOK_URL=http://discord-bot:3001\n\n# ============================================\n# Google Calendar OAuth (Optional)\n# ============================================\nGOOGLE_CALENDAR_CLIENT_ID=your-google-calendar-client-id\nGOOGLE_CALENDAR_CLIENT_SECRET=your-google-calendar-client-secret\nGOOGLE_CALENDAR_REDIRECT_URI=http://your-domain.com/calendarToken\n\n# ============================================\n# API Konfiguration\n# ============================================\nCLANSCORE_API_URL=http://clanscore-api:3000/api\nCLANSCORE_API_KEY=your-api-key-here\nCLANSCORE_ADMIN_PW=your-admin-password-here\nJWT_SECRET=your-jwt-secret-here\nCORS_ORIGIN=http://localhost,http://localhost:4200,http://152.96.10.11,http://srbsci-11.ost.ch\n</code></pre>"},{"location":"deployment/deployment-stand/#erforderliche-umgebungsvariablen-detailliert","title":"Erforderliche Umgebungsvariablen (Detailliert)","text":""},{"location":"deployment/deployment-stand/#mongodb","title":"MongoDB","text":"Variable Beschreibung Beispiel <code>MONGO_INITDB_ROOT_USERNAME</code> MongoDB Root Username <code>admin</code> <code>MONGO_INITDB_ROOT_PASSWORD</code> MongoDB Root Password <code>secure-password</code> <code>MONGO_DB</code> Datenbank-Name <code>clanscore</code>"},{"location":"deployment/deployment-stand/#discord-bot","title":"Discord Bot","text":"Variable Beschreibung Beispiel <code>DISCORD_TOKEN</code> Discord Bot Token <code>...</code> <code>DISCORD_CLIENT_ID</code> Discord Application Client ID <code>123456789</code> <code>DISCORD_GUILD_ID</code> Discord Server (Guild) ID <code>987654321</code> <code>DISCORD_SERVER_PORT</code> Webhook Server Port <code>3001</code>"},{"location":"deployment/deployment-stand/#webhooks","title":"Webhooks","text":"Variable Beschreibung Beispiel <code>WEBHOOK_SHARED_SECRET</code> Geheimer Schl\u00fcssel f\u00fcr Webhook-Authentifizierung <code>random-secret-key</code> <code>DISCORD_BOT_WEBHOOK_URL</code> URL des Discord Bot Webhook-Servers <code>http://discord-bot:3001</code>"},{"location":"deployment/deployment-stand/#google-calendar-oauth","title":"Google Calendar OAuth","text":"Variable Beschreibung Beispiel <code>GOOGLE_CALENDAR_CLIENT_ID</code> Google OAuth Client ID <code>...</code> <code>GOOGLE_CALENDAR_CLIENT_SECRET</code> Google OAuth Client Secret <code>...</code> <code>GOOGLE_CALENDAR_REDIRECT_URI</code> OAuth Redirect URI <code>http://your-domain.com/calendarToken</code>"},{"location":"deployment/deployment-stand/#api-konfiguration","title":"API Konfiguration","text":"Variable Beschreibung Beispiel <code>CLANSCORE_API_URL</code> API Base URL <code>http://clanscore-api:3000/api</code> <code>CLANSCORE_API_KEY</code> API Key f\u00fcr Service-to-Service Auth <code>api-key-here</code> <code>CLANSCORE_ADMIN_PW</code> Admin-Passwort <code>admin-password</code> <code>JWT_SECRET</code> Geheimer Schl\u00fcssel f\u00fcr JWT-Tokens <code>jwt-secret-key</code> <code>CORS_ORIGIN</code> Erlaubte CORS Origins (komma-separiert) <code>http://localhost,http://your-domain.com</code>"},{"location":"deployment/deployment-stand/#dashboard-konfiguration","title":"Dashboard Konfiguration","text":"Variable Beschreibung Beispiel <code>CLANSCORE_API_URL</code> API URL f\u00fcr Dashboard Build <code>http://clanscore-api:3000/api</code> oder <code>/api</code> <p>| <code>DOCKERHUB_TOKEN</code> | Docker Hub Access Token | <code>...</code> |</p>"},{"location":"deployment/deployment-stand/#umgebungsvariablen-mapping","title":"Umgebungsvariablen-Mapping","text":"<p>Die Umgebungsvariablen werden in den Services wie folgt verwendet:</p>"},{"location":"deployment/deployment-stand/#clanscore-api","title":"clanscore-api","text":"<p>Alle oben genannten Variablen werden an den Container weitergegeben.</p>"},{"location":"deployment/deployment-stand/#discord-bot_1","title":"discord-bot","text":"<p>Verwendet: - Discord-Konfiguration - Webhook-Konfiguration - Google Calendar OAuth - API-Konfiguration - MongoDB-Konfiguration</p>"},{"location":"deployment/deployment-stand/#dashboard","title":"dashboard","text":"<p>Verwendet nur: - <code>CLANSCORE_API_URL</code> (zur Build-Zeit als Build-Argument)</p>"},{"location":"deployment/deployment-stand/#mongodb_1","title":"mongodb","text":"<p>Verwendet nur: - <code>MONGO_INITDB_ROOT_USERNAME</code> - <code>MONGO_INITDB_ROOT_PASSWORD</code></p>"},{"location":"deployment/deployment-stand/#deployment-methoden","title":"Deployment-Methoden","text":""},{"location":"deployment/deployment-stand/#1-manuelles-deployment","title":"1. Manuelles Deployment","text":""},{"location":"deployment/deployment-stand/#mit-deployment-skripten","title":"Mit Deployment-Skripten","text":"<p>Linux/Mac: <pre><code>./deploy.sh\n</code></pre></p> <p>Windows PowerShell: <pre><code>.\\deploy.ps1\n</code></pre></p> <p>Was die Skripte tun: 1. Pr\u00fcfen ob <code>.env</code> existiert 2. Pr\u00fcfen ob Docker installiert ist 3. Stoppen laufende Services 4. Bauen Images 5. Starten Services 6. Pr\u00fcfen Container-Status 7. Zeigen Logs bei Fehlern</p>"},{"location":"deployment/deployment-stand/#manuell-mit-docker-compose","title":"Manuell mit Docker Compose","text":"<pre><code># Services bauen und starten\ndocker-compose up -d --build\n\n# Status pr\u00fcfen\ndocker-compose ps\n\n# Logs anzeigen\ndocker-compose logs -f\n</code></pre>"},{"location":"deployment/deployment-stand/#health-checks-und-monitoring","title":"Health Checks und Monitoring","text":""},{"location":"deployment/deployment-stand/#health-check-endpunkte","title":"Health Check Endpunkte","text":""},{"location":"deployment/deployment-stand/#clanscore-api_1","title":"clanscore-api","text":"<p>Endpoint: <code>http://localhost:3000/health</code></p> <p>Methode: GET</p> <p>Response: HTTP 200 OK (wenn gesund)</p> <p>Docker Health Check: <pre><code>test: [\"CMD\", \"wget\", \"--quiet\", \"--tries=1\", \"--spider\", \"http://localhost:3000/health || exit 1\"]\ninterval: 30s\ntimeout: 10s\nretries: 3\n</code></pre></p>"},{"location":"deployment/deployment-stand/#mongodb_2","title":"mongodb","text":"<p>Docker Health Check: <pre><code>test: [\"CMD\", \"mongosh\", \"--quiet\", \"--eval\", \"db.adminCommand('ping').ok || exit(1)\"]\ninterval: 10s\ntimeout: 5s\nretries: 5\nstart_period: 40s\n</code></pre></p>"},{"location":"deployment/deployment-stand/#health-check-status-prufen","title":"Health Check Status pr\u00fcfen","text":"<pre><code># Alle Container-Status\ndocker-compose ps\n\n# Health Check Logs\ndocker inspect --format='{{json .State.Health}}' &lt;container-name&gt; | jq\n\n# Manueller Health Check\ncurl http://localhost:3000/health\n</code></pre>"},{"location":"deployment/deployment-stand/#monitoring-befehle","title":"Monitoring-Befehle","text":"<pre><code># Container-Status\ndocker-compose ps\n\n# Container-Logs\ndocker-compose logs -f\n\n# Ressourcen-Nutzung\ndocker stats\n\n# System-Ressourcen\nhtop\ndf -h\n</code></pre>"},{"location":"deployment/deployment-stand/#logging","title":"Logging","text":""},{"location":"deployment/deployment-stand/#logs-anzeigen","title":"Logs anzeigen","text":"<pre><code># Alle Services\ndocker-compose logs -f\n\n# Einzelner Service\ndocker-compose logs -f clanscore-api\ndocker-compose logs -f discord-bot\ndocker-compose logs -f dashboard\ndocker-compose logs -f mongodb\n\n# Letzte 100 Zeilen\ndocker-compose logs --tail=100\n\n# Seit bestimmter Zeit\ndocker-compose logs --since 10m\n</code></pre>"},{"location":"deployment/deployment-stand/#log-rotation","title":"Log-Rotation","text":"<p>Docker verwaltet Logs automatisch. F\u00fcr manuelle Rotation:</p> <pre><code># Logs l\u00f6schen (Container muss laufen)\ndocker-compose logs --tail=0 -f &gt; /dev/null\n</code></pre> <p>Oder in <code>docker-compose.yml</code> konfigurieren:</p> <pre><code>logging:\n  driver: \"json-file\"\n  options:\n    max-size: \"10m\"\n    max-file: \"3\"\n</code></pre>"},{"location":"deployment/deployment-stand/#backup-strategien","title":"Backup-Strategien","text":""},{"location":"deployment/deployment-stand/#mongodb-backup","title":"MongoDB Backup","text":""},{"location":"deployment/deployment-stand/#manuelles-backup","title":"Manuelles Backup","text":"<pre><code># Backup erstellen\ndocker-compose exec mongodb mongodump --out /data/backup\n\n# Backup aus Container kopieren\ndocker cp clanscore-mongodb:/data/backup ./backup-$(date +%Y%m%d)\n</code></pre>"},{"location":"deployment/deployment-stand/#backup-container","title":"Backup-Container","text":"<p>Dockerfile: <code>backup/Dockerfile</code></p> <p>Zweck: Dedizierter Container f\u00fcr Backups</p> <p>Verwendung: <pre><code># Backup-Skript ausf\u00fchren\ndocker run --rm \\\n  --network clanscore-network \\\n  -v $(pwd)/backups:/backups \\\n  -e MONGO_HOST=mongodb \\\n  -e MONGO_PORT=27017 \\\n  -e MONGO_DB=clanscore \\\n  -e MONGO_USER=admin \\\n  -e MONGO_PASSWORD=password \\\n  backup-image \\\n  mongodump --host=$MONGO_HOST --port=$MONGO_PORT --db=$MONGO_DB --out=/backups/$(date +%Y%m%d)\n</code></pre></p>"},{"location":"deployment/deployment-stand/#automatisches-backup","title":"Automatisches Backup","text":"<p>Backup-Skripte: - <code>backup/backup.sh</code> (Linux/Mac) - <code>backup/backup.ps1</code> (Windows)</p> <p>Cron-Job Beispiel (Linux): <pre><code># T\u00e4glich um 2 Uhr morgens\n0 2 * * * cd /path/to/clanscore &amp;&amp; ./backup/backup.sh\n</code></pre></p>"},{"location":"deployment/deployment-stand/#backup-wiederherstellung","title":"Backup-Wiederherstellung","text":"<pre><code># Backup wiederherstellen\ndocker-compose exec mongodb mongorestore /data/backup\n\n# Oder von externem Backup\ndocker cp ./backup-20240101 clanscore-mongodb:/data/backup\ndocker-compose exec mongodb mongorestore /data/backup\n</code></pre>"},{"location":"deployment/deployment-stand/#backup-best-practices","title":"Backup-Best Practices","text":"<ol> <li>Regelm\u00e4ssige Backups: T\u00e4glich oder w\u00f6chentlich</li> <li>Offsite-Backups: Backups auf externem Server speichern</li> <li>Backup-Tests: Regelm\u00e4ssig Backups testen</li> <li>Retention-Policy: Alte Backups nach X Tagen l\u00f6schen</li> <li>Verschl\u00fcsselung: Sensitive Backups verschl\u00fcsseln</li> </ol>"},{"location":"deployment/deployment-stand/#sicherheit","title":"Sicherheit","text":""},{"location":"deployment/deployment-stand/#container-sicherheit","title":"Container-Sicherheit","text":""},{"location":"deployment/deployment-stand/#best-practices","title":"Best Practices","text":"<ol> <li>Non-Root User: Services laufen als non-root User (Node.js Alpine Images)</li> <li>Read-Only Filesystems: Optional f\u00fcr Production</li> <li>Resource Limits: Verhindert DoS-Angriffe</li> <li>Network Isolation: Services nur im Docker-Netzwerk erreichbar</li> </ol>"},{"location":"deployment/deployment-stand/#security-scanning","title":"Security Scanning","text":"<pre><code># Docker Images scannen (mit Docker Scout oder Trivy)\ndocker scout cves clanscore-api:latest\n</code></pre>"},{"location":"deployment/deployment-stand/#secrets-sicherheit","title":"Secrets-Sicherheit","text":"<ol> <li>Nie in Git: <code>.env</code> Dateien niemals committen</li> <li>Rotation: Secrets regelm\u00e4ssig rotieren</li> <li>Zugriffskontrolle: Nur autorisierte Personen haben Zugriff</li> </ol>"},{"location":"deployment/deployment-stand/#netzwerk-sicherheit","title":"Netzwerk-Sicherheit","text":"<ol> <li>Firewall: Nur notwendige Ports \u00f6ffnen</li> <li>API-Isolation: API nur \u00fcber Dashboard-Proxy erreichbar</li> <li>MongoDB: Optional nur intern erreichbar</li> <li>HTTPS: SSL/TLS f\u00fcr Production (Let's Encrypt)</li> </ol>"},{"location":"deployment/deployment-stand/#authentifizierung","title":"Authentifizierung","text":""},{"location":"deployment/deployment-stand/#api-authentifizierung","title":"API-Authentifizierung","text":"<ul> <li>JWT Tokens: F\u00fcr Dashboard-Benutzer</li> <li>API Keys: F\u00fcr Service-to-Service Kommunikation</li> <li>Webhook Secrets: F\u00fcr Webhook-Authentifizierung</li> </ul>"},{"location":"deployment/deployment-stand/#mongodb-authentifizierung","title":"MongoDB-Authentifizierung","text":"<ul> <li>Root Credentials: Starke Passw\u00f6rter verwenden</li> <li>Database Users: Separate User f\u00fcr verschiedene Services (optional)</li> </ul>"},{"location":"deployment/deployment-stand/#updates-und-patches","title":"Updates und Patches","text":"<ol> <li>Regelm\u00e4ssige Updates: Docker Images regelm\u00e4ssig aktualisieren</li> <li>Security Patches: Sofortige Installation von Security Patches</li> <li>Dependency Updates: npm Dependencies regelm\u00e4ssig updaten</li> <li>Base Images: Aktuelle Base Images verwenden</li> </ol>"},{"location":"deployment/deployment-stand/#troubleshooting","title":"Troubleshooting","text":""},{"location":"deployment/deployment-stand/#haufige-probleme","title":"H\u00e4ufige Probleme","text":""},{"location":"deployment/deployment-stand/#1-container-startet-nicht","title":"1. Container startet nicht","text":"<p>Symptome: - Container im Status \"Exited\" oder \"Restarting\" - Logs zeigen Fehler</p> <p>L\u00f6sung: <pre><code># Logs pr\u00fcfen\ndocker-compose logs &lt;service-name&gt;\n\n# Container-Status pr\u00fcfen\ndocker-compose ps\n\n# Container neu starten\ndocker-compose restart &lt;service-name&gt;\n</code></pre></p>"},{"location":"deployment/deployment-stand/#2-mongodb-verbindungsfehler","title":"2. MongoDB-Verbindungsfehler","text":"<p>Symptome: - API kann nicht mit MongoDB verbinden - Fehler: \"MongoNetworkError\" oder \"Authentication failed\"</p> <p>L\u00f6sung: <pre><code># MongoDB-Status pr\u00fcfen\ndocker-compose ps mongodb\n\n# MongoDB-Logs pr\u00fcfen\ndocker-compose logs mongodb\n\n# Credentials pr\u00fcfen\ndocker-compose config | grep MONGO\n\n# MongoDB manuell testen\ndocker-compose exec mongodb mongosh -u $MONGO_INITDB_ROOT_USERNAME -p $MONGO_INITDB_ROOT_PASSWORD\n</code></pre></p>"},{"location":"deployment/deployment-stand/#3-api-nicht-erreichbar","title":"3. API nicht erreichbar","text":"<p>Symptome: - Dashboard kann API nicht erreichen - CORS-Fehler im Browser</p> <p>L\u00f6sung: <pre><code># API-Status pr\u00fcfen\ndocker-compose ps clanscore-api\n\n# API-Logs pr\u00fcfen\ndocker-compose logs clanscore-api\n\n# Health Check testen\ncurl http://localhost:3000/health\n\n# CORS-Origin pr\u00fcfen\ndocker-compose config | grep CORS_ORIGIN\n</code></pre></p>"},{"location":"deployment/deployment-stand/#4-discord-bot-verbindet-nicht","title":"4. Discord Bot verbindet nicht","text":"<p>Symptome: - Bot antwortet nicht auf Commands - Fehler: \"Invalid token\" oder \"Missing intents\"</p> <p>L\u00f6sung: <pre><code># Bot-Logs pr\u00fcfen\ndocker-compose logs discord-bot\n\n# Token pr\u00fcfen (nur erste/last Zeichen)\ndocker-compose config | grep DISCORD_TOKEN\n\n# Bot neu starten\ndocker-compose restart discord-bot\n</code></pre></p>"},{"location":"deployment/deployment-stand/#5-dashboard-zeigt-fehler","title":"5. Dashboard zeigt Fehler","text":"<p>Symptome: - Dashboard l\u00e4dt nicht - API-Calls schlagen fehl</p> <p>L\u00f6sung: <pre><code># Dashboard-Logs pr\u00fcfen\ndocker-compose logs dashboard\n\n# Nginx-Status pr\u00fcfen\ndocker-compose exec dashboard nginx -t\n\n# API-URL pr\u00fcfen (im Build)\ndocker inspect clanscore-dashboard | grep CLANSCORE_API_URL\n</code></pre></p>"},{"location":"deployment/deployment-stand/#debug-befehle","title":"Debug-Befehle","text":"<pre><code># Container-Shell \u00f6ffnen\ndocker-compose exec &lt;service-name&gt; sh\n\n# Container-Environment pr\u00fcfen\ndocker-compose exec &lt;service-name&gt; env\n\n# Netzwerk-Verbindung testen\ndocker-compose exec &lt;service-name&gt; ping &lt;other-service&gt;\n\n# Port-Verf\u00fcgbarkeit pr\u00fcfen\ndocker-compose exec &lt;service-name&gt; wget -O- http://other-service:port\n</code></pre>"},{"location":"deployment/deployment-stand/#log-analyse","title":"Log-Analyse","text":"<pre><code># Fehler in Logs suchen\ndocker-compose logs | grep -i error\n\n# Warnungen in Logs suchen\ndocker-compose logs | grep -i warn\n\n# Letzte 50 Zeilen mit Fehlern\ndocker-compose logs --tail=50 | grep -i error\n</code></pre>"},{"location":"deployment/deployment-stand/#performance-probleme","title":"Performance-Probleme","text":"<pre><code># Ressourcen-Nutzung pr\u00fcfen\ndocker stats\n\n# Container-Logs auf Performance-Issues pr\u00fcfen\ndocker-compose logs | grep -i \"slow\\|timeout\\|memory\"\n\n# MongoDB-Performance pr\u00fcfen\ndocker-compose exec mongodb mongosh --eval \"db.serverStatus()\"\n</code></pre>"},{"location":"deployment/deployment-stand/#anhang","title":"Anhang","text":""},{"location":"deployment/deployment-stand/#nutzliche-befehle","title":"N\u00fctzliche Befehle","text":"<pre><code># Alle Services stoppen\ndocker-compose down\n\n# Services stoppen und Volumes l\u00f6schen\ndocker-compose down -v\n\n# Services neu bauen (ohne Cache)\ndocker-compose build --no-cache\n\n# Alte Images aufr\u00e4umen\ndocker system prune -a\n\n# Docker-System-Info\ndocker system df\ndocker system info\n\n# Container-Statistiken\ndocker stats\n\n# Netzwerk-Info\ndocker network inspect clanscore-network\n\n# Volume-Info\ndocker volume inspect clanscore_mongo_data\n</code></pre>"},{"location":"deployment/deployment-stand/#referenzen","title":"Referenzen","text":"<ul> <li>Docker Compose Dokumentation</li> <li>Docker Best Practices</li> <li>MongoDB Docker Image</li> <li>Node.js Docker Image</li> <li>Nginx Docker Image</li> </ul>"},{"location":"deployment/deployment-stand/#support","title":"Support","text":"<p>Bei Problemen: 1. Pr\u00fcfe die Logs: <code>docker-compose logs -f</code> 2. Pr\u00fcfe diese Dokumentation 3. Pr\u00fcfe die Troubleshooting-Sektion 4. Erstelle ein Issue im GitHub Repository</p> <p>Dokumentations-Version: 1.0 Letzte Aktualisierung: 2024-01-XX Verfasser: ClansCore Development Team</p>"},{"location":"deployment/details/","title":"\ud83d\udd27 Deployment Details","text":"<p>Erweiterte Konfiguration und Details f\u00fcr das Production-Deployment des ClansCore-Systems.</p>"},{"location":"deployment/details/#erweiterte-konfiguration","title":"Erweiterte Konfiguration","text":""},{"location":"deployment/details/#reverse-proxy-mit-nginx-empfohlen-fur-production","title":"Reverse Proxy mit Nginx (Empfohlen f\u00fcr Production)","text":"<p>F\u00fcr Production solltest du einen Reverse Proxy verwenden:</p> <ol> <li> <p>Nginx auf dem Server installieren: <pre><code>sudo apt update\nsudo apt install nginx\n</code></pre></p> </li> <li> <p>Nginx-Konfiguration erstellen (<code>/etc/nginx/sites-available/clanscore</code>):</p> </li> </ol> <pre><code>server {\n    listen 80;\n    server_name your-domain.com;\n\n    # Dashboard\n    location / {\n        proxy_pass http://localhost:80;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n\n    # API\n    location /api {\n        proxy_pass http://localhost:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n</code></pre> <ol> <li>Konfiguration aktivieren: <pre><code>sudo ln -s /etc/nginx/sites-available/clanscore /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl reload nginx\n</code></pre></li> </ol>"},{"location":"deployment/details/#ssltls-mit-lets-encrypt","title":"SSL/TLS mit Let's Encrypt","text":"<pre><code>sudo apt install certbot python3-certbot-nginx\nsudo certbot --nginx -d your-domain.com\n</code></pre>"},{"location":"deployment/details/#firewall-konfigurieren","title":"Firewall konfigurieren","text":"<pre><code># UFW Firewall\nsudo ufw allow 22/tcp    # SSH\nsudo ufw allow 80/tcp    # HTTP\nsudo ufw allow 443/tcp   # HTTPS\nsudo ufw enable\n</code></pre>"},{"location":"deployment/details/#wartung","title":"Wartung","text":""},{"location":"deployment/details/#logs-anzeigen","title":"Logs anzeigen","text":"<pre><code># Alle Services\ndocker-compose logs -f\n\n# Einzelner Service\ndocker-compose logs -f clanscore-api\ndocker-compose logs -f discord-bot\ndocker-compose logs -f dashboard\n</code></pre>"},{"location":"deployment/details/#services-neu-starten","title":"Services neu starten","text":"<pre><code># Alle Services\ndocker-compose restart\n\n# Einzelner Service\ndocker-compose restart clanscore-api\n</code></pre>"},{"location":"deployment/details/#updates-deployen","title":"Updates deployen","text":"<pre><code># Code aktualisieren\ngit pull\n\n# Services neu bauen und starten\ndocker-compose up -d --build\n\n# Alte Images aufr\u00e4umen\ndocker system prune -a\n</code></pre>"},{"location":"deployment/details/#datenbank-backup","title":"Datenbank-Backup","text":"<pre><code># Backup erstellen\ndocker-compose exec mongodb mongodump --out /data/backup\n\n# Backup wiederherstellen\ndocker-compose exec mongodb mongorestore /data/backup\n</code></pre> <p>F\u00fcr detaillierte Backup-Informationen siehe Backup Guide.</p>"},{"location":"deployment/details/#troubleshooting","title":"Troubleshooting","text":""},{"location":"deployment/details/#service-startet-nicht","title":"Service startet nicht","text":"<ol> <li> <p>Logs pr\u00fcfen: <pre><code>docker-compose logs &lt;service-name&gt;\n</code></pre></p> </li> <li> <p>Container-Status pr\u00fcfen: <pre><code>docker-compose ps\ndocker ps -a\n</code></pre></p> </li> <li> <p>Umgebungs-Variablen pr\u00fcfen: <pre><code>docker-compose config\n</code></pre></p> </li> </ol>"},{"location":"deployment/details/#mongodb-verbindungsfehler","title":"MongoDB-Verbindungsfehler","text":"<ul> <li>Pr\u00fcfe, ob MongoDB l\u00e4uft: <code>docker-compose ps mongodb</code></li> <li>Pr\u00fcfe die Environment-Variablen f\u00fcr MongoDB</li> <li>Pr\u00fcfe die Netzwerk-Konfiguration</li> </ul>"},{"location":"deployment/details/#discord-bot-verbindet-nicht","title":"Discord Bot verbindet nicht","text":"<ul> <li>Pr\u00fcfe den <code>DISCORD_TOKEN</code></li> <li>Pr\u00fcfe die Logs: <code>docker-compose logs discord-bot</code></li> <li>Stelle sicher, dass der Bot die richtigen Intents hat</li> </ul>"},{"location":"deployment/details/#dashboard-kann-api-nicht-erreichen","title":"Dashboard kann API nicht erreichen","text":"<ul> <li>Pr\u00fcfe die <code>apiUrl</code> in der Environment-Datei</li> <li>Pr\u00fcfe die CORS-Konfiguration in der API</li> <li>Pr\u00fcfe die Netzwerk-Konnektivit\u00e4t zwischen Containern</li> </ul>"},{"location":"deployment/details/#monitoring","title":"Monitoring","text":""},{"location":"deployment/details/#health-checks","title":"Health Checks","text":"<p>Die Services haben Health Checks konfiguriert. Pr\u00fcfe den Status:</p> <pre><code>docker-compose ps\n</code></pre>"},{"location":"deployment/details/#ressourcen-monitoring","title":"Ressourcen-Monitoring","text":"<pre><code># Container-Ressourcen\ndocker stats\n\n# System-Ressourcen\nhtop\ndf -h\n</code></pre>"},{"location":"deployment/details/#sicherheit","title":"Sicherheit","text":"<ul> <li>Umgebungs-Variablen: Niemals <code>.env</code> in Git committen</li> <li>Passw\u00f6rter: Verwende starke, eindeutige Passw\u00f6rter</li> <li>Firewall: Beschr\u00e4nke den Zugriff auf notwendige Ports</li> <li>Updates: Halte Docker und das System aktuell</li> <li>Backups: Regelm\u00e4ssige Backups der Datenbank</li> </ul>"},{"location":"deployment/details/#weitere-informationen","title":"Weitere Informationen","text":"<ul> <li>Deployment Setup - Schnellstart-Anleitung</li> <li>Vollst\u00e4ndiger Deployment Guide - Detaillierte Schritt-f\u00fcr-Schritt-Anleitung</li> <li>Server-spezifische Anleitung - F\u00fcr srbsci-11.ost.ch</li> <li>Deployment-Skripte - Automatisierte Deployment-Tools</li> </ul>"},{"location":"deployment/details/#support","title":"Support","text":"<p>Bei Problemen: 1. Pr\u00fcfe die Logs 2. Pr\u00fcfe die Dokumentation 3. Erstelle ein Issue im GitHub Repository</p>"},{"location":"deployment/guide/","title":"Deployment Guide - ClansCore","text":"<p>Dieser Guide erkl\u00e4rt, wie du die drei Anwendungen (ClansCore-api, dashboard, discord-bot) auf einem virtuellen Server deployen kannst.</p>"},{"location":"deployment/guide/#voraussetzungen","title":"Voraussetzungen","text":"<ul> <li>Virtueller Server mit:</li> <li>Docker (Version 20.10 oder h\u00f6her)</li> <li>Docker Compose (Version 2.0 oder h\u00f6her)</li> <li>Mindestens 2GB RAM</li> <li>Mindestens 10GB freier Speicherplatz</li> </ul>"},{"location":"deployment/guide/#schnellstart","title":"Schnellstart","text":""},{"location":"deployment/guide/#1-server-vorbereiten","title":"1. Server vorbereiten","text":"<pre><code># Docker installieren (Ubuntu/Debian)\ncurl -fsSL https://get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\nsudo usermod -aG docker $USER\n\n# Docker Compose installieren\nsudo curl -L \"https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\n\n# Neu einloggen, damit Docker-Gruppe aktiv wird\n</code></pre>"},{"location":"deployment/guide/#2-projekt-auf-server-kopieren","title":"2. Projekt auf Server kopieren","text":"<p>Wichtig: GitHub unterst\u00fctzt keine Passwort-Authentifizierung mehr!</p> <p>Option A: Direkt auf Server klonen (Empfohlen) <pre><code># Auf dem Server: SSH-Key einrichten (siehe [SSH Setup](../configuration/ssh-setup.md))\ngit clone git@github.com:ClansCore/clanscore.git\ncd clanscore\n</code></pre></p> <p>Option B: Per SCP vom lokalen Rechner <pre><code># Auf deinem lokalen Rechner\ngit clone &lt;repository-url&gt;\ncd clanscore\n\n# Auf Server kopieren\nscp -r clanscore ins@srbsci-11.ost.ch:~/\n</code></pre></p> <p>Siehe SSH Setup f\u00fcr Authentifizierungs-Optionen.</p>"},{"location":"deployment/guide/#3-umgebungs-variablen-konfigurieren","title":"3. Umgebungs-Variablen konfigurieren","text":"<p>Erstelle eine <code>.env</code> Datei auf dem Server:</p> <pre><code># Auf dem Server\ncp .env.example .env\nnano .env  # Alle Werte anpassen\n</code></pre> <p>Wichtig: Die <code>.env</code> Datei enth\u00e4lt sensible Daten und sollte niemals ins Git Repository committet werden!</p>"},{"location":"deployment/guide/#4-services-starten","title":"4. Services starten","text":"<pre><code># Alle Services bauen und starten\ndocker-compose up -d --build\n\n# Logs anzeigen\ndocker-compose logs -f\n\n# Status pr\u00fcfen\ndocker-compose ps\n</code></pre>"},{"location":"deployment/guide/#5-services-verifizieren","title":"5. Services verifizieren","text":"<ul> <li>API: <code>http://your-server-ip:3000/api</code></li> <li>Dashboard: <code>http://your-server-ip</code></li> <li>Discord Bot: L\u00e4uft im Hintergrund</li> </ul>"},{"location":"deployment/guide/#erweiterte-konfiguration","title":"Erweiterte Konfiguration","text":""},{"location":"deployment/guide/#reverse-proxy-mit-nginx-empfohlen-fur-production","title":"Reverse Proxy mit Nginx (Empfohlen f\u00fcr Production)","text":"<p>F\u00fcr Production solltest du einen Reverse Proxy verwenden:</p> <ol> <li> <p>Nginx auf dem Server installieren: <pre><code>sudo apt update\nsudo apt install nginx\n</code></pre></p> </li> <li> <p>Nginx-Konfiguration erstellen (<code>/etc/nginx/sites-available/clanscore</code>):</p> </li> </ol> <pre><code>server {\n    listen 80;\n    server_name your-domain.com;\n\n    # Dashboard\n    location / {\n        proxy_pass http://localhost:80;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n\n    # API\n    location /api {\n        proxy_pass http://localhost:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n</code></pre> <ol> <li>Konfiguration aktivieren: <pre><code>sudo ln -s /etc/nginx/sites-available/clanscore /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl reload nginx\n</code></pre></li> </ol>"},{"location":"deployment/guide/#ssltls-mit-lets-encrypt","title":"SSL/TLS mit Let's Encrypt","text":"<pre><code>sudo apt install certbot python3-certbot-nginx\nsudo certbot --nginx -d your-domain.com\n</code></pre>"},{"location":"deployment/guide/#firewall-konfigurieren","title":"Firewall konfigurieren","text":"<pre><code># UFW Firewall\nsudo ufw allow 22/tcp    # SSH\nsudo ufw allow 80/tcp    # HTTP\nsudo ufw allow 443/tcp   # HTTPS\nsudo ufw enable\n</code></pre>"},{"location":"deployment/guide/#wartung","title":"Wartung","text":""},{"location":"deployment/guide/#logs-anzeigen","title":"Logs anzeigen","text":"<pre><code># Alle Services\ndocker-compose logs -f\n\n# Einzelner Service\ndocker-compose logs -f clanscore-api\ndocker-compose logs -f discord-bot\ndocker-compose logs -f dashboard\n</code></pre>"},{"location":"deployment/guide/#services-neu-starten","title":"Services neu starten","text":"<pre><code># Alle Services\ndocker-compose restart\n\n# Einzelner Service\ndocker-compose restart clanscore-api\n</code></pre>"},{"location":"deployment/guide/#updates-deployen","title":"Updates deployen","text":"<pre><code># Code aktualisieren\ngit pull\n\n# Services neu bauen und starten\ndocker-compose up -d --build\n\n# Alte Images aufr\u00e4umen\ndocker system prune -a\n</code></pre>"},{"location":"deployment/guide/#datenbank-backup","title":"Datenbank-Backup","text":"<pre><code># Backup erstellen\ndocker-compose exec mongodb mongodump --out /data/backup\n\n# Backup wiederherstellen\ndocker-compose exec mongodb mongorestore /data/backup\n</code></pre>"},{"location":"deployment/guide/#troubleshooting","title":"Troubleshooting","text":""},{"location":"deployment/guide/#service-startet-nicht","title":"Service startet nicht","text":"<ol> <li> <p>Logs pr\u00fcfen: <pre><code>docker-compose logs &lt;service-name&gt;\n</code></pre></p> </li> <li> <p>Container-Status pr\u00fcfen: <pre><code>docker-compose ps\ndocker ps -a\n</code></pre></p> </li> <li> <p>Umgebungs-Variablen pr\u00fcfen: <pre><code>docker-compose config\n</code></pre></p> </li> </ol>"},{"location":"deployment/guide/#mongodb-verbindungsfehler","title":"MongoDB-Verbindungsfehler","text":"<ul> <li>Pr\u00fcfe, ob MongoDB l\u00e4uft: <code>docker-compose ps mongodb</code></li> <li>Pr\u00fcfe die Umgebungs-Variablen f\u00fcr MongoDB</li> <li>Pr\u00fcfe die Netzwerk-Konfiguration</li> </ul>"},{"location":"deployment/guide/#discord-bot-verbindet-nicht","title":"Discord Bot verbindet nicht","text":"<ul> <li>Pr\u00fcfe den <code>DISCORD_TOKEN</code></li> <li>Pr\u00fcfe die Logs: <code>docker-compose logs discord-bot</code></li> <li>Stelle sicher, dass der Bot die richtigen Intents hat</li> </ul>"},{"location":"deployment/guide/#dashboard-kann-api-nicht-erreichen","title":"Dashboard kann API nicht erreichen","text":"<ul> <li>Pr\u00fcfe die <code>apiUrl</code> in der Environment-Datei</li> <li>Pr\u00fcfe die CORS-Konfiguration in der API</li> <li>Pr\u00fcfe die Netzwerk-Konnektivit\u00e4t zwischen Containern</li> </ul>"},{"location":"deployment/guide/#monitoring","title":"Monitoring","text":""},{"location":"deployment/guide/#health-checks","title":"Health Checks","text":"<p>Die Services haben Health Checks konfiguriert. Pr\u00fcfe den Status:</p> <pre><code>docker-compose ps\n</code></pre>"},{"location":"deployment/guide/#ressourcen-monitoring","title":"Ressourcen-Monitoring","text":"<pre><code># Container-Ressourcen\ndocker stats\n\n# System-Ressourcen\nhtop\ndf -h\n</code></pre>"},{"location":"deployment/guide/#sicherheit","title":"Sicherheit","text":"<ul> <li>Environment-Variablen: Niemals <code>.env</code> in Git committen</li> <li>Passw\u00f6rter: Verwende starke, eindeutige Passw\u00f6rter</li> <li>Firewall: Beschr\u00e4nke den Zugriff auf notwendige Ports</li> <li>Updates: Halte Docker und das System aktuell</li> <li>Backups: Regelm\u00e4ssige Backups der Datenbank</li> </ul>"},{"location":"deployment/guide/#support","title":"Support","text":"<p>Bei Problemen: 1. Pr\u00fcfe die Logs 2. Pr\u00fcfe die Dokumentation 3. Erstelle ein Issue im Repository</p>"},{"location":"deployment/overview/","title":"\ud83d\ude80 ClansCore Deployment - Schnellstart","text":""},{"location":"deployment/overview/#ubersicht","title":"\u00dcbersicht","text":"<p>Dieses Projekt besteht aus drei Hauptkomponenten: - clanscore-api: Node.js/Express REST API - dashboard: Angular Frontend - discord-bot: Discord Bot</p> <p>Alle Services werden mit Docker Compose orchestriert.</p>"},{"location":"deployment/overview/#voraussetzungen","title":"Voraussetzungen","text":"<ul> <li>Docker &amp; Docker Compose installiert</li> <li>Git Repository geklont</li> </ul>"},{"location":"deployment/overview/#schnellstart","title":"Schnellstart","text":""},{"location":"deployment/overview/#1-konfiguration","title":"1. Konfiguration","text":"<p>Erstelle eine <code>.env</code> Datei auf dem Server:</p> <pre><code># Auf dem Server\ncp .env.example .env\nnano .env  # Alle Werte anpassen\n</code></pre> <p>Wichtig: Die <code>.env</code> Datei enth\u00e4lt sensible Daten und sollte niemals ins Git Repository committet werden!</p>"},{"location":"deployment/overview/#2-deployment","title":"2. Deployment","text":"<p>Linux/Mac: <pre><code>./deploy.sh\n</code></pre></p> <p>Windows: <pre><code>.\\deploy.ps1\n</code></pre></p> <p>Oder manuell: <pre><code>docker-compose up -d --build\n</code></pre></p>"},{"location":"deployment/overview/#3-services-prufen","title":"3. Services pr\u00fcfen","text":"<pre><code># Status anzeigen\ndocker-compose ps\n\n# Logs anzeigen\ndocker-compose logs -f\n\n# Einzelner Service\ndocker-compose logs -f clanscore-api\n</code></pre>"},{"location":"deployment/overview/#4-zugriff","title":"4. Zugriff","text":"<ul> <li>API: http://your-server-ip:3000/api</li> <li>Dashboard: http://your-server-ip</li> <li>Health Check: http://your-server-ip:3000/health</li> </ul>"},{"location":"deployment/overview/#server-spezifische-konfiguration","title":"Server-spezifische Konfiguration","text":"<p>F\u00fcr den Server srbsci-11.ost.ch (152.96.10.11): - Siehe Quick Start Server f\u00fcr server-spezifische Anweisungen</p>"},{"location":"deployment/overview/#lokale-entwicklung","title":"Lokale Entwicklung","text":"<p>F\u00fcr lokale Entwicklung und Tests: - Siehe Lokale Entwicklung f\u00fcr lokale Setup-Anleitung - Verwende <code>.env</code> Dateien (nur lokal, nie committen!)</p>"},{"location":"deployment/overview/#weitere-informationen","title":"Weitere Informationen","text":"<ul> <li>Detaillierter Deployment-Stand - Umfassende Dokumentation des aktuellen Deployment-Systems</li> <li>Deployment Guide - Schritt-f\u00fcr-Schritt-Anleitung f\u00fcr:</li> <li>Erweiterte Konfiguration</li> <li>Reverse Proxy Setup</li> <li>SSL/TLS Konfiguration</li> <li>Troubleshooting</li> <li>Monitoring</li> </ul>"},{"location":"deployment/quickstart-server/","title":"\u26a1 Quick Start f\u00fcr srbsci-11.ost.ch","text":"<p>Schnellstart-Anleitung f\u00fcr Ihren Server.</p>"},{"location":"deployment/quickstart-server/#schnellstart","title":"Schnellstart","text":""},{"location":"deployment/quickstart-server/#1-ssh-verbindung-testen","title":"1. SSH-Verbindung testen","text":"<pre><code>ssh &lt;benutzername&gt;@srbsci-11.ost.ch\n# ODER\nssh &lt;benutzername&gt;@&lt;server_ip&gt;\n</code></pre>"},{"location":"deployment/quickstart-server/#2-docker-installieren-falls-noch-nicht-vorhanden","title":"2. Docker installieren (falls noch nicht vorhanden)","text":"<pre><code>curl -fsSL https://get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\nsudo usermod -aG docker $USER\nnewgrp docker\n</code></pre>"},{"location":"deployment/quickstart-server/#3-docker-compose-installieren","title":"3. Docker Compose installieren","text":"<pre><code>sudo curl -L \"https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\ndocker-compose --version\n</code></pre>"},{"location":"deployment/quickstart-server/#4-projekt-auf-server-klonenkopieren","title":"4. Projekt auf Server klonen/kopieren","text":"<p>Wichtig: GitHub unterst\u00fctzt keine Passwort-Authentifizierung mehr!</p> <p>Option A: Mit SSH-Key (Empfohlen) <pre><code># SSH-Key erstellen (falls noch nicht vorhanden)\nssh-keygen -t ed25519 -C \"ins@srbsci-11.ost.ch\" -f ~/.ssh/id_ed25519\n\n# \u00d6ffentlichen Key anzeigen und zu GitHub hinzuf\u00fcgen\ncat ~/.ssh/id_ed25519.pub\n# Gehe zu: https://github.com/settings/keys\n\n# Mit SSH klonen\ncd ~\ngit clone git@github.com:ClansCore/clanscore.git\ncd clanscore\n</code></pre></p> <p>Option B: Mit Personal Access Token <pre><code>cd ~\ngit clone https://github.com/ClansCore/clanscore.git\n# Username: yutubi\n# Password: &lt;Ihr Personal Access Token&gt;\ncd clanscore\n</code></pre></p> <p>Siehe SSH Setup f\u00fcr detaillierte Anleitung.</p>"},{"location":"deployment/quickstart-server/#5-umgebungs-variablen-konfigurieren","title":"5. Umgebungs-Variablen konfigurieren","text":"<p>Erstelle eine <code>.env</code> Datei auf dem Server:</p> <pre><code># Auf dem Server\ncp .env.example .env\nnano .env  # Alle Werte anpassen\n</code></pre> <p>Wichtig: Die <code>.env</code> Datei enth\u00e4lt sensible Daten und sollte niemals ins Git Repository committet werden!</p>"},{"location":"deployment/quickstart-server/#6-services-starten","title":"6. Services starten","text":"<pre><code># Services starten\ndocker-compose up -d --build\n</code></pre>"},{"location":"deployment/quickstart-server/#7-status-prufen","title":"7. Status pr\u00fcfen","text":"<pre><code># Services pr\u00fcfen\ndocker-compose ps\n\n# Logs anzeigen\ndocker-compose logs -f\n\n# Health Check\ncurl http://localhost:3000/health\n</code></pre>"},{"location":"deployment/quickstart-server/#8-zugriff","title":"8. Zugriff","text":"<ul> <li>Dashboard: http:// oder http://srbsci-11.ost.ch <li>API: http://:3000/api <li>Health Check: http://:3000/health"},{"location":"deployment/quickstart-server/#wichtige-befehle","title":"Wichtige Befehle","text":"<pre><code># Services neu starten\ndocker-compose restart\n\n# Einzelnen Service neu starten\ndocker-compose restart clanscore-api\n\n# Services stoppen\ndocker-compose down\n\n# Services stoppen und Volumes l\u00f6schen (\u26a0\ufe0f Achtung: Datenverlust!)\ndocker-compose down -v\n\n# Logs eines Services\ndocker-compose logs -f clanscore-api\n\n# In Container einsteigen\ndocker-compose exec clanscore-api sh\n\n# System-Ressourcen pr\u00fcfen\ndocker stats\nhtop\ndf -h\n</code></pre>"},{"location":"deployment/quickstart-server/#troubleshooting","title":"Troubleshooting","text":""},{"location":"deployment/quickstart-server/#port-bereits-belegt","title":"Port bereits belegt","text":"<pre><code># Pr\u00fcfen welche Ports belegt sind\nsudo netstat -tulpn | grep LISTEN\n\n# Service auf anderem Port starten (in docker-compose.yml anpassen)\n</code></pre>"},{"location":"deployment/quickstart-server/#zu-wenig-speicher","title":"Zu wenig Speicher","text":"<pre><code># Docker aufr\u00e4umen\ndocker system prune -a --volumes\n\n# Alte Images l\u00f6schen\ndocker image prune -a\n</code></pre>"},{"location":"deployment/quickstart-server/#mongodb-startet-nicht","title":"MongoDB startet nicht","text":"<pre><code># MongoDB Logs pr\u00fcfen\ndocker-compose logs mongodb\n\n# MongoDB Container neu starten\ndocker-compose restart mongodb\n</code></pre>"},{"location":"deployment/quickstart-server/#nachste-schritte","title":"N\u00e4chste Schritte","text":"<ul> <li>\u2705 Reverse Proxy mit Nginx einrichten (siehe Deployment Guide)</li> <li>\u2705 SSL/TLS mit Let's Encrypt konfigurieren</li> <li>\u2705 Monitoring einrichten</li> <li>\u2705 Automatische Backups konfigurieren</li> </ul> <p>Siehe Deployment Guide f\u00fcr detaillierte Server-Konfiguration.</p>"},{"location":"deployment/scripts/","title":"\ud83d\ude80 Deployment-Skripte","text":"<p>Dieses Projekt enth\u00e4lt Deployment-Skripte f\u00fcr schnelles und einfaches Deployment.</p>"},{"location":"deployment/scripts/#verfugbare-skripte","title":"Verf\u00fcgbare Skripte","text":""},{"location":"deployment/scripts/#deploysh-deployps1","title":"<code>deploy.sh</code> / <code>deploy.ps1</code>","text":"<p>Zweck: Deployment-Script f\u00fcr manuelles Deployment Verwendung: <code>./deploy.sh</code> (Linux/Mac) oder <code>.\\deploy.ps1</code> (Windows)  </p> <p>Funktion: - Pr\u00fcft ob <code>.env</code> existiert - Pr\u00fcft ob Docker installiert ist - Stoppt laufende Services - Baut alle Images - Startet Services - Zeigt Status und Logs</p>"},{"location":"deployment/scripts/#manuelles-deployment","title":"Manuelles Deployment","text":"<p>Falls du die Skripte nicht verwenden m\u00f6chtest, kannst du auch direkt mit Docker Compose deployen:</p> <pre><code># Alle Services bauen und starten\ndocker-compose up -d --build\n\n# Status pr\u00fcfen\ndocker-compose ps\n\n# Logs anzeigen\ndocker-compose logs -f\n</code></pre>"},{"location":"deployment/scripts/#weitere-informationen","title":"Weitere Informationen","text":"<ul> <li>Deployment Guide - Vollst\u00e4ndige Anleitung</li> <li>Server-spezifische Anleitung - F\u00fcr srbsci-11.ost.ch</li> </ul>"},{"location":"deployment/setup/","title":"\ud83d\ude80 Deployment Setup","text":"<p>Schnellstart-Anleitung f\u00fcr das Deployment des ClansCore-Systems auf einem Server.</p>"},{"location":"deployment/setup/#voraussetzungen","title":"Voraussetzungen","text":"<ul> <li>Virtueller Server mit:</li> <li>Docker (Version 20.10 oder h\u00f6her)</li> <li>Docker Compose (Version 2.0 oder h\u00f6her)</li> <li>Mindestens 2GB RAM</li> <li>Mindestens 10GB freier Speicherplatz</li> </ul>"},{"location":"deployment/setup/#schnellstart","title":"Schnellstart","text":""},{"location":"deployment/setup/#1-server-vorbereiten","title":"1. Server vorbereiten","text":"<pre><code># Docker installieren (Ubuntu/Debian)\ncurl -fsSL https://get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\nsudo usermod -aG docker $USER\n\n# Docker Compose installieren\nsudo curl -L \"https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\n\n# Neu einloggen, damit Docker-Gruppe aktiv wird\n</code></pre>"},{"location":"deployment/setup/#2-projekt-auf-server-klonen","title":"2. Projekt auf Server klonen","text":"<p>Wichtig: GitHub unterst\u00fctzt keine Passwort-Authentifizierung mehr!</p> <p>Option A: Direkt auf Server klonen (Empfohlen) <pre><code># Auf dem Server: SSH-Key einrichten (siehe [SSH Setup](../configuration/ssh-setup.md))\ngit clone git@github.com:ClansCore/clanscore.git\ncd clanscore\n</code></pre></p> <p>Option B: Per SCP vom lokalen Rechner <pre><code># Auf Ihrem lokalen Rechner\ngit clone &lt;repository-url&gt;\ncd clanscore\n\n# Auf Server kopieren\nscp -r clanscore user@your-server.com:~/\n</code></pre></p>"},{"location":"deployment/setup/#3-umgebungs-variablen-konfigurieren","title":"3. Umgebungs-Variablen konfigurieren","text":"<p>Erstelle eine <code>.env</code> Datei auf dem Server:</p> <pre><code># Auf dem Server\ncp .env.example .env\nnano .env  # Alle Werte anpassen\n</code></pre> <p>Wichtig: Die <code>.env</code> Datei enth\u00e4lt sensible Daten und sollte niemals ins Git Repository committet werden!</p>"},{"location":"deployment/setup/#4-services-starten","title":"4. Services starten","text":"<pre><code># Alle Services bauen und starten\ndocker-compose up -d --build\n\n# Logs anzeigen\ndocker-compose logs -f\n\n# Status pr\u00fcfen\ndocker-compose ps\n</code></pre>"},{"location":"deployment/setup/#5-services-verifizieren","title":"5. Services verifizieren","text":"<ul> <li>API: <code>http://your-server-ip:3000/api</code></li> <li>Dashboard: <code>http://your-server-ip</code></li> <li>Discord Bot: L\u00e4uft im Hintergrund</li> </ul>"},{"location":"deployment/setup/#nachste-schritte","title":"N\u00e4chste Schritte","text":"<p>Nach dem erfolgreichen Setup:</p> <ul> <li>Vollst\u00e4ndiger Deployment Guide - Detaillierte Schritt-f\u00fcr-Schritt-Anleitung</li> <li>Deployment Details - Erweiterte Konfiguration (Reverse Proxy, SSL, etc.)</li> <li>Server-spezifische Anleitung - F\u00fcr srbsci-11.ost.ch</li> <li>Deployment-Skripte - Automatisierte Deployment-Tools</li> </ul>"},{"location":"deployment/setup/#support","title":"Support","text":"<p>Bei Problemen: 1. Pr\u00fcfe die Logs: <code>docker-compose logs -f</code> 2. Lese die Troubleshooting-Sektion 3. Erstelle ein Issue im GitHub Repository</p>"},{"location":"development/local-docker/","title":"\ud83d\udc33 Lokales Docker Setup","text":""},{"location":"development/local-docker/#problem","title":"Problem","text":"<p>Das <code>@clanscore/shared</code> Package ist ein lokales Workspace-Package und muss beim Docker-Build verf\u00fcgbar sein.</p>"},{"location":"development/local-docker/#losung","title":"L\u00f6sung","text":"<p>Die Dockerfiles wurden angepasst, um: 1. Den Build-Kontext auf das Root-Verzeichnis zu setzen 2. Das <code>shared</code> Package zuerst zu bauen 3. Dann die Apps mit dem gebauten Package zu bauen</p>"},{"location":"development/local-docker/#lokales-testen","title":"Lokales Testen","text":""},{"location":"development/local-docker/#1-env-datei-erstellen-fur-lokale-tests","title":"1. .env Datei erstellen (f\u00fcr lokale Tests)","text":"<pre><code># Im Root-Verzeichnis\ncp .env.example .env\nnano .env\n</code></pre> <p>Minimale .env f\u00fcr lokale Tests: <pre><code>MONGO_INITDB_ROOT_USERNAME=admin\nMONGO_INITDB_ROOT_PASSWORD=test123\nMONGO_DB=clanscore\nDISCORD_TOKEN=your_token\nDISCORD_CLIENT_ID=your_client_id\nDISCORD_GUILD_ID=your_guild_id\nDISCORD_SERVER_PORT=3001\nWEBHOOK_SHARED_SECRET=test_secret\nDISCORD_BOT_WEBHOOK_URL=http://localhost:3001\nGOOGLE_CALENDAR_CLIENT_ID=your_client_id\nGOOGLE_CALENDAR_CLIENT_SECRET=your_secret\nGOOGLE_CALENDAR_REDIRECT_URI=http://localhost:3000/calendarToken\nCLANSCORE_API_URL=http://localhost:3000/api\nCLANSCORE_API_KEY=test_key\nJWT_SECRET=test_jwt_secret\nCORS_ORIGIN=http://localhost:4200\nDASHBOARD_API_URL=http://localhost:3000/api\n</code></pre></p>"},{"location":"development/local-docker/#2-docker-build-testen","title":"2. Docker Build testen","text":"<pre><code># Alle Services bauen\ndocker-compose build\n\n# Oder einzeln\ndocker-compose build clanscore-api\ndocker-compose build discord-bot\ndocker-compose build dashboard\n</code></pre>"},{"location":"development/local-docker/#3-services-starten","title":"3. Services starten","text":"<pre><code># Alle Services\ndocker-compose up -d\n\n# Mit Logs\ndocker-compose up\n\n# Einzelner Service\ndocker-compose up clanscore-api\n</code></pre>"},{"location":"development/local-docker/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/local-docker/#404-not-found-clanscoreshared","title":"\"404 Not Found - @clanscore/shared\"","text":"<p>Problem: Das shared Package wird nicht gefunden.</p> <p>L\u00f6sung: 1. Pr\u00fcfe, ob der Build-Kontext auf Root gesetzt ist (in <code>docker-compose.yml</code>) 2. Pr\u00fcfe, ob <code>shared/package.json</code> kopiert wird 3. Pr\u00fcfe, ob <code>npm install</code> im Root-Verzeichnis ausgef\u00fchrt wird</p>"},{"location":"development/local-docker/#cannot-find-module-clanscoreshared","title":"\"Cannot find module '@clanscore/shared'\"","text":"<p>Problem: Das Package ist nicht gebaut.</p> <p>L\u00f6sung: 1. Stelle sicher, dass <code>shared</code> zuerst gebaut wird 2. Pr\u00fcfe, ob <code>shared/dist</code> existiert nach dem Build</p>"},{"location":"development/local-docker/#build-dauert-sehr-lange","title":"Build dauert sehr lange","text":"<p>L\u00f6sung: - Verwende Docker Build Cache - Baue nur ge\u00e4nderte Services: <code>docker-compose build clanscore-api</code></p>"},{"location":"development/local-docker/#unterschiede-zu-production","title":"Unterschiede zu Production","text":"Aspekt Lokal Production .env \u2705 Verwendet \u274c GitHub Secrets Build-Kontext Root-Verzeichnis Root-Verzeichnis Shared Package Wird gebaut Wird gebaut MongoDB Docker Container Docker Container"},{"location":"development/local-docker/#nachste-schritte","title":"N\u00e4chste Schritte","text":"<p>Nach erfolgreichem lokalen Build: 1. \u2705 Code committen 2. \u2705 GitHub Secrets konfigurieren 3. \u2705 GitHub Actions deployt automatisch</p>"},{"location":"development/local/","title":"\ud83d\udcbb Lokale Entwicklung","text":"<p>Diese Anleitung beschreibt, wie du die Anwendungen lokal f\u00fcr Entwicklung und Tests starten kannst.</p>"},{"location":"development/local/#ubersicht","title":"\u00dcbersicht","text":"<p>F\u00fcr lokale Entwicklung verwendest du <code>.env</code> Dateien. Diese sind nur f\u00fcr lokale Tests gedacht und sollten nie auf dem Server oder im Repository committed werden.</p>"},{"location":"development/local/#voraussetzungen","title":"Voraussetzungen","text":"<ul> <li>Node.js 20+ installiert</li> <li>MongoDB lokal installiert (oder Docker)</li> <li>Git Repository geklont</li> </ul>"},{"location":"development/local/#setup","title":"Setup","text":""},{"location":"development/local/#1-dependencies-installieren","title":"1. Dependencies installieren","text":"<pre><code># Im Root-Verzeichnis\nnpm install\n\n# Shared Package bauen\nnpm run build:shared\n</code></pre>"},{"location":"development/local/#2-umgebungs-variablen-konfigurieren","title":"2. Umgebungs-Variablen konfigurieren","text":"<pre><code># .env Datei erstellen (nur f\u00fcr lokale Entwicklung!)\ncp .env.example .env\nnano .env  # oder vim/vi\n</code></pre> <p>Wichtigste Variablen f\u00fcr lokale Entwicklung:</p> <pre><code># MongoDB (lokal)\nMONGO_HOST=localhost\nMONGO_PORT=27017\nMONGO_DB=clanscore\n# MONGO_INITDB_ROOT_USERNAME=  # Optional f\u00fcr lokale DB\n# MONGO_INITDB_ROOT_PASSWORD=  # Optional f\u00fcr lokale DB\n\n# Discord Bot\nDISCORD_TOKEN=your_discord_bot_token\nDISCORD_CLIENT_ID=your_discord_client_id\nDISCORD_GUILD_ID=your_discord_guild_id\nDISCORD_SERVER_PORT=3001\n\n# Webhooks\nWEBHOOK_SHARED_SECRET=local_dev_secret\nDISCORD_BOT_WEBHOOK_URL=http://localhost:3001\n\n# Google Calendar\nGOOGLE_CALENDAR_CLIENT_ID=your_client_id\nGOOGLE_CALENDAR_CLIENT_SECRET=your_client_secret\nGOOGLE_CALENDAR_REDIRECT_URI=http://localhost:3000/calendarToken\n\n# API\nCLANSCORE_API_URL=http://localhost:3000/api\nCLANSCORE_API_KEY=local_dev_key\nJWT_SECRET=local_dev_jwt_secret\nCORS_ORIGIN=http://localhost:4200\n\n# Dashboard\nDASHBOARD_API_URL=http://localhost:3000/api\n</code></pre>"},{"location":"development/local/#3-services-starten","title":"3. Services starten","text":""},{"location":"development/local/#option-a-alle-services-einzeln","title":"Option A: Alle Services einzeln","text":"<pre><code># Terminal 1: API\ncd apps/clanscore-api\nnpm run dev\n\n# Terminal 2: Discord Bot\ncd apps/discord-bot\nnpm run dev\n\n# Terminal 3: Dashboard\ncd apps/dashboard\nnpm start\n</code></pre>"},{"location":"development/local/#option-b-mit-docker-compose-lokal","title":"Option B: Mit Docker Compose (lokal)","text":"<pre><code># Im Root-Verzeichnis\ndocker-compose up\n</code></pre>"},{"location":"development/local/#4-zugriff","title":"4. Zugriff","text":"<ul> <li>API: http://localhost:3000/api</li> <li>Dashboard: http://localhost:4200</li> <li>Health Check: http://localhost:3000/health</li> </ul>"},{"location":"development/local/#unterschiede-zu-production","title":"Unterschiede zu Production","text":"Aspekt Lokale Entwicklung Production Secrets <code>.env</code> Dateien GitHub Secrets MongoDB <code>localhost:27017</code> Docker Container <code>mongodb:27017</code> API URL <code>http://localhost:3000/api</code> <code>http://your-server:3000/api</code> CORS <code>http://localhost:4200</code> Ihre Domain Deployment Manuell (<code>npm run dev</code>) Automatisch (GitHub Actions)"},{"location":"development/local/#wichtige-hinweise","title":"Wichtige Hinweise","text":""},{"location":"development/local/#sicherheit","title":"\u26a0\ufe0f Sicherheit","text":"<ul> <li>Niemals <code>.env</code> Dateien committen</li> <li><code>.env</code> ist bereits in <code>.gitignore</code></li> <li>Verwende <code>.env.example</code> als Template</li> <li>F\u00fcr Production: Immer GitHub Secrets verwenden</li> </ul>"},{"location":"development/local/#workflow","title":"\ud83d\udd04 Workflow","text":"<ol> <li>Lokal entwickeln mit <code>.env</code></li> <li>Testen lokal</li> <li>Commiten (ohne <code>.env</code>)</li> <li>GitHub Actions deployt automatisch mit Secrets</li> </ol>"},{"location":"development/local/#troubleshooting","title":"\ud83d\udc1b Troubleshooting","text":"<p>\"Missing environment variables\" - Pr\u00fcfe, ob <code>.env</code> Datei existiert - Pr\u00fcfe, ob alle Variablen gesetzt sind</p> <p>MongoDB-Verbindungsfehler - Pr\u00fcfe, ob MongoDB l\u00e4uft: <code>mongosh</code> oder <code>docker ps</code> - Pr\u00fcfe <code>MONGO_HOST</code> und <code>MONGO_PORT</code></p> <p>CORS-Fehler - Pr\u00fcfe <code>CORS_ORIGIN</code> in <code>.env</code> - Sollte <code>http://localhost:4200</code> sein f\u00fcr lokale Entwicklung</p>"},{"location":"development/local/#nachste-schritte","title":"N\u00e4chste Schritte","text":"<p>Nach lokaler Entwicklung: 1. Code committen (ohne <code>.env</code>) 2. GitHub Actions deployt automatisch mit Secrets 3. Production verwendet GitHub Secrets, nicht <code>.env</code></p> <p>Siehe Deployment Guide f\u00fcr Production-Deployment.</p>"},{"location":"development/troubleshooting/","title":"\ud83d\udd27 Lokales Docker Troubleshooting","text":""},{"location":"development/troubleshooting/#bekannte-probleme-und-losungen","title":"Bekannte Probleme und L\u00f6sungen","text":""},{"location":"development/troubleshooting/#1-404-not-found-clanscoreshared","title":"1. \"404 Not Found - @clanscore/shared\"","text":"<p>Problem: Das lokale Workspace-Package wird nicht gefunden.</p> <p>L\u00f6sung: \u2705 Behoben - Dockerfiles verwenden jetzt Root als Build-Kontext - <code>shared</code> Package wird zuerst gebaut - Siehe aktualisierte Dockerfiles</p>"},{"location":"development/troubleshooting/#2-cannot-find-module-discordjs","title":"2. \"Cannot find module 'discord.js'\"","text":"<p>Problem: <code>discord.js</code> fehlt in API Dependencies.</p> <p>L\u00f6sung: \u2705 Behoben - <code>discord.js</code> wurde zu <code>apps/clanscore-api/package.json</code> hinzugef\u00fcgt - Installiert mit: <code>npm install discord.js@^14.25.1 -w clanscore-api</code></p>"},{"location":"development/troubleshooting/#3-nginxconf-not-found","title":"3. \"nginx.conf not found\"","text":"<p>Problem: Pfad zu <code>nginx.conf</code> ist falsch nach Build-Kontext-\u00c4nderung.</p> <p>L\u00f6sung: \u2705 Behoben - Pfad ge\u00e4ndert von <code>COPY nginx.conf</code> zu <code>COPY apps/dashboard/nginx.conf</code></p>"},{"location":"development/troubleshooting/#4-lmdb-gyp-err-not-ok","title":"4. \"lmdb gyp ERR! not ok\"","text":"<p>Problem: Native Dependencies ben\u00f6tigen Build-Tools.</p> <p>L\u00f6sung: \u2705 Behoben - Build-Tools zu Dashboard Dockerfile hinzugef\u00fcgt:   <pre><code>RUN apk add --no-cache python3 make g++\n</code></pre></p>"},{"location":"development/troubleshooting/#5-umgebungs-variablen-warnungen","title":"5. Umgebungs-Variablen Warnungen","text":"<p>Problem: Docker Compose zeigt Warnungen \u00fcber fehlende Variablen.</p> <p>L\u00f6sung: - F\u00fcr lokale Tests: <code>.env</code> Datei erstellen - F\u00fcr Production: GitHub Secrets verwenden (keine Warnungen)</p> <p>Minimale .env f\u00fcr lokale Tests: <pre><code>MONGO_INITDB_ROOT_USERNAME=admin\nMONGO_INITDB_ROOT_PASSWORD=test123\nMONGO_DB=clanscore\nDISCORD_TOKEN=your_token\nDISCORD_CLIENT_ID=your_client_id\nDISCORD_GUILD_ID=your_guild_id\nDISCORD_SERVER_PORT=3001\nWEBHOOK_SHARED_SECRET=test_secret\nDISCORD_BOT_WEBHOOK_URL=http://localhost:3001\nGOOGLE_CALENDAR_CLIENT_ID=your_client_id\nGOOGLE_CALENDAR_CLIENT_SECRET=your_secret\nGOOGLE_CALENDAR_REDIRECT_URI=http://localhost:3000/calendarToken\nCLANSCORE_API_URL=http://localhost:3000/api\nCLANSCORE_API_KEY=test_key\nJWT_SECRET=test_jwt_secret\nCORS_ORIGIN=http://localhost:4200\nDASHBOARD_API_URL=http://localhost:3000/api\n</code></pre></p>"},{"location":"development/troubleshooting/#build-befehle","title":"Build-Befehle","text":""},{"location":"development/troubleshooting/#alle-services-bauen","title":"Alle Services bauen","text":"<pre><code>docker-compose build\n</code></pre>"},{"location":"development/troubleshooting/#einzelner-service","title":"Einzelner Service","text":"<pre><code>docker-compose build clanscore-api\ndocker-compose build discord-bot\ndocker-compose build dashboard\n</code></pre>"},{"location":"development/troubleshooting/#mit-cache-loschen","title":"Mit Cache l\u00f6schen","text":"<pre><code>docker-compose build --no-cache\n</code></pre>"},{"location":"development/troubleshooting/#services-starten","title":"Services starten","text":""},{"location":"development/troubleshooting/#alle-services","title":"Alle Services","text":"<pre><code>docker-compose up -d\n</code></pre>"},{"location":"development/troubleshooting/#mit-logs","title":"Mit Logs","text":"<pre><code>docker-compose up\n</code></pre>"},{"location":"development/troubleshooting/#einzelner-service_1","title":"Einzelner Service","text":"<pre><code>docker-compose up clanscore-api\n</code></pre>"},{"location":"development/troubleshooting/#status-prufen","title":"Status pr\u00fcfen","text":"<pre><code># Container-Status\ndocker-compose ps\n\n# Logs\ndocker-compose logs -f\n\n# Einzelner Service\ndocker-compose logs -f clanscore-api\n</code></pre>"},{"location":"development/troubleshooting/#cleanup","title":"Cleanup","text":"<pre><code># Services stoppen\ndocker-compose down\n\n# Services stoppen und Volumes l\u00f6schen\ndocker-compose down -v\n\n# Alte Images l\u00f6schen\ndocker system prune -a\n</code></pre>"},{"location":"development/troubleshooting/#nachste-schritte","title":"N\u00e4chste Schritte","text":"<p>Nach erfolgreichem lokalen Build: 1. \u2705 Code committen 2. \u2705 GitHub Secrets konfigurieren 3. \u2705 Production Deployment testen</p> <p>Siehe Lokale Entwicklung f\u00fcr lokale Entwicklung ohne Docker.</p>"},{"location":"logging/logging-dokumentation/","title":"Logging-Dokumentation","text":""},{"location":"logging/logging-dokumentation/#diese-dokumentation-beschreibt-das-gesamte-logging-system-im-clanscore-projekt-mit-besonderem-fokus-auf-den-bot-log-channel","title":"Diese Dokumentation beschreibt das gesamte Logging-System im ClansCore-Projekt, mit besonderem Fokus auf den bot-log Channel.","text":""},{"location":"logging/logging-dokumentation/#ubersicht","title":"\u00dcbersicht","text":"<p>Das ClansCore-Projekt verwendet mehrere Logging-Mechanismen:</p> <ol> <li>Discord bot-log Channel: Zentraler Log-Channel f\u00fcr wichtige Ereignisse und \u00c4nderungen</li> <li>Console-Logging: Standard-Logging f\u00fcr Entwicklungs- und Debugging-Zwecke</li> <li>Error-Handling: Strukturierte Fehlerbehandlung mit Logging</li> <li>Webhook-Notifications: Automatische Benachrichtigungen \u00fcber API-Webhooks</li> </ol>"},{"location":"logging/logging-dokumentation/#der-bot-log-channel","title":"Der bot-log Channel","text":""},{"location":"logging/logging-dokumentation/#zweck","title":"Zweck","text":"<p>Der bot-log Channel ist ein Discord-Textkanal, der als zentrales Logging-System f\u00fcr relevante \u00c4nderungen und Ereignisse dient. Er befindet sich im Vorstands-Bereich des Discord-Servers und ist nur f\u00fcr Vorstandsmitglieder sichtbar.</p>"},{"location":"logging/logging-dokumentation/#konfiguration","title":"Konfiguration","text":"<p>Der Channel-Name ist in <code>shared/src/channelNames.ts</code> definiert:</p> <pre><code>export const ChannelNames = {\n    // ... andere Channels\n    BotLog: \"bot-log\",\n} as const;\n</code></pre> <p>Wichtig: Der Channel muss im Discord-Server mit dem exakten Namen <code>bot-log</code> erstellt werden.</p>"},{"location":"logging/logging-dokumentation/#verwendung","title":"Verwendung","text":"<p>Der bot-log Channel wird verwendet, um folgende Ereignisse zu protokollieren:</p> <ul> <li>\u2705 Rollen\u00e4nderungen (Dashboard und Discord)</li> <li>\u2705 User-Synchronisierungen</li> <li>\u2705 Rollen-Synchronisierungen</li> <li>\u2705 Spenden-Protokollierung</li> <li>\u2705 Aufgaben-Erstellung und -Verwaltung</li> <li>\u2705 Ranglisten-Erstellung</li> <li>\u2705 Kalender-Synchronisierungen</li> <li>\u2705 Kalender-Verkn\u00fcpfungen</li> </ul>"},{"location":"logging/logging-dokumentation/#logging-mechanismen","title":"Logging-Mechanismen","text":""},{"location":"logging/logging-dokumentation/#1-discord-embed-nachrichten","title":"1. Discord Embed-Nachrichten","text":"<p>Die meisten Log-Eintr\u00e4ge im bot-log Channel werden als Discord Embeds gesendet. Diese bieten strukturierte Informationen mit:</p> <ul> <li>Titel: Beschreibt den Typ des Ereignisses</li> <li>Farbe: Visuelle Unterscheidung (z.B. gr\u00fcn f\u00fcr Erfolg, orange f\u00fcr Warnung)</li> <li>Felder: Strukturierte Daten (Benutzer, \u00c4nderungen, Details)</li> <li>Timestamp: Automatische Zeitstempel</li> <li>Footer: Zus\u00e4tzliche Metadaten (z.B. Task-ID, Leaderboard-ID)</li> </ul>"},{"location":"logging/logging-dokumentation/#beispiel-embed-struktur","title":"Beispiel-Embed-Struktur","text":"<pre><code>const logEmbed = new EmbedBuilder()\n    .setTitle(\"\ud83d\udd04 Rollen\u00e4nderung (Dashboard)\")\n    .setColor(0x3498db)\n    .addFields(\n        { name: \"Benutzer\", value: `&lt;@${discordId}&gt; (${username})`, inline: true },\n        { name: \"Ge\u00e4ndert von\", value: changedBy ?? \"Dashboard\", inline: true },\n        { name: \"\u2795 Hinzugef\u00fcgt\", value: addedRoles.join(\", \"), inline: false },\n    )\n    .setTimestamp();\n</code></pre>"},{"location":"logging/logging-dokumentation/#verwendung-des-bot-log-channels","title":"Verwendung des bot-log Channels","text":""},{"location":"logging/logging-dokumentation/#1-rollenanderungen-dashboard-discord","title":"1. Rollen\u00e4nderungen (Dashboard \u2192 Discord)","text":"<p>Datei: <code>apps/discord-bot/src/web/routes/webhook.routes.ts</code></p> <p>Webhook-Endpoint: <code>POST /api/notifications/role-changed</code></p> <p>Ereignis: Wenn Benutzerrollen im Dashboard ge\u00e4ndert werden, wird eine Log-Nachricht gesendet.</p> <p>Log-Details: - Benutzer (Discord-Mention) - Ge\u00e4ndert von (Admin-Name) - Hinzugef\u00fcgte Rollen - Entfernte Rollen - Fehler (falls vorhanden)</p> <p>Embed-Farbe: <code>0x3498db</code> (Blau)</p>"},{"location":"logging/logging-dokumentation/#2-rollenaktualisierungen","title":"2. Rollenaktualisierungen","text":"<p>Webhook-Endpoint: <code>POST /api/notifications/role-updated</code></p> <p>Ereignis: Wenn eine Rolle im Dashboard aktualisiert wird (Name, Farbe, etc.).</p> <p>Log-Details: - Rollenname - Ge\u00e4ndert von - Liste der \u00c4nderungen (Name, Farbe, Hervorheben, Erw\u00e4hnbar)</p> <p>Embed-Farbe: <code>0xf39c12</code> (Orange)</p>"},{"location":"logging/logging-dokumentation/#3-user-synchronisierung","title":"3. User-Synchronisierung","text":"<p>Datei: <code>apps/discord-bot/src/commands/user/syncusers.ts</code></p> <p>Befehl: <code>/syncusers</code> (manuell) oder automatisch via Cron-Job</p> <p>Ereignis: Synchronisierung von Discord-Mitgliedern mit der Datenbank.</p> <p>Log-Details: - Ausgef\u00fchrt von (Benutzer oder \"Automatisch (Cron-Job)\") - Anzahl neue Personen - Anzahl Wieder-Eintritte - Anzahl Austritte - Anzahl Rollen\u00e4nderungen - Details der ersten 5 \u00c4nderungen - Warnung bei Verwendung von gecachten Daten</p> <p>Embed-Farbe: <code>0x9634eb</code> (Lila)</p> <p>Automatische Ausf\u00fchrung: T\u00e4glich um 03:00 Uhr via Cron-Job (<code>apps/clanscore-api/src/infrastructure/cron/jobs.ts</code>)</p>"},{"location":"logging/logging-dokumentation/#4-rollen-synchronisierung","title":"4. Rollen-Synchronisierung","text":"<p>Datei: <code>apps/discord-bot/src/commands/user/syncroles.ts</code></p> <p>Befehl: <code>/syncroles</code></p> <p>Ereignis: Synchronisierung von Discord-Rollen mit der Datenbank.</p> <p>Log-Details: - Ausgef\u00fchrt von (Benutzer) - In DB erstellt (Rollen) - In DB aktualisiert (Rollen) - In Discord erstellt (Rollen) - Fehler (falls vorhanden)</p> <p>Embed-Farbe: <code>0x9634eb</code> (Lila)</p>"},{"location":"logging/logging-dokumentation/#5-spenden-protokollierung","title":"5. Spenden-Protokollierung","text":"<p>Datei: <code>apps/discord-bot/src/commands/gamification/donation.ts</code></p> <p>Befehl: <code>/donation</code></p> <p>Ereignis: Wenn eine Spende protokolliert und Punkte vergeben werden.</p> <p>Log-Details: - Spender (Name und Nickname) - Betrag (CHF) - Punkte - Datum - Protokolliert von (Vorstandsmitglied) - Interne Notizen</p> <p>Embed-Farbe: <code>0xff9500</code> (Orange)</p>"},{"location":"logging/logging-dokumentation/#6-aufgaben-erstellung","title":"6. Aufgaben-Erstellung","text":"<p>Datei: <code>apps/discord-bot/src/commands/gamification/task/createTask.ts</code></p> <p>Befehl: <code>/createtask</code> \u2192 Modal \u2192 Aufgabe erstellen</p> <p>Ereignis: Wenn eine neue Aufgabe erstellt wird.</p> <p>Log-Details: - Erstellt von (Benutzer) - Aufgabenname - Punkte - Max. Teilnehmer - Deadline - Verantwortlich (wird aktualisiert, wenn zugewiesen) - Beschreibung</p> <p>Embed-Farbe: <code>0x2ecc71</code> (Gr\u00fcn)</p> <p>Besonderheit: Das Log-Embed wird aktualisiert, wenn ein Verantwortlicher zugewiesen wird (durch Suche nach der urspr\u00fcnglichen Nachricht anhand der Task-ID).</p>"},{"location":"logging/logging-dokumentation/#7-ranglisten-erstellung","title":"7. Ranglisten-Erstellung","text":"<p>Datei: <code>apps/discord-bot/src/commands/gamification/createLeaderboard.ts</code></p> <p>Befehl: <code>/createleaderboard</code></p> <p>Ereignis: Wenn eine neue Rangliste erstellt wird.</p> <p>Log-Details: - Erstellt von (Benutzer) - Ranglistenname - Startdatum - Enddatum - Anzahl sichtbarer Eintr\u00e4ge - Beschreibung</p> <p>Embed-Farbe: <code>0xffd900</code> (Gelb)</p>"},{"location":"logging/logging-dokumentation/#8-kalender-synchronisierung","title":"8. Kalender-Synchronisierung","text":"<p>Datei: <code>apps/discord-bot/src/commands/events/calendar/synccalendar.ts</code></p> <p>Befehl: <code>/synccalendar</code></p> <p>Ereignis: Manuelle Synchronisierung von Google Calendar Events mit Discord.</p> <p>Log-Details: - Ausgef\u00fchrt von (Benutzer) - Anzahl synchronisierte Events - Anzahl erstellte Events - Anzahl gel\u00f6schte Events</p> <p>Embed-Farbe: <code>0x34dbca</code> (T\u00fcrkis)</p>"},{"location":"logging/logging-dokumentation/#9-kalender-verknupfung","title":"9. Kalender-Verkn\u00fcpfung","text":"<p>Datei: <code>apps/discord-bot/src/commands/events/calendar/linkcalendar.ts</code></p> <p>Befehl: <code>/linkcalendar</code></p> <p>Ereignis: Wenn ein Admin den Prozess zur Verkn\u00fcpfung eines Google Calendars startet.</p> <p>Log-Details: - Initiiert von (Benutzer)</p> <p>Embed-Farbe: <code>0xeb34c6</code> (Pink)</p>"},{"location":"logging/logging-dokumentation/#dashboard-logging","title":"Dashboard-Logging","text":""},{"location":"logging/logging-dokumentation/#ubersicht_1","title":"\u00dcbersicht","text":"<p>Das Dashboard (Angular Frontend) hat kein eigenes Logging-System im traditionellen Sinne. Es sendet keine direkten Logs an Discord oder andere externe Systeme. Stattdessen werden Dashboard-Aktionen indirekt \u00fcber die API geloggt, wenn die API entsprechende Webhooks ausl\u00f6st.</p>"},{"location":"logging/logging-dokumentation/#architektur","title":"Architektur","text":"<pre><code>Dashboard (Angular) \n    \u2193 HTTP Request\nAPI (Express/Node.js)\n    \u2193 Webhook\nDiscord-Bot\n    \u2193 Nachricht\nbot-log Channel\n</code></pre>"},{"location":"logging/logging-dokumentation/#geloggte-dashboard-aktionen","title":"Geloggte Dashboard-Aktionen","text":"<p>Die folgenden Dashboard-Aktionen werden im bot-log Channel protokolliert:</p>"},{"location":"logging/logging-dokumentation/#1-rollenanderungen-an-benutzern","title":"1. Rollen\u00e4nderungen an Benutzern","text":"<p>Dashboard-Aktion: Benutzer-Rolle hinzuf\u00fcgen oder entfernen</p> <p>API-Endpunkt:  - <code>POST /api/user/:personId/role</code> (Rolle hinzuf\u00fcgen) - <code>DELETE /api/user/:personId/role/:roleId</code> (Rolle entfernen)</p> <p>Logging:  - \u2705 Wird im bot-log Channel geloggt - \u2705 Embed mit Benutzer, hinzugef\u00fcgten/entfernten Rollen, ge\u00e4ndert von (Dashboard-Admin)</p> <p>Datei: <code>apps/clanscore-api/src/presentation/controllers/user.controller.ts</code></p> <pre><code>// Beispiel: Rolle hinzuf\u00fcgen\nawait notificationService.notifyRoleChanged({\n    userId: personId,\n    platformUserId: personResult.value.discordId,\n    username: personResult.value.nickname ?? personResult.value.discordId,\n    addedRoles: [roleResult.value.name],\n    removedRoles: [],\n    changedBy: getChangedByFromRequest(req), // Dashboard-Admin\n});\n</code></pre>"},{"location":"logging/logging-dokumentation/#2-rollenaktualisierungen_1","title":"2. Rollenaktualisierungen","text":"<p>Dashboard-Aktion: Rolle bearbeiten (Name, Farbe, Position, etc.)</p> <p>API-Endpunkt: <code>PATCH /api/role/:roleId</code></p> <p>Logging: - \u2705 Wird im bot-log Channel geloggt - \u2705 Embed mit Rollenname, \u00c4nderungen (Name, Farbe, Hervorheben, Erw\u00e4hnbar), ge\u00e4ndert von</p> <p>Datei: <code>apps/clanscore-api/src/presentation/controllers/roles.controller.ts</code></p> <pre><code>await notificationService.notifyRoleUpdated({\n    roleId: role.id,\n    oldName: oldRole.name,\n    newName: role.name ?? oldRole.name,\n    color: role.discordColor,\n    permissions: role.discordPermissions,\n    hoist: role.hoist,\n    mentionable: role.mentionable,\n    changedBy: getChangedByFromRequest(req), // Dashboard-Admin\n});\n</code></pre>"},{"location":"logging/logging-dokumentation/#nicht-geloggte-dashboard-aktionen","title":"Nicht geloggte Dashboard-Aktionen","text":"<p>Die folgenden Dashboard-Aktionen werden NICHT im bot-log Channel protokolliert:</p> <ul> <li>\u274c Benutzer erstellen (<code>POST /api/user</code>) - Keine Notification</li> <li>\u274c Benutzer aktualisieren (<code>PATCH /api/user/:personId</code>) - Keine Notification (ausser Rollen\u00e4nderungen)</li> <li>\u274c Benutzer l\u00f6schen (<code>DELETE /api/user/:personId</code>) - Keine Notification</li> <li>\u274c Rolle erstellen (<code>POST /api/role</code>) - Keine Notification</li> <li>\u274c Rolle l\u00f6schen (<code>DELETE /api/role/:roleId</code>) - Keine Notification</li> <li>\u274c Aufgaben verwalten - Keine Notification</li> <li>\u274c Events verwalten - Keine Notification</li> <li>\u274c Ranglisten verwalten - Keine Notification</li> <li>\u274c Spenden verwalten - Keine Notification</li> <li>\u274c Belohnungen verwalten - Keine Notification</li> <li>\u274c Passwort \u00e4ndern - Keine Notification</li> </ul> <p>Hinweis: Diese Aktionen werden nur in der Datenbank gespeichert, aber nicht im Discord bot-log Channel protokolliert.</p>"},{"location":"logging/logging-dokumentation/#benutzer-feedback-im-dashboard","title":"Benutzer-Feedback im Dashboard","text":"<p>Das Dashboard verwendet Angular Material Snackbar f\u00fcr Benutzer-Feedback:</p> <p>Datei: <code>apps/dashboard/src/app/app.component.ts</code></p> <p>Verwendung: - \u2705 Passwort-\u00c4nderung erfolgreich: \"Ihr Passwort wurde erfolgreich ge\u00e4ndert.\" - \u274c Passwort-\u00c4nderung fehlgeschlagen: \"Fehler beim \u00c4ndern des Passworts: {error}\"</p> <p>Technische Details: <pre><code>this.snackBar.open(\n    'Ihr Passwort wurde erfolgreich ge\u00e4ndert.',\n    'Schliessen',\n    { duration: 3000 }\n);\n</code></pre></p> <p>Wichtig: Snackbar-Nachrichten sind nur f\u00fcr den aktuellen Benutzer sichtbar und werden nicht geloggt.</p>"},{"location":"logging/logging-dokumentation/#console-logging-im-dashboard","title":"Console-Logging im Dashboard","text":"<p>Das Dashboard verwendet minimales Console-Logging, haupts\u00e4chlich f\u00fcr Debugging-Zwecke:</p> <p>Gefundene Console-Logs: - <code>apps/dashboard/src/app/sections/task/components/task-form/task-form.component.ts</code> - Debug-Ausgabe bei Task-Updates - <code>apps/dashboard/src/app/sections/gamification-management/components/task-type-form/task-type-form.component.ts</code> - Debug-Ausgabe bei Task-Type-Formularen - <code>apps/dashboard/src/app/sections/gamification-management/components/jahresplanung-table/jahresplanung-table.component.ts</code> - Error-Logging bei Validierungsfehlern - <code>apps/dashboard/src/app/sections/role/pages/role-page/role-page.component.ts</code> - Debug-Ausgabe - <code>apps/dashboard/src/main.ts</code> - Error-Logging bei Bootstrap-Fehlern</p> <p>Hinweis: Diese Console-Logs sind nur in der Browser-Konsole sichtbar und werden nicht an externe Systeme gesendet.</p>"},{"location":"logging/logging-dokumentation/#zusammenfassung-dashboard-logging","title":"Zusammenfassung Dashboard-Logging","text":"Aktion Geloggt? Wo? Details Rolle zu Benutzer hinzuf\u00fcgen \u2705 Ja bot-log Embed mit Benutzer, Rolle, ge\u00e4ndert von Rolle von Benutzer entfernen \u2705 Ja bot-log Embed mit Benutzer, Rolle, ge\u00e4ndert von Rolle aktualisieren \u2705 Ja bot-log Embed mit Rollenname, \u00c4nderungen, ge\u00e4ndert von Benutzer erstellen \u274c Nein - Keine Notification Benutzer aktualisieren \u274c Nein - Keine Notification (ausser Rollen) Benutzer l\u00f6schen \u274c Nein - Keine Notification Rolle erstellen \u274c Nein - Keine Notification Rolle l\u00f6schen \u274c Nein - Keine Notification Aufgaben/Events/Ranglisten \u274c Nein - Keine Notification Passwort \u00e4ndern \u274c Nein - Nur Snackbar-Feedback"},{"location":"logging/logging-dokumentation/#empfehlungen-fur-zukunftige-entwicklung","title":"Empfehlungen f\u00fcr zuk\u00fcnftige Entwicklung","text":"<p>Um das Dashboard-Logging zu verbessern, k\u00f6nnten folgende Aktionen zus\u00e4tzlich geloggt werden:</p> <ol> <li>Benutzer erstellen/aktualisieren/l\u00f6schen - Wichtige \u00c4nderungen sollten protokolliert werden</li> <li>Rolle erstellen/l\u00f6schen - Neue Rollen sollten im bot-log erscheinen</li> <li>Aufgaben-Verwaltung - Erstellung/Bearbeitung von Aufgaben im Dashboard</li> <li>Events-Verwaltung - Erstellung/Bearbeitung von Events im Dashboard</li> <li>Ranglisten-Verwaltung - Erstellung/Bearbeitung von Ranglisten im Dashboard</li> </ol> <p>Hinweis: Diese Erweiterungen w\u00fcrden \u00c4nderungen in der API erfordern, um entsprechende Notifications auszul\u00f6sen.</p>"},{"location":"logging/logging-dokumentation/#console-logging","title":"Console-Logging","text":""},{"location":"logging/logging-dokumentation/#discord-bot","title":"Discord-Bot","text":"<p>Verwendete Dateien: - <code>apps/discord-bot/src/index.ts</code> - <code>apps/discord-bot/src/discord.handler.ts</code> - <code>apps/discord-bot/src/discord.bot.ts</code> - <code>apps/discord-bot/src/web/server.ts</code> - <code>apps/discord-bot/src/deploy.commands.ts</code> - <code>apps/discord-bot/src/commands/gamification/task/createTask.ts</code> - <code>apps/discord-bot/src/commands/gamification/task/selectTaskTypeModal.ts</code> - <code>apps/discord-bot/src/api/apiClient.ts</code> - <code>apps/discord-bot/src/config.ts</code></p> <p>Log-Nachrichten: - \u2705 Bot-Start: <code>\"\u2705 Discord bot started successfully\"</code> - \u2705 Discord-Client-Verbindung: <code>\"\u2705 Discord client connected.\"</code> - \u2705 Event-Handler-Registrierung: <code>\"\u2705 Event handlers registered.\"</code> - \u2705 Bot-Bereitschaft: <code>\"\ud83e\udd16 Discord-Bot is ready.\"</code> - \u2705 Initiale Synchronisierung: <code>\"\ud83d\udd04 Running initial sync...\"</code> - \u2705 Webhook-Server: <code>\"\ud83d\udd14 Bot webhook server listening on http://localhost:${port}\"</code> - \u2705 Commands-Registrierung: <code>\"\u2705 Commands successfully registered / updated.\"</code> - \u26a0\ufe0f Fehler: <code>console.error()</code> f\u00fcr Fehlerbehandlung</p>"},{"location":"logging/logging-dokumentation/#clanscore-api","title":"ClansCore-API","text":"<p>Verwendete Dateien: - <code>apps/clanscore-api/src/index.ts</code> - <code>apps/clanscore-api/src/infrastructure/database/db.init.ts</code> - <code>apps/clanscore-api/src/infrastructure/cron/jobs.ts</code> - <code>apps/clanscore-api/src/application/notifications/notification.service.ts</code> - <code>apps/clanscore-api/src/config.ts</code></p> <p>Log-Nachrichten: - \u2705 Datenbankverbindung: <code>\"\u2705 Connected to the database\"</code> - \u2705 Datenbank bereits verbunden: <code>\"\u2705 Already connected to the database\"</code> - \u2705 Server-Start: <code>\"API / OAuth server running at ${url}\"</code> - \u2705 Cron-Jobs: <code>\"\u2705 Registered all Cron-Jobs\"</code> - \u2705 Notification-Service: <code>\"\u2705 NotificationService: ${adapter.name} adapter registered\"</code> - \u26a0\ufe0f Fehler: Detaillierte Fehlerausgaben bei Datenbankverbindungsfehlern</p> <p>Cron-Job-Logging: - <code>\"Starte geplante L\u00f6schung...\"</code> - <code>\"Starte User-Synchronisierung...\"</code></p>"},{"location":"logging/logging-dokumentation/#error-handling-und-logging","title":"Error-Handling und Logging","text":""},{"location":"logging/logging-dokumentation/#error-handling-system","title":"Error-Handling-System","text":"<p>Das Projekt verwendet ein strukturiertes Error-Handling-System \u00fcber <code>@clanscore/shared</code>:</p> <p>Datei: <code>shared/src/errors/messages.ts</code></p> <p>Funktion: <code>getErrorMessage(error: ErrorDetails): string</code></p>"},{"location":"logging/logging-dokumentation/#error-typen","title":"Error-Typen","text":"<p>Die wichtigsten Error-Typen f\u00fcr Logging:</p> <ul> <li><code>ErrorType.UnknownError</code>: Unbekannte Fehler</li> <li><code>ErrorType.MessageNotSend</code>: Fehler beim Senden von Nachrichten</li> <li><code>ErrorType.NotificationFailed</code>: Fehler bei Benachrichtigungen</li> <li><code>ErrorType.NetworkFailure</code>: Netzwerkfehler</li> <li><code>ErrorType.RoleAssignmentFailed</code>: Fehler bei Rollenzuweisungen</li> </ul>"},{"location":"logging/logging-dokumentation/#fehlerbehandlung-im-discord-bot","title":"Fehlerbehandlung im Discord-Bot","text":"<p>Datei: <code>apps/discord-bot/src/errors/dsicordAdapter.ts</code></p> <p>Funktion: <code>replyWithDeferredError()</code> - Sendet Fehlermeldungen an Benutzer</p> <p>Datei: <code>apps/discord-bot/src/discord.bot.ts</code></p> <p>Event-Handler: - <code>client.on(\"error\")</code> - Loggt Discord-Client-Fehler - <code>process.on(\"unhandledRejection\")</code> - Loggt unbehandelte Promise-Rejections</p>"},{"location":"logging/logging-dokumentation/#fehlerbehandlung-in-der-api","title":"Fehlerbehandlung in der API","text":"<p>Datei: <code>apps/clanscore-api/src/presentation/middleware/error.middleware.ts</code></p> <p>Funktion: <code>errorHandler()</code> - Zentrale Fehlerbehandlung f\u00fcr API-Requests</p>"},{"location":"logging/logging-dokumentation/#notification-service-error-handling","title":"Notification-Service Error-Handling","text":"<p>Datei: <code>apps/clanscore-api/src/application/notifications/notification.service.ts</code></p> <p>Methode: <code>broadcast()</code> - F\u00e4ngt Fehler in Notification-Adaptern ab und loggt sie</p> <pre><code>catch (error) {\n    const errorDetails: ErrorDetails = {\n        type: ErrorType.NotificationFailed,\n        details: {\n            message: `NotificationService: Error in ${adapter.name}.${method}: ${errorMessage}`,\n            adapter: adapter.name,\n            method: String(method),\n        }\n    };\n    getErrorMessage(errorDetails);\n}\n</code></pre>"},{"location":"logging/logging-dokumentation/#webhook-basiertes-logging","title":"Webhook-basiertes Logging","text":""},{"location":"logging/logging-dokumentation/#webhook-endpunkte","title":"Webhook-Endpunkte","text":"<p>Datei: <code>apps/discord-bot/src/web/routes/webhook.routes.ts</code></p> <p>Die API sendet Webhooks an den Discord-Bot, um Ereignisse zu loggen:</p> <ol> <li>POST <code>/api/notifications/role-changed</code></li> <li> <p>Loggt Rollen\u00e4nderungen im bot-log Channel</p> </li> <li> <p>POST <code>/api/notifications/role-updated</code></p> </li> <li> <p>Loggt Rollenaktualisierungen im bot-log Channel</p> </li> <li> <p>POST <code>/api/notifications/sync-users</code></p> </li> <li>L\u00f6st eine User-Synchronisierung aus (wird automatisch geloggt)</li> </ol>"},{"location":"logging/logging-dokumentation/#webhook-authentifizierung","title":"Webhook-Authentifizierung","text":"<p>Alle Webhook-Requests m\u00fcssen einen g\u00fcltigen <code>x-webhook-token</code> Header enthalten:</p> <pre><code>function verifySecret(req: express.Request): string | boolean {\n    const token = req.header(\"x-webhook-token\") ?? \"\";\n    return config.WEBHOOK_SHARED_SECRET &amp;&amp; token === config.WEBHOOK_SHARED_SECRET;\n}\n</code></pre>"},{"location":"logging/logging-dokumentation/#webhook-aufrufe-aus-der-api","title":"Webhook-Aufrufe aus der API","text":"<p>Datei: <code>apps/clanscore-api/src/infrastructure/cron/jobs.ts</code></p> <p>Automatische User-Synchronisierung via Webhook:</p> <pre><code>const response = await fetch(`${config.DISCORD_BOT_WEBHOOK_URL}/api/notifications/sync-users`, {\n    method: \"POST\",\n    headers: {\n        \"Content-Type\": \"application/json\",\n        \"x-webhook-token\": config.WEBHOOK_SHARED_SECRET,\n    },\n    body: JSON.stringify({\n        guildId: config.DISCORD_GUILD_ID,\n    }),\n});\n</code></pre>"},{"location":"logging/logging-dokumentation/#konfiguration_1","title":"Konfiguration","text":""},{"location":"logging/logging-dokumentation/#umgebungsvariablen","title":"Umgebungsvariablen","text":"<p>Discord-Bot: - <code>DISCORD_GUILD_ID</code>: Discord Server ID - <code>WEBHOOK_SHARED_SECRET</code>: Shared Secret f\u00fcr Webhook-Authentifizierung</p> <p>ClansCore-API: - <code>DISCORD_BOT_WEBHOOK_URL</code>: URL des Discord-Bot Webhook-Servers - <code>WEBHOOK_SHARED_SECRET</code>: Shared Secret f\u00fcr Webhook-Authentifizierung - <code>DISCORD_GUILD_ID</code>: Discord Server ID</p>"},{"location":"logging/logging-dokumentation/#channel-setup","title":"Channel-Setup","text":"<p>Der <code>bot-log</code> Channel muss im Discord-Server erstellt werden:</p> <ol> <li>Channel-Name: <code>bot-log</code> (exakt, case-sensitive)</li> <li>Bereich: Vorstands-Bereich (nur f\u00fcr Vorstandsmitglieder sichtbar)</li> <li>Typ: Text-Channel</li> <li>Berechtigungen: Bot ben\u00f6tigt <code>Send Messages</code> und <code>Embed Links</code></li> </ol>"},{"location":"logging/logging-dokumentation/#docker-logging","title":"Docker-Logging","text":"<p>Datei: <code>docker-compose.yml</code> (falls vorhanden)</p> <p>Logs k\u00f6nnen \u00fcber Docker Compose angezeigt werden:</p> <pre><code># Alle Services\ndocker-compose logs -f\n\n# Einzelner Service\ndocker-compose logs -f discord-bot\ndocker-compose logs -f clanscore-api\n</code></pre>"},{"location":"logging/logging-dokumentation/#ephemeral-messages-direkte-benutzerinformationen","title":"Ephemeral Messages - Direkte Benutzerinformationen","text":""},{"location":"logging/logging-dokumentation/#was-sind-ephemeral-messages","title":"Was sind Ephemeral Messages?","text":"<p>Ephemeral Messages sind private Nachrichten, die nur f\u00fcr den ausf\u00fchrenden Benutzer sichtbar sind. Diese werden direkt als Antwort auf Discord-Befehle gesendet und verschwinden nicht automatisch, bleiben aber f\u00fcr andere Server-Mitglieder unsichtbar.</p>"},{"location":"logging/logging-dokumentation/#verwendung-im-clanscore-projekt","title":"Verwendung im ClansCore-Projekt","text":"<p>Fast alle Discord-Befehle verwenden Ephemeral Messages, um Benutzer direkt zu informieren:</p> <p>Technische Implementierung: <pre><code>await interaction.deferReply({ flags: MessageFlags.Ephemeral });\n// oder\nawait interaction.reply({ \n    content: \"Nachricht\", \n    flags: MessageFlags.Ephemeral \n});\n</code></pre></p>"},{"location":"logging/logging-dokumentation/#befehle-mit-ephemeral-messages","title":"Befehle mit Ephemeral Messages","text":"<p>Alle folgenden Befehle senden Ephemeral Messages an den ausf\u00fchrenden Benutzer:</p> <ol> <li><code>/syncusers</code> - Zeigt Synchronisierungs-Ergebnisse (neue Benutzer, \u00c4nderungen, etc.)</li> <li><code>/syncroles</code> - Zeigt Rollen-Synchronisierungs-Ergebnisse</li> <li><code>/donation</code> - Best\u00e4tigt Spenden-Protokollierung</li> <li><code>/createtask</code> - Best\u00e4tigt Aufgaben-Erstellung und zeigt Konfigurationsoptionen</li> <li><code>/createleaderboard</code> - Best\u00e4tigt Ranglisten-Erstellung</li> <li><code>/synccalendar</code> - Zeigt Synchronisierungs-Statistiken</li> <li><code>/linkcalendar</code> - Zeigt Link zur Kalender-Verkn\u00fcpfung</li> <li><code>/claim</code> - Best\u00e4tigt Aufgaben-\u00dcbernahme</li> <li><code>/task-complete</code> - Best\u00e4tigt Aufgaben-Abschluss</li> <li><code>/rewards</code> - Zeigt verf\u00fcgbare Belohnungen</li> <li><code>/join</code> - Zeigt Bewerbungsstatus</li> <li><code>/leave</code> - Best\u00e4tigt Austrittsanfrage</li> <li><code>/getdata</code> - Zeigt pers\u00f6nliche Daten</li> <li><code>/score</code> - Zeigt pers\u00f6nlichen Punktestand</li> <li><code>/events</code> - Zeigt Event-Informationen</li> <li><code>/help</code> - Zeigt Hilfe-Informationen</li> <li><code>/ping</code> - Zeigt Bot-Latenz</li> </ol>"},{"location":"logging/logging-dokumentation/#fehlermeldungen-als-ephemeral-messages","title":"Fehlermeldungen als Ephemeral Messages","text":"<p>Alle Fehlermeldungen werden ebenfalls als Ephemeral Messages gesendet, sodass nur der betroffene Benutzer die Fehlerinformationen sieht:</p> <p>Datei: <code>apps/discord-bot/src/errors/dsicordAdapter.ts</code></p> <pre><code>export async function replyWithError(\n    interaction: CommandInteraction | ModalSubmitInteraction | ...,\n    error: ErrorDetails,\n) {\n    return await interaction.reply({\n        content: getErrorMessage(error),\n        flags: MessageFlags.Ephemeral,\n    });\n}\n</code></pre>"},{"location":"logging/logging-dokumentation/#vorteile-von-ephemeral-messages","title":"Vorteile von Ephemeral Messages","text":"<ul> <li>\u2705 Privatsph\u00e4re: Sensible Informationen (z.B. pers\u00f6nliche Daten) bleiben privat</li> <li>\u2705 Keine Channel-Verschmutzung: Erfolgs- und Fehlermeldungen erscheinen nicht in \u00f6ffentlichen Channels</li> <li>\u2705 Bessere UX: Benutzer erhalten sofortiges Feedback zu ihren Aktionen</li> <li>\u2705 Fehlerbehandlung: Fehlermeldungen werden nur dem betroffenen Benutzer angezeigt</li> </ul>"},{"location":"logging/logging-dokumentation/#nachrichten-in-anderen-bot-channels","title":"Nachrichten in anderen Bot-Channels","text":"<p>Nicht alle Bot-Nachrichten landen im bot-log Channel. Viele Nachrichten werden in spezialisierten Channels f\u00fcr bestimmte Zwecke gesendet:</p>"},{"location":"logging/logging-dokumentation/#1-channel-aufgaben-tasks","title":"1. Channel: <code>aufgaben</code> (TASKS)","text":"<p>Zweck: Ver\u00f6ffentlichung von Aufgaben f\u00fcr alle Mitglieder</p> <p>Nachrichten: - \u2705 Aufgaben-Ver\u00f6ffentlichung: Wenn eine Aufgabe mit <code>/createtask</code> erstellt und ver\u00f6ffentlicht wird, erscheint sie hier als Embed mit:   - Aufgabenname   - Beschreibung   - Punkte   - Maximale Teilnehmer   - Deadline   - Verkn\u00fcpftes Event (falls vorhanden)   - Button \"Aufgabe beanspruchen\"</p> <p>Datei: <code>apps/discord-bot/src/commands/gamification/task/createTask.ts</code> (handlePublishTask)</p> <p>Hinweis: Die Erstellung der Aufgabe wird im bot-log geloggt, die Ver\u00f6ffentlichung erfolgt im aufgaben Channel.</p>"},{"location":"logging/logging-dokumentation/#2-channel-events-events","title":"2. Channel: <code>events</code> (EVENTS)","text":"<p>Zweck: Event-\u00dcbersicht und Event-Benachrichtigungen</p> <p>Nachrichten: - \u2705 Event-\u00dcbersicht: Automatische \u00dcbersicht der n\u00e4chsten 5 Events (wird regelm\u00e4ssig aktualisiert) - \u2705 Event-Benachrichtigungen: Benachrichtigungen f\u00fcr anstehende Events mit:   - Event-Name   - Datum und Uhrzeit   - Beschreibung   - Teilnehmer-Mentions   - Relative Zeitangabe (z.B. \"in 2 Stunden\")</p> <p>Datei:  - <code>apps/discord-bot/src/intergration/event/event-discord.service.ts</code> (sendEventOverviewToChannel) - <code>apps/discord-bot/src/utils-discord/guild.ts</code> (notifyEvent)</p> <p>Aktualisierung: Die Event-\u00dcbersicht wird automatisch aktualisiert, wenn Events synchronisiert werden.</p>"},{"location":"logging/logging-dokumentation/#3-channel-rangliste-leaderboards","title":"3. Channel: <code>rangliste</code> (LEADERBOARDS)","text":"<p>Zweck: Anzeige aktiver Ranglisten</p> <p>Nachrichten: - \u2705 Ranglisten-Embed: Zeigt alle aktiven Ranglisten mit:   - Top-Teilnehmer (nach Anzahl sichtbarer Eintr\u00e4ge)   - Punkte pro Teilnehmer   - Zeitraum (Start- und Enddatum)   - Gewinner-Embed (falls vorhanden)</p> <p>Datei: <code>apps/discord-bot/src/intergration/leaderboard-discord.service.ts</code> (updateLeaderboards)</p> <p>Aktualisierung: Wird automatisch aktualisiert, wenn: - Punkte vergeben werden (Aufgaben, Spenden, Events) - Neue Ranglisten erstellt werden - Belohnungen akzeptiert werden</p> <p>Hinweis: Die Erstellung einer Rangliste wird im bot-log geloggt, die Anzeige erfolgt im rangliste Channel.</p>"},{"location":"logging/logging-dokumentation/#4-channel-bot-bewerbungen-applications","title":"4. Channel: <code>bot-bewerbungen</code> (APPLICATIONS)","text":"<p>Zweck: Vorstands-Bereich f\u00fcr Bewerbungen und Austritte</p> <p>Nachrichten: - \u2705 Neue Bewerbungen: Wenn ein Benutzer <code>/join</code> ausf\u00fchrt, erscheint hier ein Embed mit:   - Benutzerinformationen (Name, Discord-ID, etc.)   - Bewerbungsdaten   - Buttons \"Akzeptieren\" und \"Ablehnen\" - \u2705 Austrittsanfragen: Wenn ein Benutzer <code>/leave</code> ausf\u00fchrt, erscheint hier eine Nachricht</p> <p>Datei: - <code>apps/discord-bot/src/commands/user/join/joinStep2.ts</code> (Bewerbungen) - <code>apps/discord-bot/src/commands/user/leave.ts</code> (Austritte) - <code>apps/discord-bot/src/intergration/user-discord.service.ts</code> (handleGuildMemberAdd)</p> <p>Zugriff: Nur f\u00fcr Vorstandsmitglieder sichtbar</p>"},{"location":"logging/logging-dokumentation/#5-channel-bot-belohnungen-rewards","title":"5. Channel: <code>bot-belohnungen</code> (REWARDS)","text":"<p>Zweck: Vorstands-Bereich f\u00fcr Belohnungsanfragen</p> <p>Nachrichten: - \u2705 Belohnungsanfragen: Wenn ein Benutzer eine Belohnung mit <code>/rewards</code> anfordert, erscheint hier ein Embed mit:   - Benutzerinformationen   - Belohnungsname   - Kosten (Punkte)   - Buttons \"Akzeptieren\" und \"Ablehnen\"</p> <p>Datei: <code>apps/discord-bot/src/commands/gamification/rewards.ts</code> (processReward)</p> <p>Zugriff: Nur f\u00fcr Vorstandsmitglieder sichtbar</p>"},{"location":"logging/logging-dokumentation/#6-channel-bot-aufgaben-completed_tasks","title":"6. Channel: <code>bot-aufgaben</code> (COMPLETED_TASKS)","text":"<p>Zweck: Vorstands-Bereich f\u00fcr erledigte Aufgaben</p> <p>Nachrichten: - \u2705 Erledigte Aufgaben: Wenn ein Benutzer eine Aufgabe mit <code>/task-complete</code> abschliesst, erscheint hier ein Embed mit:   - Aufgabenname   - Benutzer, der die Aufgabe erledigt hat   - Punkte   - Buttons \"Akzeptieren\" und \"Ablehnen\"   - Feedback-Feld (wenn vom Vorstand ausgef\u00fcllt)</p> <p>Datei: <code>apps/discord-bot/src/commands/gamification/task/feedback.ts</code> (processTaskCompletionButton)</p> <p>Zugriff: Nur f\u00fcr Vorstandsmitglieder sichtbar</p> <p>Workflow: 1. Benutzer erledigt Aufgabe \u2192 Nachricht erscheint in <code>bot-aufgaben</code> 2. Vorstand gibt Feedback (optional) und akzeptiert/lehnt ab 3. Benutzer erh\u00e4lt DM mit Feedback und Punkte (falls akzeptiert)</p>"},{"location":"logging/logging-dokumentation/#ubersicht-channel-zuordnung","title":"\u00dcbersicht: Channel-Zuordnung","text":"Channel Zweck Sichtbarkeit Nachrichten-Typ bot-log Logging wichtiger Ereignisse Vorstand Log-Embeds (9 Event-Typen) aufgaben Aufgaben-Ver\u00f6ffentlichung Alle Mitglieder Aufgaben-Embeds mit Claim-Button events Event-\u00dcbersicht &amp; Benachrichtigungen Alle Mitglieder Event-Embeds &amp; \u00dcbersicht rangliste Ranglisten-Anzeige Alle Mitglieder Ranglisten-Embeds bot-bewerbungen Bewerbungen &amp; Austritte Vorstand Bewerbungs-Embeds mit Buttons bot-belohnungen Belohnungsanfragen Vorstand Belohnungs-Embeds mit Buttons bot-aufgaben Erledigte Aufgaben Vorstand Aufgaben-Abschluss-Embeds mit Buttons"},{"location":"logging/logging-dokumentation/#zusammenfassung","title":"Zusammenfassung","text":"<p>Das Logging-System im ClansCore-Projekt besteht aus:</p> <ol> <li>bot-log Channel: Zentraler Discord-Channel f\u00fcr wichtige Ereignisse und \u00c4nderungen (9 Event-Typen)</li> <li>Ephemeral Messages: Private Nachrichten direkt an Benutzer bei Befehlen (17+ Befehle)</li> <li>Spezialisierte Channels: 6 weitere Channels f\u00fcr spezifische Zwecke (Aufgaben, Events, Ranglisten, Bewerbungen, Belohnungen, erledigte Aufgaben)</li> <li>Console-Logging: Entwicklungs- und Debugging-Logs in beiden Services</li> <li>Error-Handling: Strukturierte Fehlerbehandlung mit zentraler Fehlermeldungsverarbeitung</li> <li>Webhook-System: Automatische Benachrichtigungen zwischen API und Discord-Bot</li> </ol> <p>Wichtigste Logging-Punkte: - \u2705 Alle Rollen\u00e4nderungen (Dashboard und Discord) \u2192 bot-log - \u2705 User- und Rollen-Synchronisierungen \u2192 bot-log + Ephemeral Messages - \u2705 Spenden-Protokollierung \u2192 bot-log + Ephemeral Messages - \u2705 Aufgaben-Erstellung \u2192 bot-log, Aufgaben-Ver\u00f6ffentlichung \u2192 aufgaben - \u2705 Ranglisten-Erstellung \u2192 bot-log, Ranglisten-Anzeige \u2192 rangliste - \u2705 Kalender-Synchronisierungen \u2192 bot-log + Ephemeral Messages - \u2705 Automatische Cron-Job-Ausf\u00fchrungen \u2192 bot-log</p> <p>Benutzerinformationen: - \u2705 Alle Befehlsantworten \u2192 Ephemeral Messages (nur f\u00fcr ausf\u00fchrenden Benutzer sichtbar) - \u2705 Fehlermeldungen \u2192 Ephemeral Messages (privat) - \u2705 Erfolgsmeldungen \u2192 Ephemeral Messages (privat)</p> <p>Alle Log-Eintr\u00e4ge im bot-log Channel sind als strukturierte Discord Embeds formatiert und enthalten relevante Metadaten f\u00fcr die Nachverfolgung von \u00c4nderungen.</p>"}]}